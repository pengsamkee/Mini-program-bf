"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var webAPI = require("../../../api/app/AppService");
var globalEnum = require("../../../api/GlobalEnum");
var interface_1 = require("../../../api/app/interface");
var app = getApp();
var chart = null;
var data = [];
function initChart(canvas, width, height, F2) {
    var map = {};
    data.forEach(function (obj) {
        console.log(obj);
        if (obj.name === '蛋白质') {
            return map[obj.name] = ' ' + ' ' + ' ' + ' ' + ' ' + obj.percent + '%';
        }
        else if (obj.name === '脂肪') {
            return map[obj.name] = ' ' + ' ' + ' ' + ' ' + ' ' + ' ' + ' ' + ' ' + obj.percent + '%';
        }
        else {
            map[obj.name] = ' ' + obj.percent + '%';
        }
    });
    chart = new F2.Chart({
        el: canvas,
        width: width,
        height: height
    });
    chart.source(data, {
        percent: {
            formatter: function formatter(val) {
                return val + '%';
            }
        }
    });
    chart.tooltip(false);
    chart.legend({
        position: 'right',
        marker: 'square',
        verticalAlign: 'center',
        itemFormatter: function itemFormatter(val) {
            return val + ' ' + map[val];
        },
        clickable: false
    });
    chart.coord('polar', {
        transposed: true,
        innerRadius: 0.7,
        radius: 1
    });
    chart.axis(false);
    chart.interval()
        .position('a*percent')
        .color('name', ['#FFB400', '#FF5C47', '#FF822D'])
        .adjust('stack');
    chart.render();
    return chart;
}
var NutritionDetail = (function () {
    function NutritionDetail() {
        this.data = {
            foodInfo: {},
            micro: {},
            options: {},
        };
    }
    NutritionDetail.prototype.onLoad = function (options) {
        webAPI.SetAuthToken(wx.getStorageSync(globalEnum.globalKey_token));
        options.foodId = Number(options.foodId);
        options.foodType = Number(options.foodType);
        this.setData({
            options: options
        });
    };
    NutritionDetail.prototype.onReady = function () {
        this.getFoodNutritions(this.data.options);
    };
    NutritionDetail.prototype.getFoodNutritions = function (options) {
        var that = this;
        wx.showLoading({ title: "加载中..." });
        interface_1.default.foodNutritions(options).then(function (res) {
            var foodInfo = res.foodInfo, micro = res.micro;
            foodInfo.contentEnergy = Math.round(foodInfo.contentEnergy);
            var total = 0;
            foodInfo.mainNutrients.map(function (item) {
                item.content = Number(item.content.toFixed(1));
                total += item.content;
            });
            that.setData({
                foodInfo: foodInfo,
                micro: micro
            });
            var newData = [];
            foodInfo.mainNutrients.map(function (item) {
                item.percent = Math.round(item.content * 100 / total);
                item.a = '1';
                newData.push(item);
            });
            data = newData;
            var salesTrendChartComponent = that.selectComponent('#canvasf2');
            salesTrendChartComponent.init(initChart);
            wx.hideLoading();
        }).catch(function (err) {
            wx.hideLoading();
            wx.showToast({
                title: '获取数据失败',
                icon: 'none'
            });
        });
    };
    return NutritionDetail;
}());
Page(new NutritionDetail());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLG9EQUFzRDtBQUN0RCxvREFBcUQ7QUFDckQsd0RBQWdEO0FBR2hELElBQU0sR0FBRyxHQUFHLE1BQU0sRUFBVSxDQUFDO0FBRTdCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQztBQUNqQixJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7QUFDZCxTQUFTLFNBQVMsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFO0lBQzFDLElBQU0sR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUNmLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBUyxHQUFHO1FBQ3ZCLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDaEIsSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFHLEtBQUssRUFBQztZQUNuQixPQUFPLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUUsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQztTQUN2RTthQUFLLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxJQUFJLEVBQUU7WUFDM0IsT0FBTyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFFLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7U0FDekY7YUFBSTtZQUNILEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFDLEdBQUcsQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDO1NBQ3ZDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDSCxLQUFLLEdBQUcsSUFBSSxF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LENBQUE7Z0JBQzlDLEtBQUssSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFBO1lBQ3ZCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFDWCxRQUFRLEVBQUUsUUFBUTtnQkFDbEIsS0FBSyxFQUFDLEtBQUs7YUFDWixDQUFDLENBQUE7WUFDRixJQUFJLE9BQU8sR0FBTyxFQUFFLENBQUE7WUFDcEIsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsVUFBQSxJQUFJO2dCQUM3QixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBQyxHQUFHLEdBQUMsS0FBSyxDQUFDLENBQUE7Z0JBQ2pELElBQUksQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFBO2dCQUNaLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7WUFDcEIsQ0FBQyxDQUFDLENBQUE7WUFDRixJQUFJLEdBQUcsT0FBTyxDQUFDO1lBQ2YsSUFBSSx3QkFBd0IsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ2pFLHdCQUF3QixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQTtZQUN4QyxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUE7UUFDbEIsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQUEsR0FBRztZQUNWLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUNoQixFQUFFLENBQUMsU0FBUyxDQUFDO2dCQUNYLEtBQUssRUFBQyxRQUFRO2dCQUNkLElBQUksRUFBQyxNQUFNO2FBQ1osQ0FBQyxDQUFBO1FBQ0osQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBQ0gsc0JBQUM7QUFBRCxDQUFDLEFBMURELElBMERDO0FBRUQsSUFBSSxDQUFDLElBQUksZUFBZSxFQUFFLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElNeUFwcCB9IGZyb20gJy4uLy4uLy4uL2FwcCdcbmltcG9ydCAqIGFzIHdlYkFQSSBmcm9tICcuLi8uLi8uLi9hcGkvYXBwL0FwcFNlcnZpY2UnO1xuaW1wb3J0ICogYXMgZ2xvYmFsRW51bSBmcm9tICcuLi8uLi8uLi9hcGkvR2xvYmFsRW51bSdcbmltcG9ydCByZXF1ZXN0IGZyb20gJy4uLy4uLy4uL2FwaS9hcHAvaW50ZXJmYWNlJ1xuXG5cbmNvbnN0IGFwcCA9IGdldEFwcDxJTXlBcHA+KCk7XG5cbmxldCBjaGFydCA9IG51bGw7XG5sZXQgZGF0YSA9IFtdO1xuZnVuY3Rpb24gaW5pdENoYXJ0KGNhbnZhcywgd2lkdGgsIGhlaWdodCwgRjIpIHsgLy8g5L2/55SoIEYyIOe7mOWItuWbvuihqFxuICBjb25zdCBtYXAgPSB7fTtcbiAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKG9iaikge1xuICAgIGNvbnNvbGUubG9nKG9iailcbiAgICBpZiAob2JqLm5hbWU9PT0n6JuL55m96LSoJyl7XG4gICAgICByZXR1cm4gbWFwW29iai5uYW1lXSA9ICcgJyArICcgJyArICcgJysgJyAnICsgJyAnICsgb2JqLnBlcmNlbnQgKyAnJSc7XG4gICAgfWVsc2UgaWYgKG9iai5uYW1lID09PSAn6ISC6IKqJykge1xuICAgICAgcmV0dXJuIG1hcFtvYmoubmFtZV0gPSAnICcgKyAnICcgKyAnICcrICcgJyArICcgJyArICcgJyArICcgJyArICcgJyArIG9iai5wZXJjZW50ICsgJyUnO1xuICAgIH1lbHNle1xuICAgICAgbWFwW29iai5uYW1lXSA9ICcgJytvYmoucGVyY2VudCArICclJztcbiAgICB9XG4gIH0pO1xuICBjaGFydCA9IG5ldyBGMi5DaGFydCh7XG4gICAgZWw6IGNhbnZhcyxcbiAgICB3aWR0aCxcbiAgICBoZWlnaHRcbiAgfSk7XG4gIGNoYXJ0LnNvdXJjZShkYXRhLCB7XG4gICAgcGVyY2VudDoge1xuICAgICAgZm9ybWF0dGVyOiBmdW5jdGlvbiBmb3JtYXR0ZXIodmFsKSB7XG4gICAgICAgIHJldHVybiB2YWwgKyAnJSc7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgY2hhcnQudG9vbHRpcChmYWxzZSk7XG4gIGNoYXJ0LmxlZ2VuZCh7XG4gICAgcG9zaXRpb246ICdyaWdodCcsXG4gICAgbWFya2VyOidzcXVhcmUnLFxuICAgIHZlcnRpY2FsQWxpZ246J2NlbnRlcicsXG4gICAgaXRlbUZvcm1hdHRlcjogZnVuY3Rpb24gaXRlbUZvcm1hdHRlcih2YWwpIHtcbiAgICAgIHJldHVybiB2YWwgKyAnICcgKyBtYXBbdmFsXTtcbiAgICB9LFxuICAgIGNsaWNrYWJsZTogZmFsc2VcbiAgfSk7XG4gIGNoYXJ0LmNvb3JkKCdwb2xhcicsIHtcbiAgICB0cmFuc3Bvc2VkOiB0cnVlLFxuICAgIGlubmVyUmFkaXVzOiAwLjcsXG4gICAgcmFkaXVzOiAxXG4gIH0pO1xuICBjaGFydC5heGlzKGZhbHNlKTtcbiAgY2hhcnQuaW50ZXJ2YWwoKVxuICAgIC5wb3NpdGlvbignYSpwZXJjZW50JylcbiAgICAuY29sb3IoJ25hbWUnLCBbJyNGRkI0MDAnLCAnI0ZGNUM0NycsICcjRkY4MjJEJ10pXG4gICAgLmFkanVzdCgnc3RhY2snKTtcbiAgY2hhcnQucmVuZGVyKCk7XG4gIHJldHVybiBjaGFydDtcbn1cblxuY2xhc3MgTnV0cml0aW9uRGV0YWlsIHtcblxuICBwdWJsaWMgZGF0YSA9IHtcbiAgICAvLyBvcHRzOiB7XG4gICAgLy8gICBvbkluaXQ6IGluaXRDaGFydCxcbiAgICAvLyB9LFxuICAgIGZvb2RJbmZvOnt9LFxuICAgIG1pY3JvOnt9LFxuICAgIG9wdGlvbnM6e30sXG4gIH1cblxuICBwdWJsaWMgb25Mb2FkKG9wdGlvbnM6YW55KSB7XG4gICAgd2ViQVBJLlNldEF1dGhUb2tlbih3eC5nZXRTdG9yYWdlU3luYyhnbG9iYWxFbnVtLmdsb2JhbEtleV90b2tlbikpO1xuICAgIG9wdGlvbnMuZm9vZElkID0gTnVtYmVyKG9wdGlvbnMuZm9vZElkKTtcbiAgICBvcHRpb25zLmZvb2RUeXBlID0gTnVtYmVyKG9wdGlvbnMuZm9vZFR5cGUpO1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7XG4gICAgICBvcHRpb25zOm9wdGlvbnNcbiAgICB9KVxuICB9XG4gIHB1YmxpYyBvblJlYWR5KCl7XG4gICAgdGhpcy5nZXRGb29kTnV0cml0aW9ucyh0aGlzLmRhdGEub3B0aW9ucylcbiAgfVxuICAvKipcbiAgICog6K+35rGC6I635b6X6aOf54mp55qE6JCl5YW75pWw5o2uXG4gICAqL1xuICBwdWJsaWMgZ2V0Rm9vZE51dHJpdGlvbnMob3B0aW9uczphbnkpe1xuICAgIGNvbnN0IHRoYXQ6YW55ID0gdGhpc1xuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6IFwi5Yqg6L295LitLi4uXCJ9KTtcbiAgICByZXF1ZXN0LmZvb2ROdXRyaXRpb25zKG9wdGlvbnMpLnRoZW4ocmVzID0+IHtcbiAgICAgIGNvbnN0IHsgZm9vZEluZm8sIG1pY3JvIH0gPSByZXNcbiAgICAgIGZvb2RJbmZvLmNvbnRlbnRFbmVyZ3kgPSBNYXRoLnJvdW5kKGZvb2RJbmZvLmNvbnRlbnRFbmVyZ3kpXG4gICAgICBsZXQgdG90YWw6TnVtYmVyID0gMDtcbiAgICAgIGZvb2RJbmZvLm1haW5OdXRyaWVudHMubWFwKGl0ZW09PntcbiAgICAgICAgaXRlbS5jb250ZW50ID0gTnVtYmVyKGl0ZW0uY29udGVudC50b0ZpeGVkKDEpKVxuICAgICAgICB0b3RhbCArPSBpdGVtLmNvbnRlbnRcbiAgICAgIH0pO1xuICAgICAgdGhhdC5zZXREYXRhKHtcbiAgICAgICAgZm9vZEluZm86IGZvb2RJbmZvLFxuICAgICAgICBtaWNybzptaWNyb1xuICAgICAgfSlcbiAgICAgIGxldCBuZXdEYXRhOmFueSA9IFtdXG4gICAgICBmb29kSW5mby5tYWluTnV0cmllbnRzLm1hcChpdGVtID0+IHtcbiAgICAgICAgaXRlbS5wZXJjZW50ID0gTWF0aC5yb3VuZChpdGVtLmNvbnRlbnQqMTAwL3RvdGFsKVxuICAgICAgICBpdGVtLmEgPSAnMSdcbiAgICAgICAgbmV3RGF0YS5wdXNoKGl0ZW0pXG4gICAgICB9KVxuICAgICAgZGF0YSA9IG5ld0RhdGE7XG4gICAgICBsZXQgc2FsZXNUcmVuZENoYXJ0Q29tcG9uZW50ID0gdGhhdC5zZWxlY3RDb21wb25lbnQoJyNjYW52YXNmMicpO1xuICAgICAgc2FsZXNUcmVuZENoYXJ0Q29tcG9uZW50LmluaXQoaW5pdENoYXJ0KVxuICAgICAgd3guaGlkZUxvYWRpbmcoKVxuICAgIH0pLmNhdGNoKGVyciA9PiB7XG4gICAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICB0aXRsZTon6I635Y+W5pWw5o2u5aSx6LSlJyxcbiAgICAgICAgaWNvbjonbm9uZSdcbiAgICAgIH0pIFxuICAgIH0pXG4gIH1cbn1cblxuUGFnZShuZXcgTnV0cml0aW9uRGV0YWlsKCkpXG4iXX0=