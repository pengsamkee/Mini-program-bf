"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var interface_1 = require("./../../../api/app/interface");
var ConfirmMeal = (function () {
    function ConfirmMeal() {
        this.data = {
            mealId: 20646,
            taggs: [{
                    bboxH: 100,
                    bboxW: 91,
                    bboxX: 0,
                    bboxY: 193,
                    foodId: 12,
                    foodName: "牛奶椰丝小方糕",
                    foodType: 2,
                    isDeleted: false,
                    resultList: [
                        { foodId: 836, foodName: "牛奶椰丝小方糕", foodType: 1 },
                        { foodId: 456, foodType: 2, foodName: "橙", score: 1 },
                        { foodId: 492, foodType: 2, foodName: "哈密瓜", score: 1 },
                        { foodId: 1321, foodType: 2, foodName: "橙汁", score: 0 },
                        { foodId: 1322, foodType: 2, foodName: "柠檬汽水", score: 0 },
                        { foodId: 362, foodType: 2, foodName: "长把梨", score: 0 },
                        { foodId: 454, foodType: 2, foodName: "中华猕猴桃[毛叶猕猴桃,奇异果]", score: 0 }
                    ],
                    selectedPos: 0,
                    showDeleteBtn: false,
                    tagHeight: 95,
                    tagX: 33.75,
                    tagY: 182.25,
                },
                {
                    bboxH: 178,
                    bboxW: 201,
                    bboxX: 309,
                    bboxY: 104,
                    foodId: 14,
                    foodName: "牛奶雪糕",
                    foodType: 2,
                    isDeleted: false,
                    resultList: [
                        { foodId: 830, foodName: "牛奶雪糕", foodType: 1 },
                        { foodId: 220, foodType: 1, foodName: "香油鸡蛋羹", score: 33 },
                        { foodId: 5, foodType: 1, foodName: "紫菜蛋汤", score: 26 },
                        { foodId: 300, foodType: 1, foodName: "豆腐海带汤", score: 26 },
                        { foodId: 162, foodType: 1, foodName: "大饼", score: 14 },
                        { foodId: 244, foodType: 1, foodName: "玉米面饼", score: 14 },
                        { foodId: 671, foodType: 1, foodName: "清炖鸡", score: 5 }
                    ],
                    selectedPos: 0,
                    showDeleteBtn: false,
                    tagHeight: 65,
                    tagX: 306.7,
                    tagY: 144.7,
                }],
            unitArr: [
                {
                    "foodName": "面条",
                    "foodId": 12,
                    "foodType": 2,
                    "unitOption": [
                        {
                            unitName: "100克",
                            "unitWeight": 100,
                            "unitId": 263,
                            "energy": 286.0,
                            "energyUnit": "千卡"
                        },
                        {
                            unitName: "份",
                            "unitWeight": 100,
                            "unitId": 809,
                            "energy": 286.0,
                            "energyUnit": "千卡"
                        },
                        {
                            unitName: "碗",
                            "unitWeight": 350,
                            "unitId": 262,
                            "energy": 1001.0,
                            "energyUnit": "千卡"
                        }
                    ]
                },
                {
                    "foodName": "富强粉切面",
                    "foodId": 14,
                    "foodType": 2,
                    "unitOption": [
                        {
                            "unitName": "100克",
                            "unitWeight": 100,
                            "unitId": 52,
                            "energy": 277.0,
                            "energyUnit": "千卡"
                        },
                        {
                            "unitName": "份",
                            "unitWeight": 100,
                            "unitId": 708,
                            "energy": 277.0,
                            "energyUnit": "千卡"
                        },
                        {
                            "unitName": "小饭碗",
                            "unitWeight": 200,
                            "unitId": 3,
                            "energy": 554.0,
                            "energyUnit": "千卡"
                        },
                        {
                            "unitName": "拳头大小",
                            "unitWeight": 110,
                            "unitId": 2,
                            "energy": 304.7,
                            "energyUnit": "千卡"
                        },
                        {
                            "unitName": "鸡蛋大小",
                            "unitWeight": 50,
                            "unitId": 1,
                            "energy": 138.5,
                            "energyUnit": "千卡"
                        }
                    ]
                }
            ],
            showPicker: false,
            columns: [],
            pickerIndex: null,
            chooseUnitIndex: '',
            persons: ['我自己独自一人', '2人用餐', '3人用餐', '4人用餐', '5人用餐', '6人用餐'],
            choosePersonNumIndex: 0,
            totalEnergy: 0,
        };
    }
    ConfirmMeal.prototype.onLoad = function (options) {
        this.getFoodUnitOptionList();
    };
    ConfirmMeal.prototype.handleShowPicker = function (e) {
        var pickerIndex = e.currentTarget.dataset.pickerIndex;
        if (pickerIndex === 'person') {
            var columns = [1, 2, 3, 4, 5, 6];
        }
        else {
            var columns = this.data.unitArr[pickerIndex].unitOption.map(function (item) { return item.unitName; });
        }
        this.setData({
            columns: columns,
            pickerIndex: pickerIndex,
            showPicker: true,
            showPopup: false
        });
    };
    ConfirmMeal.prototype.onConfirm = function () {
        this.setData({ showPicker: false, showPopup: true });
    };
    ConfirmMeal.prototype.onChange = function (e) {
        var _this = this;
        var chooseUnitIndex = e.detail.index;
        if (this.data.pickerIndex === 'person') {
            this.setData({ choosePersonNumIndex: chooseUnitIndex }, function () {
                console.log('choosePersonNumIndex===', _this.data.choosePersonNumIndex);
            });
        }
        else {
            this.data.unitArr[this.data.pickerIndex].chooseUnitIndex = chooseUnitIndex;
            this.setData({ unitArr: this.data.unitArr }, function () {
                _this.totalEnergy();
            });
        }
    };
    ConfirmMeal.prototype.getFoodUnitOptionList = function () {
        var _this = this;
        var req = this.data.taggs.map(function (item) {
            return {
                foodId: item.foodId,
                foodType: item.foodType
            };
        });
        interface_1.default.getFoodUnitOptionList({ foodUnitOptionList: req }).then(function (res) {
            res.map(function (item) {
                item.chooseUnitIndex = 0;
                item.amount = 100;
            });
            var unitArr = res.slice();
            _this.setData({ unitArr: unitArr }, function () {
                _this.totalEnergy();
            });
        }).catch(function (err) {
            wx.showToast({ title: err.msg, icon: 'none' });
        });
    };
    ConfirmMeal.prototype.handleAmountInput = function (e) {
        var _this = this;
        var inputIndex = e.currentTarget.dataset.inputIndex;
        var value = e.detail.value;
        value = parseInt(value);
        this.data.unitArr[inputIndex].amount = 100 * value;
        this.setData({ unitArr: this.data.unitArr }, function () {
            _this.totalEnergy();
        });
    };
    ConfirmMeal.prototype.handleAmountInputFocus = function (e) {
        var inputIndex = e.currentTarget.dataset.inputIndex;
        var item = this.data.unitArr[inputIndex];
        item.focusAmount = item.amount;
        item.amount = 0;
        this.setData({ unitArr: this.data.unitArr });
    };
    ConfirmMeal.prototype.handleAmountInputBlur = function (e) {
        var inputIndex = e.currentTarget.dataset.inputIndex;
        var item = this.data.unitArr[inputIndex];
        if (item.amount == 0) {
            debugger;
            item.amount = item.focusAmount;
            this.setData({ unitArr: this.data.unitArr });
        }
    };
    ConfirmMeal.prototype.totalEnergy = function () {
        var unitArr = this.data.unitArr;
        var totalEnergy = unitArr.reduce(function (pre, next) {
            return next.amount / 100 * next.unitOption[next.chooseUnitIndex].energy + pre;
        }, 0);
        totalEnergy = Math.round(totalEnergy);
        this.setData({ totalEnergy: totalEnergy });
    };
    ConfirmMeal.prototype.handleGoWeightReferencePage = function () {
        wx.navigateTo({ url: './../weightReference/index' });
    };
    return ConfirmMeal;
}());
Page(new ConfirmMeal());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDBEQUFtRDtBQUVuRDtJQUFBO1FBRVcsU0FBSSxHQUFFO1lBQ1QsTUFBTSxFQUFFLEtBQUs7WUFDYixLQUFLLEVBQUMsQ0FBQztvQkFDSCxLQUFLLEVBQUUsR0FBRztvQkFDVixLQUFLLEVBQUUsRUFBRTtvQkFDVCxLQUFLLEVBQUUsQ0FBQztvQkFDUixLQUFLLEVBQUUsR0FBRztvQkFDVixNQUFNLEVBQUUsRUFBRTtvQkFDVixRQUFRLEVBQUUsU0FBUztvQkFDbkIsUUFBUSxFQUFFLENBQUM7b0JBQ1gsU0FBUyxFQUFFLEtBQUs7b0JBQ2hCLFVBQVUsRUFBRTt3QkFDUixFQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFDO3dCQUMvQyxFQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUM7d0JBQ25ELEVBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBQzt3QkFDckQsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFDO3dCQUNyRCxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUM7d0JBQ3ZELEVBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBQzt3QkFDckQsRUFB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WUFDZCxRQUFRLENBQUE7WUFDUixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7WUFDOUIsSUFBWSxDQUFDLE9BQU8sQ0FBQyxFQUFDLE9BQU8sRUFBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBQyxDQUFDLENBQUE7U0FDckQ7SUFDTCxDQUFDO0lBSU0saUNBQVcsR0FBbEI7UUFDSSxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQTtRQUMvQixJQUFJLFdBQVcsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBRyxFQUFDLElBQUk7WUFDdEMsT0FBTyxJQUFJLENBQUMsTUFBTSxHQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxNQUFNLEdBQUMsR0FBRyxDQUFBO1FBQzdFLENBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQztRQUNMLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3JDLElBQVksQ0FBQyxPQUFPLENBQUMsRUFBQyxXQUFXLEVBQUMsV0FBVyxFQUFDLENBQUMsQ0FBQTtJQUNwRCxDQUFDO0lBSU0saURBQTJCLEdBQWxDO1FBQ0ksRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEdBQUcsRUFBRSw0QkFBNEIsRUFBRSxDQUFDLENBQUE7SUFDeEQsQ0FBQztJQUNMLGtCQUFDO0FBQUQsQ0FBQyxBQWhQRCxJQWdQQztBQUVELElBQUksQ0FBQyxJQUFJLFdBQVcsRUFBRSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcmVxdWVzdCBmcm9tICcuLy4uLy4uLy4uL2FwaS9hcHAvaW50ZXJmYWNlJztcblxuY2xhc3MgQ29uZmlybU1lYWwge1xuXG4gICAgcHVibGljIGRhdGE9IHtcbiAgICAgICAgbWVhbElkOiAyMDY0NixcbiAgICAgICAgdGFnZ3M6W3tcbiAgICAgICAgICAgIGJib3hIOiAxMDAsXG4gICAgICAgICAgICBiYm94VzogOTEsXG4gICAgICAgICAgICBiYm94WDogMCxcbiAgICAgICAgICAgIGJib3hZOiAxOTMsXG4gICAgICAgICAgICBmb29kSWQ6IDEyLFxuICAgICAgICAgICAgZm9vZE5hbWU6IFwi54mb5aW25qSw5Lid5bCP5pa557OVXCIsXG4gICAgICAgICAgICBmb29kVHlwZTogMixcbiAgICAgICAgICAgIGlzRGVsZXRlZDogZmFsc2UsXG4gICAgICAgICAgICByZXN1bHRMaXN0OiBbXG4gICAgICAgICAgICAgICAge2Zvb2RJZDogODM2LCBmb29kTmFtZTogXCLniZvlpbbmpLDkuJ3lsI/mlrnns5VcIiwgZm9vZFR5cGU6IDF9LFxuICAgICAgICAgICAgICAgIHtmb29kSWQ6IDQ1NiwgZm9vZFR5cGU6IDIsIGZvb2ROYW1lOiBcIuapmVwiLCBzY29yZTogMX0sXG4gICAgICAgICAgICAgICAge2Zvb2RJZDogNDkyLCBmb29kVHlwZTogMiwgZm9vZE5hbWU6IFwi5ZOI5a+G55OcXCIsIHNjb3JlOiAxfSxcbiAgICAgICAgICAgICAgICB7Zm9vZElkOiAxMzIxLCBmb29kVHlwZTogMiwgZm9vZE5hbWU6IFwi5qmZ5rGBXCIsIHNjb3JlOiAwfSxcbiAgICAgICAgICAgICAgICB7Zm9vZElkOiAxMzIyLCBmb29kVHlwZTogMiwgZm9vZE5hbWU6IFwi5p+g5qqs5rG95rC0XCIsIHNjb3JlOiAwfSxcbiAgICAgICAgICAgICAgICB7Zm9vZElkOiAzNjIsIGZvb2RUeXBlOiAyLCBmb29kTmFtZTogXCLplb/miormoqhcIiwgc2NvcmU6IDB9LFxuICAgICAgICAgICAgICAgIHtmb29kSWQ6IDQ1NCwgZm9vZFR5cGU6IDIsIGZvb2ROYW1lOiBcIuS4reWNjueMleeMtOahg1vmr5vlj7bnjJXnjLTmoYMs5aWH5byC5p6cXVwiLCBzY29yZTogMH1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBzZWxlY3RlZFBvczogMCxcbiAgICAgICAgICAgIHNob3dEZWxldGVCdG46IGZhbHNlLFxuICAgICAgICAgICAgdGFnSGVpZ2h0OiA5NSxcbiAgICAgICAgICAgIHRhZ1g6IDMzLjc1LFxuICAgICAgICAgICAgdGFnWTogMTgyLjI1LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBiYm94SDogMTc4LFxuICAgICAgICAgICAgYmJveFc6IDIwMSxcbiAgICAgICAgICAgIGJib3hYOiAzMDksXG4gICAgICAgICAgICBiYm94WTogMTA0LFxuICAgICAgICAgICAgZm9vZElkOiAxNCxcbiAgICAgICAgICAgIGZvb2ROYW1lOiBcIueJm+WltumbquezlVwiLFxuICAgICAgICAgICAgZm9vZFR5cGU6IDIsXG4gICAgICAgICAgICBpc0RlbGV0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgcmVzdWx0TGlzdDogW1xuICAgICAgICAgICAgICAgIHtmb29kSWQ6IDgzMCwgZm9vZE5hbWU6IFwi54mb5aW26Zuq57OVXCIsIGZvb2RUeXBlOiAxfSxcbiAgICAgICAgICAgICAgICB7Zm9vZElkOiAyMjAsIGZvb2RUeXBlOiAxLCBmb29kTmFtZTogXCLpppnmsrnpuKHom4vnvrlcIiwgc2NvcmU6IDMzfSxcbiAgICAgICAgICAgICAgICB7Zm9vZElkOiA1LCBmb29kVHlwZTogMSwgZm9vZE5hbWU6IFwi57Sr6I+c6JuL5rGkXCIsIHNjb3JlOiAyNn0sXG4gICAgICAgICAgICAgICAge2Zvb2RJZDogMzAwLCBmb29kVHlwZTogMSwgZm9vZE5hbWU6IFwi6LGG6IWQ5rW35bim5rGkXCIsIHNjb3JlOiAyNn0sXG4gICAgICAgICAgICAgICAge2Zvb2RJZDogMTYyLCBmb29kVHlwZTogMSwgZm9vZE5hbWU6IFwi5aSn6aW8XCIsIHNjb3JlOiAxNH0sXG4gICAgICAgICAgICAgICAge2Zvb2RJZDogMjQ0LCBmb29kVHlwZTogMSwgZm9vZE5hbWU6IFwi546J57Gz6Z2i6aW8XCIsIHNjb3JlOiAxNH0sXG4gICAgICAgICAgICAgICAge2Zvb2RJZDogNjcxLCBmb29kVHlwZTogMSwgZm9vZE5hbWU6IFwi5riF54KW6bihXCIsIHNjb3JlOiA1fVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIHNlbGVjdGVkUG9zOiAwLFxuICAgICAgICAgICAgc2hvd0RlbGV0ZUJ0bjogZmFsc2UsXG4gICAgICAgICAgICB0YWdIZWlnaHQ6IDY1LFxuICAgICAgICAgICAgdGFnWDogMzA2LjcsXG4gICAgICAgICAgICB0YWdZOiAxNDQuNyxcbiAgICAgICAgfV0sXG4gICAgICAgIHVuaXRBcnI6W1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiZm9vZE5hbWVcIjogXCLpnaLmnaFcIixcbiAgICAgICAgICAgICAgICBcImZvb2RJZFwiOiAxMixcbiAgICAgICAgICAgICAgICBcImZvb2RUeXBlXCI6IDIsXG4gICAgICAgICAgICAgICAgXCJ1bml0T3B0aW9uXCI6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdW5pdE5hbWU6IFwiMTAw5YWLXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVuaXRXZWlnaHRcIjogMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1bml0SWRcIjogMjYzLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbmVyZ3lcIjogMjg2LjAsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVuZXJneVVuaXRcIjogXCLljYPljaFcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1bml0TmFtZTogXCLku71cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidW5pdFdlaWdodFwiOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVuaXRJZFwiOiA4MDksXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVuZXJneVwiOiAyODYuMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW5lcmd5VW5pdFwiOiBcIuWNg+WNoVwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXROYW1lOiBcIueil1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1bml0V2VpZ2h0XCI6IDM1MCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidW5pdElkXCI6IDI2MixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW5lcmd5XCI6IDEwMDEuMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW5lcmd5VW5pdFwiOiBcIuWNg+WNoVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiZm9vZE5hbWVcIjogXCLlr4zlvLrnsonliIfpnaJcIixcbiAgICAgICAgICAgICAgICBcImZvb2RJZFwiOiAxNCxcbiAgICAgICAgICAgICAgICBcImZvb2RUeXBlXCI6IDIsXG4gICAgICAgICAgICAgICAgXCJ1bml0T3B0aW9uXCI6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1bml0TmFtZVwiOiBcIjEwMOWFi1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1bml0V2VpZ2h0XCI6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidW5pdElkXCI6IDUyLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbmVyZ3lcIjogMjc3LjAsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVuZXJneVVuaXRcIjogXCLljYPljaFcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInVuaXROYW1lXCI6IFwi5Lu9XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVuaXRXZWlnaHRcIjogMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1bml0SWRcIjogNzA4LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbmVyZ3lcIjogMjc3LjAsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVuZXJneVVuaXRcIjogXCLljYPljaFcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInVuaXROYW1lXCI6IFwi5bCP6aWt56KXXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVuaXRXZWlnaHRcIjogMjAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1bml0SWRcIjogMyxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW5lcmd5XCI6IDU1NC4wLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbmVyZ3lVbml0XCI6IFwi5Y2D5Y2hXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1bml0TmFtZVwiOiBcIuaLs+WktOWkp+Wwj1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1bml0V2VpZ2h0XCI6IDExMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidW5pdElkXCI6IDIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVuZXJneVwiOiAzMDQuNyxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW5lcmd5VW5pdFwiOiBcIuWNg+WNoVwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidW5pdE5hbWVcIjogXCLpuKHom4vlpKflsI9cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidW5pdFdlaWdodFwiOiA1MCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidW5pdElkXCI6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVuZXJneVwiOiAxMzguNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW5lcmd5VW5pdFwiOiBcIuWNg+WNoVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIHNob3dQaWNrZXI6ZmFsc2UsXG4gICAgICAgIGNvbHVtbnM6W10sXG4gICAgICAgIHBpY2tlckluZGV4Om51bGwsXG4gICAgICAgIGNob29zZVVuaXRJbmRleDonJyxcbiAgICAgICAgcGVyc29uczpbJ+aIkeiHquW3seeLrOiHquS4gOS6uicsJzLkurrnlKjppJAnLCcz5Lq655So6aSQJywnNOS6uueUqOmkkCcsJzXkurrnlKjppJAnLCc25Lq655So6aSQJ10sXG4gICAgICAgIGNob29zZVBlcnNvbk51bUluZGV4OjAsXG4gICAgICAgIHRvdGFsRW5lcmd5OjAsXG4gICAgfVxuICAgIHB1YmxpYyBvbkxvYWQob3B0aW9ucyl7XG4gICAgICAgIC8vIGxldCBtZWFsSW5mbyA9IEpTT04ucGFyc2Uob3B0aW9ucy5qc29uTWVhbEluZm8pO1xuICAgICAgICAvLyAodGhpcyBhcyBhbnkpLnNldERhdGEoe21lYWxJbmZvOm1lYWxJbmZvfSwoKT0+e1xuICAgICAgICAvLyAgICAgY29uc29sZS5sb2codGhpcy5kYXRhLm1lYWxJbmZvKVxuICAgICAgICAvLyB9KVxuICAgICAgICB0aGlzLmdldEZvb2RVbml0T3B0aW9uTGlzdCgpO1xuICAgIH1cbiAgICAgLyoqXG4gICAgICog5bGV56S6cGlja2Vy77yM6YCJ5oup6aOf54mp5Y2V5L2NXG4gICAgICovXG4gICAgcHVibGljIGhhbmRsZVNob3dQaWNrZXIoZTphbnkpe1xuICAgICAgICBjb25zdCBwaWNrZXJJbmRleCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnBpY2tlckluZGV4O1xuICAgICAgICBpZihwaWNrZXJJbmRleD09PSdwZXJzb24nKXsgLy/lhbHmnInlh6DkuKrkurrpo5/nlKhcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbnMgPSBbMSwyLDMsNCw1LDZdXG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgY29uc3QgY29sdW1ucyA9IHRoaXMuZGF0YS51bml0QXJyW3BpY2tlckluZGV4XS51bml0T3B0aW9uLm1hcChpdGVtPT5pdGVtLnVuaXROYW1lKVxuICAgICAgICB9XG4gICAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7XG4gICAgICAgICAgICBjb2x1bW5zOmNvbHVtbnMsXG4gICAgICAgICAgICBwaWNrZXJJbmRleDpwaWNrZXJJbmRleCxcbiAgICAgICAgICAgIHNob3dQaWNrZXI6dHJ1ZSxcbiAgICAgICAgICAgIHNob3dQb3B1cDpmYWxzZVxuICAgICAgICB9KVxuICAgIH1cbiAgICBwdWJsaWMgb25Db25maXJtKCl7XG4gICAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7c2hvd1BpY2tlcjpmYWxzZSxzaG93UG9wdXA6dHJ1ZX0pXG4gICAgfVxuICAgIHB1YmxpYyBvbkNoYW5nZShlOmFueSl7XG4gICAgICAgIGNvbnN0IGNob29zZVVuaXRJbmRleDpudW1iZXIgPSBlLmRldGFpbC5pbmRleDtcbiAgICAgICAgaWYodGhpcy5kYXRhLnBpY2tlckluZGV4PT09J3BlcnNvbicpe1xuICAgICAgICAgICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtjaG9vc2VQZXJzb25OdW1JbmRleCA6IGNob29zZVVuaXRJbmRleH0sKCk9PntcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2hvb3NlUGVyc29uTnVtSW5kZXg9PT0nLHRoaXMuZGF0YS5jaG9vc2VQZXJzb25OdW1JbmRleClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdGhpcy5kYXRhLnVuaXRBcnJbdGhpcy5kYXRhLnBpY2tlckluZGV4XS5jaG9vc2VVbml0SW5kZXggPSBjaG9vc2VVbml0SW5kZXg7XG4gICAgICAgICAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe3VuaXRBcnI6dGhpcy5kYXRhLnVuaXRBcnJ9LCgpPT57XG4gICAgICAgICAgICAgICAgdGhpcy50b3RhbEVuZXJneSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIOivt+axguaJgOacieWNleS9je+8jOS7peS+m3BpY2tlcuS9v+eUqFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRGb29kVW5pdE9wdGlvbkxpc3QoKXtcbiAgICAgICAgY29uc3QgcmVxID0gdGhpcy5kYXRhLnRhZ2dzLm1hcChpdGVtPT57XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGZvb2RJZDppdGVtLmZvb2RJZCxcbiAgICAgICAgICAgICAgICBmb29kVHlwZTppdGVtLmZvb2RUeXBlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIHJlcXVlc3QuZ2V0Rm9vZFVuaXRPcHRpb25MaXN0KHtmb29kVW5pdE9wdGlvbkxpc3Q6cmVxfSkudGhlbihyZXM9PntcbiAgICAgICAgICAgIHJlcy5tYXAoaXRlbT0+e1xuICAgICAgICAgICAgICAgIGl0ZW0uY2hvb3NlVW5pdEluZGV4ID0gMFxuICAgICAgICAgICAgICAgIGl0ZW0uYW1vdW50ID0gMTAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxldCB1bml0QXJyID0gWy4uLnJlc107XG4gICAgICAgICAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoeyB1bml0QXJyOnVuaXRBcnIgfSwoKT0+e1xuICAgICAgICAgICAgICAgIHRoaXMudG90YWxFbmVyZ3koKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSkuY2F0Y2goZXJyPT57XG4gICAgICAgICAgICB3eC5zaG93VG9hc3Qoe3RpdGxlOmVyci5tc2csaWNvbjonbm9uZSd9KVxuICAgICAgICB9KVxuICAgIH1cbiAgICAvKipcbiAgICAgKiDnlKjmiLfovpPlhaXliIbph49cbiAgICAgKi9cbiAgICBwdWJsaWMgaGFuZGxlQW1vdW50SW5wdXQoZTphbnkpe1xuICAgICAgICBjb25zdCBpbnB1dEluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5wdXRJbmRleDtcbiAgICAgICAgbGV0IHsgdmFsdWUgfSA9IGUuZGV0YWlsO1xuICAgICAgICB2YWx1ZSA9IHBhcnNlSW50KHZhbHVlKTtcbiAgICAgICAgdGhpcy5kYXRhLnVuaXRBcnJbaW5wdXRJbmRleF0uYW1vdW50ID0gMTAwKnZhbHVlO1xuICAgICAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe3VuaXRBcnI6dGhpcy5kYXRhLnVuaXRBcnJ9LCgpPT57XG4gICAgICAgICAgICB0aGlzLnRvdGFsRW5lcmd5KClcbiAgICAgICAgfSlcbiAgICB9XG4gICAgcHVibGljIGhhbmRsZUFtb3VudElucHV0Rm9jdXMoZTphbnkpe1xuICAgICAgICBjb25zdCBpbnB1dEluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5wdXRJbmRleDtcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmRhdGEudW5pdEFycltpbnB1dEluZGV4XTtcbiAgICAgICAgaXRlbS5mb2N1c0Ftb3VudCA9IGl0ZW0uYW1vdW50O1xuICAgICAgICBpdGVtLmFtb3VudCA9IDA7XG4gICAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7dW5pdEFycjp0aGlzLmRhdGEudW5pdEFycn0pXG4gICAgfVxuICAgIHB1YmxpYyBoYW5kbGVBbW91bnRJbnB1dEJsdXIoZTphbnkpe1xuICAgICAgICBjb25zdCBpbnB1dEluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5wdXRJbmRleDtcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmRhdGEudW5pdEFycltpbnB1dEluZGV4XTtcbiAgICAgICAgaWYoaXRlbS5hbW91bnQ9PTApe1xuICAgICAgICAgICAgZGVidWdnZXJcbiAgICAgICAgICAgIGl0ZW0uYW1vdW50ID0gaXRlbS5mb2N1c0Ftb3VudDtcbiAgICAgICAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7dW5pdEFycjp0aGlzLmRhdGEudW5pdEFycn0pXG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICog6K6h566X54Ot6YeP5oC75YC8XG4gICAgICovXG4gICAgcHVibGljIHRvdGFsRW5lcmd5KCl7XG4gICAgICAgIGxldCB1bml0QXJyID0gdGhpcy5kYXRhLnVuaXRBcnJcbiAgICAgICAgbGV0IHRvdGFsRW5lcmd5ID0gdW5pdEFyci5yZWR1Y2UoKHByZSxuZXh0KT0+e1xuICAgICAgICAgICAgcmV0dXJuIG5leHQuYW1vdW50LzEwMCAqIG5leHQudW5pdE9wdGlvbltuZXh0LmNob29zZVVuaXRJbmRleF0uZW5lcmd5K3ByZVxuICAgICAgICB9LDApO1xuICAgICAgICB0b3RhbEVuZXJneSA9IE1hdGgucm91bmQodG90YWxFbmVyZ3kpO1xuICAgICAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe3RvdGFsRW5lcmd5OnRvdGFsRW5lcmd5fSlcbiAgICB9XG4gICAgLyoqXG4gICAgICog6Lez6L2s5Yiw5YiG6YeP5Lyw566X6aG16Z2iXG4gICAgICovXG4gICAgcHVibGljIGhhbmRsZUdvV2VpZ2h0UmVmZXJlbmNlUGFnZSgpe1xuICAgICAgICB3eC5uYXZpZ2F0ZVRvKHsgdXJsOiAnLi8uLi93ZWlnaHRSZWZlcmVuY2UvaW5kZXgnIH0pXG4gICAgfVxufVxuXG5QYWdlKG5ldyBDb25maXJtTWVhbCgpKTsiXX0=