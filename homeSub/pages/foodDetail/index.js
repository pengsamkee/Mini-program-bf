"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var webAPI = require("../../../api/app/AppService");
var globalEnum = require("../../../api/GlobalEnum");
var chart = null;
var data = [];
function initChart(canvas, width, height, F2) {
    var map = {};
    data.forEach(function (obj) {
        console.log(obj);
        if (obj.name === '蛋白质') {
            if (obj.percent > 9) {
                return map[obj.name] = "       " + obj.percent + '%' + "    " + obj.content + obj.unit;
            }
            else {
                return map[obj.name] = "       " + obj.percent + '%' + "      " + obj.content + obj.unit;
            }
        }
        else if (obj.name === '脂肪') {
            if (obj.percent > 9) {
                return map[obj.name] = "          " + obj.percent + '%' + "    " + obj.content + obj.unit;
            }
            else {
                return map[obj.name] = "          " + obj.percent + '%' + "      " + obj.content + obj.unit;
            }
        }
        else {
            if (obj.percent > 9) {
                return map[obj.name] = "   " + obj.percent + '%' + "    " + obj.content + obj.unit;
            }
            else {
                return map[obj.name] = "   " + obj.percent + '%' + "      " + obj.content + obj.unit;
            }
        }
    });
    chart = new F2.Chart({
        el: canvas,
        width: width,
        height: height
    });
    chart.source(data, {
        percent: {
            formatter: function formatter(val) {
                return val + '%';
            }
        }
    });
    chart.tooltip(false);
    chart.legend({
        position: 'right',
        itemFormatter: function itemFormatter(val) {
            return val + ' ' + map[val];
        }
    });
    chart.coord('polar', {
        transposed: true,
        innerRadius: 0.7,
        radius: 1
    });
    chart.axis(false);
    chart.interval()
        .position('a*percent')
        .color('name', ['#FFB400', '#FF5C47', '#FF822D'])
        .adjust('stack');
    chart.render();
    return chart;
}
var FoodDetail = (function () {
    function FoodDetail() {
        this.mealId = -1;
        this.mealDate = 0;
        this.mealType = 0;
        this.divideproportion = 0;
        this.data = {
            currentTagIndex: 0,
            taggs: [{
                    bboxH: 100,
                    bboxW: 91,
                    bboxX: 0,
                    bboxY: 193,
                    foodId: 12,
                    foodName: "牛奶椰丝小方糕",
                    foodType: 2,
                    isDeleted: false,
                    resultList: [
                        { foodId: 836, foodName: "牛奶椰丝小方糕", foodType: 1 },
                        { foodId: 456, foodType: 2, foodName: "橙", score: 1 },
                        { foodId: 492, foodType: 2, foodName: "哈密瓜", score: 1 },
                        { foodId: 1321, foodType: 2, foodName: "橙汁", score: 0 },
                        { foodId: 1322, foodType: 2, foodName: "柠檬汽水", score: 0 },
                        { foodId: 362, foodType: 2, foodName: "长把梨", score: 0 },
                        { foodId: 454, foodType: 2, foodName: "中华猕猴桃[毛叶猕猴桃,奇异果]", score: 0 }
                    ],
                    selectedPos: 0,
                    showDeleteBtn: false,
                    tagHeight: 95,
                    tagX: 33.75,
                    tagY: 182.25,
                },
                {
                    bboxH: 178,
                    bboxW: 201,
                    bboxX: 309,
                    bboxY: 104,
                    foodId: 14,
                    foodName: "牛奶雪糕",
                    foodType: 2,
                    isDeleted: false,
                    resultList: [
                        { foodId: 830, foodName: "牛奶雪糕", foodType: 1 },
                        { foodId: 220, foodType: 1, foodName: "香油鸡蛋羹", score: 33 },
                        { foodId: 5, foodType: 1, foodName: "紫菜蛋汤", score: 26 },
                        { foodId: 300, foodType: 1, foodName: "豆腐海带汤", score: 26 },
                        { foodId: 162, foodType: 1, foodName: "大饼", score: 14 },
                        { foodId: 244, foodType: 1, foodName: "玉米面饼", score: 14 },
                        { foodId: 671, foodType: 1, foodName: "清炖鸡", score: 5 }
                    ],
                    selectedPos: 0,
                    showDeleteBtn: false,
                    tagHeight: 65,
                    tagX: 306.7,
                    tagY: 144.7,
                }],
            imageUrl: "",
            pixelRatio: 2,
            imageWidth: 0,
            imageHeight: 0,
        };
    }
    FoodDetail.prototype.onLoad = function (option) {
        var that = this;
        option.imageUrl = 'https://dietlens-1258665547.cos.ap-shanghai.myqcloud.com/food-image/wx4714ce5383005530.o6zAJs0hy6nHM2owj6wIkyE1hfKg.N2j1od6jBhfF991b7dbdd5c73940a1d94b72bd21d2e6.jpeg';
        webAPI.SetAuthToken(wx.getStorageSync(globalEnum.globalKey_token));
        this.setData({ imageUrl: option.imageUrl });
        this.mealType = parseInt(option.mealType);
        this.mealDate = parseInt(option.mealDate);
        var imagePath = option.imageUrl.split("/").pop();
        this.getRecognitionResult(imagePath);
        wx.getImageInfo({
            src: option.imageUrl,
            success: function (res) {
                if (res.height / res.width > 0.96) {
                    that.divideproportion = res.height / 720;
                    that.setData({
                        imageHeight: 720,
                        imageWidth: res.width * 720 / res.height
                    });
                }
                else {
                    that.divideproportion = res.width / 750;
                    that.setData({
                        imageWidth: 750,
                        imageHeight: res.height * 720 / res.width
                    });
                }
            }
        });
    };
    FoodDetail.prototype.onReady = function () {
        this.setCanvasValue();
    };
    FoodDetail.prototype.setCanvasValue = function () {
        var that = this;
        data = [
            { name: "蛋白质", percent: 30, content: 200, unit: '克' },
            { name: "脂肪", percent: 40, content: 300, unit: '吨' },
            { name: "碳水化物", percent: 30, content: 400, unit: '千克' }
        ];
        var salesTrendChartComponent = that.selectComponent('#canvasf2');
        salesTrendChartComponent.init(initChart);
    };
    FoodDetail.prototype.getRecognitionResult = function (imageKey) {
        var that = this;
        wx.showLoading({ title: "识别中...", mask: true });
        var req = { img_key: imageKey, meal_date: this.mealDate, meal_type: this.mealType };
        webAPI.RetrieveRecognition(req).then(function (resp) {
            that.parseRecognitionData(resp);
            wx.hideLoading({});
        }).catch(function (err) {
            wx.hideLoading({});
            wx.showModal({
                title: '获取识别结果失败',
                content: JSON.stringify(err),
                showCancel: false
            });
        });
    };
    FoodDetail.prototype.parseRecognitionData = function (resp) {
        var _this = this;
        var taggs = [];
        for (var index in resp.prediction) {
            var predictionItem = resp.prediction[index];
            var resultList = resp.prediction[index].result_list;
            var item = {
                tagX: predictionItem.tag_x / (this.divideproportion * 2),
                tagY: predictionItem.tag_y / (this.divideproportion * 2),
                bboxX: predictionItem.bbox_x,
                bboxY: predictionItem.bbox_y,
                bboxW: predictionItem.bbox_w,
                bboxH: predictionItem.bbox_h,
                foodId: predictionItem.food_id,
                foodType: predictionItem.food_type,
                foodName: predictionItem.food_name,
                tagHeight: index == 0 ? 95 : 65,
                selectedPos: 0,
                isDeleted: false,
                showDeleteBtn: false,
                resultList: resultList
            };
            taggs.push(item);
        }
        this.mealId = resp.meal_id;
        this.mealId = 20361;
        this.setData({
            taggs: taggs
        }, function () {
            console.log('整理得到初始taggs', _this.data.taggs);
        });
    };
    FoodDetail.prototype.handleDeleteTag = function (e) {
        var index = e.currentTarget.dataset.textIndex;
        var taggs = this.data.taggs.slice();
        taggs.splice(index, 1);
        this.setData({ taggs: taggs });
    };
    FoodDetail.prototype.onTagMove = function (event) {
        var _a;
        var index = event.currentTarget.dataset.tagIndex;
        var xOperation = "taggs[" + index + "].tag_x";
        var yOperation = "taggs[" + index + "].tag_y";
        this.setData((_a = {},
            _a[xOperation] = event.detail.x,
            _a[yOperation] = event.detail.y,
            _a));
    };
    FoodDetail.prototype.handleGoSharePage = function () {
        wx.navigateTo({ url: "/pages/foodShare/index?mealId=" + this.mealId });
    };
    return FoodDetail;
}());
Page(new FoodDetail());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG9EQUFzRDtBQUV0RCxvREFBc0Q7QUFFdEQsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDO0FBQ2pCLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztBQUNkLFNBQVMsU0FBUyxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUU7SUFDMUMsSUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ2YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFTLEdBQUc7UUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUNoQixJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUcsS0FBSyxFQUFDO1lBQ25CLElBQUcsR0FBRyxDQUFDLE9BQU8sR0FBQyxDQUFDLEVBQUM7Z0JBQ2YsT0FBTyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLFNBQVMsR0FBRSxHQUFHLENBQUMsT0FBTyxHQUFHLEdBQUcsR0FBRyxNQUFNLEdBQUcsR0FBRyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO2FBQ3ZGO2lCQUFJO2dCQUNILE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxTQUFTLEdBQUUsR0FBRyxDQUFDLE9BQU8sR0FBRyxHQUFHLEdBQUUsUUFBUSxHQUFHLEdBQUcsQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQzthQUN4RjtTQUNGO2FBQUssSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLElBQUksRUFBRTtZQUMzQixJQUFHLEdBQUcsQ0FBQyxPQUFPLEdBQUMsQ0FBQyxFQUFDO2dCQUNmLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxZQUFZLEdBQUUsR0FBRyxDQUFDLE9BQU8sR0FBRyxHQUFHLEdBQUcsTUFBTSxHQUFHLEdB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USxHQUFHLEtBQUssR0FBRyxTQUFTLENBQUM7UUFDOUMsSUFBSSxVQUFVLEdBQUcsUUFBUSxHQUFHLEtBQUssR0FBRyxTQUFTLENBQUM7UUFDN0MsSUFBWSxDQUFDLE9BQU87WUFDbkIsR0FBQyxVQUFVLElBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzVCLEdBQUMsVUFBVSxJQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDNUIsQ0FBQztJQUNMLENBQUM7SUFLTSxzQ0FBaUIsR0FBeEI7UUFDRSxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUMsR0FBRyxFQUFFLG1DQUFpQyxJQUFJLENBQUMsTUFBUSxFQUFDLENBQUMsQ0FBQztJQUV2RSxDQUFDO0lBQ0gsaUJBQUM7QUFBRCxDQUFDLEFBN0xELElBNkxDO0FBRUQsSUFBSSxDQUFDLElBQUksVUFBVSxFQUFFLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHdlYkFQSSBmcm9tICcuLi8uLi8uLi9hcGkvYXBwL0FwcFNlcnZpY2UnO1xuaW1wb3J0IHsgUmV0cmlldmVSZWNvZ25pdGlvblJlcSwgUmV0cmlldmVSZWNvZ25pdGlvblJlc3AgfSBmcm9tIFwiL2FwaS9hcHAvQXBwU2VydmljZU9ianNcIjtcbmltcG9ydCAqIGFzIGdsb2JhbEVudW0gZnJvbSAnLi4vLi4vLi4vYXBpL0dsb2JhbEVudW0nO1xuXG5sZXQgY2hhcnQgPSBudWxsO1xubGV0IGRhdGEgPSBbXTtcbmZ1bmN0aW9uIGluaXRDaGFydChjYW52YXMsIHdpZHRoLCBoZWlnaHQsIEYyKSB7IC8vIOS9v+eUqCBGMiDnu5jliLblm77ooahcbiAgY29uc3QgbWFwID0ge307XG4gIGRhdGEuZm9yRWFjaChmdW5jdGlvbihvYmopIHtcbiAgICBjb25zb2xlLmxvZyhvYmopXG4gICAgaWYgKG9iai5uYW1lPT09J+ibi+eZvei0qCcpe1xuICAgICAgaWYob2JqLnBlcmNlbnQ+OSl7XG4gICAgICAgIHJldHVybiBtYXBbb2JqLm5hbWVdID0gYCAgICAgICBgKyBvYmoucGVyY2VudCArICclJyArIGAgICAgYCArIG9iai5jb250ZW50ICsgb2JqLnVuaXQ7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgcmV0dXJuIG1hcFtvYmoubmFtZV0gPSBgICAgICAgIGArIG9iai5wZXJjZW50ICsgJyUnKyBgICAgICAgYCArIG9iai5jb250ZW50ICsgb2JqLnVuaXQ7XG4gICAgICB9XG4gICAgfWVsc2UgaWYgKG9iai5uYW1lID09PSAn6ISC6IKqJykge1xuICAgICAgaWYob2JqLnBlcmNlbnQ+OSl7XG4gICAgICAgIHJldHVybiBtYXBbb2JqLm5hbWVdID0gYCAgICAgICAgICBgKyBvYmoucGVyY2VudCArICclJyArIGAgICAgYCArIG9iai5jb250ZW50ICsgb2JqLnVuaXQ7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgcmV0dXJuIG1hcFtvYmoubmFtZV0gPSBgICAgICAgICAgIGArIG9iai5wZXJjZW50ICsgJyUnKyBgICAgICAgYCArIG9iai5jb250ZW50ICsgb2JqLnVuaXQ7XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICBpZihvYmoucGVyY2VudD45KXtcbiAgICAgICAgcmV0dXJuIG1hcFtvYmoubmFtZV0gPSBgICAgYCsgb2JqLnBlcmNlbnQgKyAnJScgKyBgICAgIGAgKyBvYmouY29udGVudCArIG9iai51bml0O1xuICAgICAgfWVsc2V7XG4gICAgICAgIHJldHVybiBtYXBbb2JqLm5hbWVdID0gYCAgIGArIG9iai5wZXJjZW50ICsgJyUnKyBgICAgICAgYCArIG9iai5jb250ZW50ICsgb2JqLnVuaXQ7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgY2hhcnQgPSBuZXcgRjIuQ2hhcnQoe1xuICAgIGVsOiBjYW52YXMsXG4gICAgd2lkdGgsXG4gICAgaGVpZ2h0XG4gIH0pO1xuICBjaGFydC5zb3VyY2UoZGF0YSwge1xuICAgIHBlcmNlbnQ6IHtcbiAgICAgIGZvcm1hdHRlcjogZnVuY3Rpb24gZm9ybWF0dGVyKHZhbCkge1xuICAgICAgICByZXR1cm4gdmFsICsgJyUnO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIGNoYXJ0LnRvb2x0aXAoZmFsc2UpO1xuICBjaGFydC5sZWdlbmQoe1xuICAgIHBvc2l0aW9uOiAncmlnaHQnLFxuICAgIGl0ZW1Gb3JtYXR0ZXI6IGZ1bmN0aW9uIGl0ZW1Gb3JtYXR0ZXIodmFsKSB7XG4gICAgICByZXR1cm4gdmFsICsgJyAnICsgbWFwW3ZhbF07XG4gICAgfVxuICB9KTtcbiAgY2hhcnQuY29vcmQoJ3BvbGFyJywge1xuICAgIHRyYW5zcG9zZWQ6IHRydWUsXG4gICAgaW5uZXJSYWRpdXM6IDAuNyxcbiAgICByYWRpdXM6IDFcbiAgfSk7XG4gIGNoYXJ0LmF4aXMoZmFsc2UpO1xuICBjaGFydC5pbnRlcnZhbCgpXG4gICAgLnBvc2l0aW9uKCdhKnBlcmNlbnQnKVxuICAgIC5jb2xvcignbmFtZScsIFsnI0ZGQjQwMCcsICcjRkY1QzQ3JywgJyNGRjgyMkQnXSlcbiAgICAuYWRqdXN0KCdzdGFjaycpO1xuICBjaGFydC5yZW5kZXIoKTtcbiAgcmV0dXJuIGNoYXJ0O1xufVxuXG50eXBlIERhdGEgPSB7XG4gIGN1cnJlbnRUYWdJbmRleDogbnVtYmVyO1xuICB0YWdnczogVGFnW107XG4gIGltYWdlVXJsOiBzdHJpbmc7XG4gIHBpeGVsUmF0aW86IG51bWJlcjtcbiAgaGlkZUJhbm5lcjogYm9vbGVhbjtcbiAgaW1hZ2VXaWR0aDpudW1iZXI7XG4gIGltYWdlSGVpZ2h0Om51bWJlcjtcbn1cbnR5cGUgVGFnID0ge1xuICBpc0RlbGV0ZWQ6IGJvb2xlYW47XG4gIHRhZ194OiBudW1iZXI7XG4gIHRhZ195OiBudW1iZXI7XG4gIGJib3hfeDpudW1iZXI7XG4gIGJib3hfeTogbnVtYmVyO1xuICBiYm94X3c6IG51bWJlcjtcbiAgYmJveF9oOiBudW1iZXI7XG4gIHRhZ19oZWlnaHQ6IG51bWJlcjtcbiAgZm9vZF90eXBlOiBudW1iZXI7ICAvLzEucmVjZWlwZSAyLiByZWNlaXBlXG4gIHRhZ1R5cGU6IG51bWJlcjsgLy8xIHJlY29nbml0aW9uLCAyIHRleHRTZWFyY2ggMy5hZGRpdGlvbmFsU2VhcmNoXG4gIHNob3dEZWxldGVCdG46IGZhbHNlO1xuICBzZWxlY3RlZFBvczogbnVtYmVyO1xuICByZXN1bHRfbGlzdDogUmVzdWx0W107XG59XG5cbmNsYXNzIEZvb2REZXRhaWwge1xuICBwdWJsaWMgbWVhbElkID0gLTE7IC8vIOW+l+WIsHRhZ2dz5L+h5oGv5o6l5Y+j5Lit6L+U5ZueXG4gIHB1YmxpYyBtZWFsRGF0ZSA9IDA7IC8vIOS4iuS4qumhtemdouS8oOmAkuadpeeahFxuICBwdWJsaWMgbWVhbFR5cGUgPSAwOyAvLyDkuIrkuKrpobXpnaLkvKDpgJLmnaXnmoRcbiAgcHVibGljIGRpdmlkZXByb3BvcnRpb249MDsvL+ecn+WunuWuveW6pumZpOS7pTcyMHJweO+8m1xuICBwdWJsaWMgZGF0YTogRGF0YSA9IHtcbiAgICBjdXJyZW50VGFnSW5kZXg6IDAsXG4gICAgdGFnZ3M6W3tcbiAgICAgIGJib3hIOiAxMDAsXG4gICAgICBiYm94VzogOTEsXG4gICAgICBiYm94WDogMCxcbiAgICAgIGJib3hZOiAxOTMsXG4gICAgICBmb29kSWQ6IDEyLFxuICAgICAgZm9vZE5hbWU6IFwi54mb5aW25qSw5Lid5bCP5pa557OVXCIsXG4gICAgICBmb29kVHlwZTogMixcbiAgICAgIGlzRGVsZXRlZDogZmFsc2UsXG4gICAgICByZXN1bHRMaXN0OiBbXG4gICAgICAgICAge2Zvb2RJZDogODM2LCBmb29kTmFtZTogXCLniZvlpbbmpLDkuJ3lsI/mlrnns5VcIiwgZm9vZFR5cGU6IDF9LFxuICAgICAgICAgIHtmb29kSWQ6IDQ1NiwgZm9vZFR5cGU6IDIsIGZvb2ROYW1lOiBcIuapmVwiLCBzY29yZTogMX0sXG4gICAgICAgICAge2Zvb2RJZDogNDkyLCBmb29kVHlwZTogMiwgZm9vZE5hbWU6IFwi5ZOI5a+G55OcXCIsIHNjb3JlOiAxfSxcbiAgICAgICAgICB7Zm9vZElkOiAxMzIxLCBmb29kVHlwZTogMiwgZm9vZE5hbWU6IFwi5qmZ5rGBXCIsIHNjb3JlOiAwfSxcbiAgICAgICAgICB7Zm9vZElkOiAxMzIyLCBmb29kVHlwZTogMiwgZm9vZE5hbWU6IFwi5p+g5qqs5rG95rC0XCIsIHNjb3JlOiAwfSxcbiAgICAgICAgICB7Zm9vZElkOiAzNjIsIGZvb2RUeXBlOiAyLCBmb29kTmFtZTogXCLplb/miormoqhcIiwgc2NvcmU6IDB9LFxuICAgICAgICAgIHtmb29kSWQ6IDQ1NCwgZm9vZFR5cGU6IDIsIGZvb2ROYW1lOiBcIuS4reWNjueMleeMtOahg1vmr5vlj7bnjJXnjLTmoYMs5aWH5byC5p6cXVwiLCBzY29yZTogMH1cbiAgICAgIF0sXG4gICAgICBzZWxlY3RlZFBvczogMCxcbiAgICAgIHNob3dEZWxldGVCdG46IGZhbHNlLFxuICAgICAgdGFnSGVpZ2h0OiA5NSxcbiAgICAgIHRhZ1g6IDMzLjc1LFxuICAgICAgdGFnWTogMTgyLjI1LFxuICB9LFxuICB7XG4gICAgICBiYm94SDogMTc4LFxuICAgICAgYmJveFc6IDIwMSxcbiAgICAgIGJib3hYOiAzMDksXG4gICAgICBiYm94WTogMTA0LFxuICAgICAgZm9vZElkOiAxNCxcbiAgICAgIGZvb2ROYW1lOiBcIueJm+WltumbquezlVwiLFxuICAgICAgZm9vZFR5cGU6IDIsXG4gICAgICBpc0RlbGV0ZWQ6IGZhbHNlLFxuICAgICAgcmVzdWx0TGlzdDogW1xuICAgICAgICAgIHtmb29kSWQ6IDgzMCwgZm9vZE5hbWU6IFwi54mb5aW26Zuq57OVXCIsIGZvb2RUeXBlOiAxfSxcbiAgICAgICAgICB7Zm9vZElkOiAyMjAsIGZvb2RUeXBlOiAxLCBmb29kTmFtZTogXCLpppnmsrnpuKHom4vnvrlcIiwgc2NvcmU6IDMzfSxcbiAgICAgICAgICB7Zm9vZElkOiA1LCBmb29kVHlwZTogMSwgZm9vZE5hbWU6IFwi57Sr6I+c6JuL5rGkXCIsIHNjb3JlOiAyNn0sXG4gICAgICAgICAge2Zvb2RJZDogMzAwLCBmb29kVHlwZTogMSwgZm9vZE5hbWU6IFwi6LGG6IWQ5rW35bim5rGkXCIsIHNjb3JlOiAyNn0sXG4gICAgICAgICAge2Zvb2RJZDogMTYyLCBmb29kVHlwZTogMSwgZm9vZE5hbWU6IFwi5aSn6aW8XCIsIHNjb3JlOiAxNH0sXG4gICAgICAgICAge2Zvb2RJZDogMjQ0LCBmb29kVHlwZTogMSwgZm9vZE5hbWU6IFwi546J57Gz6Z2i6aW8XCIsIHNjb3JlOiAxNH0sXG4gICAgICAgICAge2Zvb2RJZDogNjcxLCBmb29kVHlwZTogMSwgZm9vZE5hbWU6IFwi5riF54KW6bihXCIsIHNjb3JlOiA1fVxuICAgICAgXSxcbiAgICAgIHNlbGVjdGVkUG9zOiAwLFxuICAgICAgc2hvd0RlbGV0ZUJ0bjogZmFsc2UsXG4gICAgICB0YWdIZWlnaHQ6IDY1LFxuICAgICAgdGFnWDogMzA2LjcsXG4gICAgICB0YWdZOiAxNDQuNyxcbiAgfV0sXG4gICAgaW1hZ2VVcmw6IFwiXCIsXG4gICAgcGl4ZWxSYXRpbzogMixcbiAgICBpbWFnZVdpZHRoOjAsXG4gICAgaW1hZ2VIZWlnaHQ6MCxcbiAgfVxuXG4gIHB1YmxpYyBvbkxvYWQob3B0aW9uOiBhbnkpIHtcbiAgICB2YXIgdGhhdDphbnkgPSB0aGlzO1xuICAgIG9wdGlvbi5pbWFnZVVybD0naHR0cHM6Ly9kaWV0bGVucy0xMjU4NjY1NTQ3LmNvcy5hcC1zaGFuZ2hhaS5teXFjbG91ZC5jb20vZm9vZC1pbWFnZS93eDQ3MTRjZTUzODMwMDU1MzAubzZ6QUpzMGh5Nm5ITTJvd2o2d0lreUUxaGZLZy5OMmoxb2Q2akJoZkY5OTFiN2RiZGQ1YzczOTQwYTFkOTRiNzJiZDIxZDJlNi5qcGVnJ1xuICAgIHdlYkFQSS5TZXRBdXRoVG9rZW4od3guZ2V0U3RvcmFnZVN5bmMoZ2xvYmFsRW51bS5nbG9iYWxLZXlfdG9rZW4pKTsgXG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHsgaW1hZ2VVcmw6IG9wdGlvbi5pbWFnZVVybCB9KTtcbiAgICB0aGlzLm1lYWxUeXBlID0gcGFyc2VJbnQob3B0aW9uLm1lYWxUeXBlKTtcbiAgICB0aGlzLm1lYWxEYXRlID0gcGFyc2VJbnQob3B0aW9uLm1lYWxEYXRlKTtcbiAgICB2YXIgaW1hZ2VQYXRoID0gb3B0aW9uLmltYWdlVXJsLnNwbGl0KFwiL1wiKS5wb3AoKTtcbiAgICB0aGlzLmdldFJlY29nbml0aW9uUmVzdWx0KGltYWdlUGF0aCk7XG4gICAgd3guZ2V0SW1hZ2VJbmZvKHtcbiAgICAgIHNyYzogb3B0aW9uLmltYWdlVXJsLFxuICAgICAgc3VjY2VzcyhyZXMpIHtcbiAgICAgICAgaWYocmVzLmhlaWdodC9yZXMud2lkdGg+MC45Nil7IC8vIOmrmOWbvlxuICAgICAgICAgIHRoYXQuZGl2aWRlcHJvcG9ydGlvbiA9IHJlcy5oZWlnaHQgLyA3MjBcbiAgICAgICAgICB0aGF0LnNldERhdGEoe1xuICAgICAgICAgICAgaW1hZ2VIZWlnaHQ6NzIwLFxuICAgICAgICAgICAgaW1hZ2VXaWR0aDogcmVzLndpZHRoICogNzIwIC8gcmVzLmhlaWdodFxuICAgICAgICAgIH0pXG4gICAgICAgIH1lbHNleyAvLyDlrr3lm75cbiAgICAgICAgICB0aGF0LmRpdmlkZXByb3BvcnRpb24gPSByZXMud2lkdGggLyA3NTBcbiAgICAgICAgICB0aGF0LnNldERhdGEoe1xuICAgICAgICAgICAgaW1hZ2VXaWR0aDogNzUwLFxuICAgICAgICAgICAgaW1hZ2VIZWlnaHQ6IHJlcy5oZWlnaHQgKiA3MjAgLyByZXMud2lkdGhcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfVxuICBvblJlYWR5KCl7XG4gICAgdGhpcy5zZXRDYW52YXNWYWx1ZSgpO1xuICB9XG4gIC8qKlxuICAgKuS4umNhbnZhc+i1i+WAvFxuICAgKi9cbiAgc2V0Q2FudmFzVmFsdWUoKXtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBkYXRhID0gW1xuICAgICAgeyBuYW1lOlwi6JuL55m96LSoXCIsIHBlcmNlbnQ6MzAsIGNvbnRlbnQ6MjAwLCB1bml0OiflhYsnIH0sXG4gICAgICB7IG5hbWU6XCLohILogqpcIiwgcGVyY2VudDo0MCwgY29udGVudDozMDAsIHVuaXQ6J+WQqCcgfSxcbiAgICAgIHsgbmFtZTpcIueis+awtOWMlueJqVwiLCBwZXJjZW50OjMwLCBjb250ZW50OjQwMCwgdW5pdDon5Y2D5YWLJyB9XG4gICAgXTtcbiAgICBsZXQgc2FsZXNUcmVuZENoYXJ0Q29tcG9uZW50ID0gdGhhdC5zZWxlY3RDb21wb25lbnQoJyNjYW52YXNmMicpO1xuICAgIHNhbGVzVHJlbmRDaGFydENvbXBvbmVudC5pbml0KGluaXRDaGFydClcbiAgfVxuXG4vKipcbiAqIOWPkeWHuuivhuWIq+WbvueJh+S4remjn+eJqeeahGFwaVxuICovXG4gIHB1YmxpYyBnZXRSZWNvZ25pdGlvblJlc3VsdChpbWFnZUtleTogU3RyaW5nKSB7XG4gICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6IFwi6K+G5Yir5LitLi4uXCIsIG1hc2s6IHRydWUgfSk7XG4gICAgbGV0IHJlcTogUmV0cmlldmVSZWNvZ25pdGlvblJlcSA9IHsgaW1nX2tleTogaW1hZ2VLZXksIG1lYWxfZGF0ZTogdGhpcy5tZWFsRGF0ZSwgbWVhbF90eXBlOiB0aGlzLm1lYWxUeXBlIH07XG4gICAgd2ViQVBJLlJldHJpZXZlUmVjb2duaXRpb24ocmVxKS50aGVuKHJlc3AgPT4ge1xuICAgICAgdGhhdC5wYXJzZVJlY29nbml0aW9uRGF0YShyZXNwKTtcbiAgICAgIHd4LmhpZGVMb2FkaW5nKHt9KTtcbiAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgd3guaGlkZUxvYWRpbmcoe30pO1xuICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICB0aXRsZTogJ+iOt+WPluivhuWIq+e7k+aenOWksei0pScsXG4gICAgICAgICAgY29udGVudDogSlNPTi5zdHJpbmdpZnkoZXJyKSxcbiAgICAgICAgICBzaG93Q2FuY2VsOiBmYWxzZVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog6Kej5p6Q6L+U5Zue55qE5pWw5o2uXG4gICAqL1xuICBwdWJsaWMgcGFyc2VSZWNvZ25pdGlvbkRhdGEocmVzcDogUmV0cmlldmVSZWNvZ25pdGlvblJlc3ApIHtcbiAgICBsZXQgdGFnZ3MgPSBbXTtcbiAgICBmb3IgKGxldCBpbmRleCBpbiByZXNwLnByZWRpY3Rpb24pIHtcbiAgICAgIGxldCBwcmVkaWN0aW9uSXRlbSA9IHJlc3AucHJlZGljdGlvbltpbmRleF07XG4gICAgICBsZXQgcmVzdWx0TGlzdCA9IHJlc3AucHJlZGljdGlvbltpbmRleF0ucmVzdWx0X2xpc3Q7XG4gICAgICBsZXQgaXRlbSA9IHtcbiAgICAgICAgdGFnWDogcHJlZGljdGlvbkl0ZW0udGFnX3ggLyAodGhpcy5kaXZpZGVwcm9wb3J0aW9uICogMiksXG4gICAgICAgIHRhZ1k6IHByZWRpY3Rpb25JdGVtLnRhZ195IC8gKHRoaXMuZGl2aWRlcHJvcG9ydGlvbiAqIDIpLFxuICAgICAgICBiYm94WDogcHJlZGljdGlvbkl0ZW0uYmJveF94LFxuICAgICAgICBiYm94WTogcHJlZGljdGlvbkl0ZW0uYmJveF95LFxuICAgICAgICBiYm94VzogcHJlZGljdGlvbkl0ZW0uYmJveF93LFxuICAgICAgICBiYm94SDogcHJlZGljdGlvbkl0ZW0uYmJveF9oLFxuICAgICAgICBmb29kSWQ6IHByZWRpY3Rpb25JdGVtLmZvb2RfaWQsXG4gICAgICAgIGZvb2RUeXBlOiBwcmVkaWN0aW9uSXRlbS5mb29kX3R5cGUsXG4gICAgICAgIGZvb2ROYW1lOiBwcmVkaWN0aW9uSXRlbS5mb29kX25hbWUsXG4gICAgICAgIHRhZ0hlaWdodDogaW5kZXggPT0gMCA/IDk1IDogNjUgLFxuICAgICAgICBzZWxlY3RlZFBvczogMCxcbiAgICAgICAgaXNEZWxldGVkOiBmYWxzZSxcbiAgICAgICAgc2hvd0RlbGV0ZUJ0bjogZmFsc2UsXG4gICAgICAgIHJlc3VsdExpc3Q6IHJlc3VsdExpc3RcbiAgICAgIH07XG4gICAgICB0YWdncy5wdXNoKGl0ZW0pO1xuICAgIH1cbiAgICB0aGlzLm1lYWxJZCA9IHJlc3AubWVhbF9pZDtcbiAgICB0aGlzLm1lYWxJZCA9IDIwMzYxO1xuICAgIC8vPT09PT09PT09PT095LiK6Z2i55qE6KaB5Yig5o6J6L+Z6KGMPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIHRhZ2dzOiB0YWdnc1xuICAgIH0sKCk9PntcbiAgICAgIGNvbnNvbGUubG9nKCfmlbTnkIblvpfliLDliJ3lp4t0YWdncycsdGhpcy5kYXRhLnRhZ2dzKVxuICAgIH0pO1xuICB9XG4gIFxuICAvKipcbiAgICog5Yig6Zmk5p+Q5Liq5a+55bqU55qEdGFnXG4gICAqL1xuICBwdWJsaWMgaGFuZGxlRGVsZXRlVGFnKGU6YW55KXtcbiAgICBjb25zdCBpbmRleCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnRleHRJbmRleDtcbiAgICBsZXQgdGFnZ3MgPSBbLi4udGhpcy5kYXRhLnRhZ2dzXTtcbiAgICB0YWdncy5zcGxpY2UoaW5kZXgsMSk7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHt0YWdnczp0YWdnc30pXG4gIH1cbiAgXG4gIHB1YmxpYyBvblRhZ01vdmUoZXZlbnQ6IGFueSkge1xuICAgIGxldCBpbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC50YWdJbmRleDtcbiAgICBsZXQgeE9wZXJhdGlvbiA9IFwidGFnZ3NbXCIgKyBpbmRleCArIFwiXS50YWdfeFwiO1xuICAgIGxldCB5T3BlcmF0aW9uID0gXCJ0YWdnc1tcIiArIGluZGV4ICsgXCJdLnRhZ195XCI7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIFt4T3BlcmF0aW9uXTogZXZlbnQuZGV0YWlsLngsXG4gICAgICBbeU9wZXJhdGlvbl06IGV2ZW50LmRldGFpbC55XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog54K55Ye75YiG5Lqr5oyJ6ZKu77yM5Y675YiG5Lqr6aG16Z2iXG4gICAqL1xuICBwdWJsaWMgaGFuZGxlR29TaGFyZVBhZ2UoKXtcbiAgICB3eC5uYXZpZ2F0ZVRvKHt1cmw6IGAvcGFnZXMvZm9vZFNoYXJlL2luZGV4P21lYWxJZD0ke3RoaXMubWVhbElkfWB9KTtcbiAgICAgIFxuICB9XG59XG5cblBhZ2UobmV3IEZvb2REZXRhaWwoKSk7Il19