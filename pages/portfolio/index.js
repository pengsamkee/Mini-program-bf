"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var globalEnum = require("../../api/GlobalEnum");
var moment = require("moment");
var app = getApp();
var webAPI = require("../../api/app/AppService");
var PortfolioPage = (function () {
    function PortfolioPage() {
        this.userInfo = {};
        this.data = {
            birthday: 2000,
            ageGroupIndex: 3,
            ageGroup: ['6个月以下', '6个月-1岁', '1-3岁', '3-4岁', '4-7岁', '7-10岁', '10-11岁', '11-14岁', '14-18岁', '18-30岁', '30-50岁', '50-60岁', '60-65岁', '65-80岁', '80岁以上'],
            genderIndex: 1,
            genderArray: ['男', '女'],
            preHeight: 170,
            height: 170,
            preCurrentWeight: 50,
            currentWeight: 50,
            weightBeforePreg: 60,
            pregnancyStatusIndex: 1,
            pregnancyStatusArray: ['都不是', '备孕', '已孕', '哺乳期'],
            activityLevelIndex: 1,
            activityLevelArray: ['卧床休息', '轻度,静坐少动', '中度,常常站立走动', '重度,负重', '剧烈，超负重'],
            pregnancyDate: {
                date: moment().format("YYYY-MM-DD"),
                year: moment().format("YYYY"),
                month: moment().format("MM"),
                day: moment().format("DD")
            },
        };
    }
    PortfolioPage.prototype.onTabItemTap = function (item) {
        wx.reportAnalytics('switch_tab', {
            tab_index: item.index,
            tab_pagepath: item.pagePath,
            tab_text: item.text
        });
    };
    PortfolioPage.prototype.onPullDownRefresh = function () {
        this.getProfileData();
    };
    PortfolioPage.prototype.onLoad = function () {
        webAPI.SetAuthToken(wx.getStorageSync(globalEnum.globalKey_token));
        this.getProfileData();
    };
    PortfolioPage.prototype.getProfileData = function () {
        var _this = this;
        var req = {};
        var that = this;
        wx.showLoading({ title: "加载中...", mask: true });
        webAPI.RetrieveUserProfile(req).then(function (resp) {
            console.log("Retrieving user profile...");
            console.log(resp);
            wx.hideLoading({});
            var keys = Object.keys(resp);
            var errorChecking = [];
            for (var i = 0; i < keys.length; i++) {
                var key = keys[i];
                if (resp[key] === -1 || resp[key] === '') {
                    errorChecking[i] = true;
                }
                else {
                    errorChecking[i] = false;
                }
                that.setData({
                    errorChecking: errorChecking
                });
            }
            console.log("get data", _this.data);
            var tempDate;
            if (resp.expected_birth_date == -1) {
                tempDate = moment();
            }
            else {
                tempDate = moment.unix(resp.expected_birth_date);
            }
            that.setData({
                genderIndex: Number(resp.gender) - 1,
                birthday: resp.year_of_birth == -1 ? 1980 : resp.year_of_birth,
                height: resp.height == -1 ? 0 : resp.height,
                currentWeight: resp.weight == -1 ? 0 : resp.weight,
                weightBeforePreg: resp.weight_before_pregnancy == -1 ? 0 : resp.weight_before_pregnancy,
                pregnancyStatusIndex: resp.pregnancy_stage,
                activityLevelIndex: resp.activity_level - 1,
                externalId: resp.external_id,
                pregnancyDate: {
                    date: tempDate.format('YYYY-MM-DD'),
                    year: tempDate.format('YYYY'),
                    month: tempDate.format('MM'),
                    day: tempDate.format('DD')
                },
            });
            wx.stopPullDownRefresh({});
        }).catch(function (err) { return wx.hideLoading({}); });
    };
    PortfolioPage.prototype.profileChecking = function () {
        var values = Object.values(this.data);
        console.log(values);
        var errorChecking = [];
        for (var i = 0; i < values.length; i++) {
            var value = values[i];
            if (value === -1 || value === '') {
                errorChecking[i] = true;
            }
            else {
                errorChecking[i] = false;
            }
            this.setData({
                errorChecking: errorChecking
            });
        }
    };
    PortfolioPage.prototype.onShow = function () {
        this.authenticationRequest();
    };
    PortfolioPage.prototype.authenticationRequest = function () {
        var _this = this;
        if (app.globalData.userInfo) {
            this.userInfo = app.globalData.userInfo;
        }
        else {
            console.log('start getUserInfo');
            wx.getUserInfo({
                success: function (res) {
                    app.globalData.userInfo = res.userInfo;
                    console.log('get getUserInfo' + res.userInfo);
                    _this.userInfo = app.globalData.userInfo;
                },
                fail: function (err) {
                    wx.navigateTo({
                        url: '../invitation/index'
                    });
                }
            });
        }
    };
    PortfolioPage.prototype.generateProfileReqBody = function () {
        var pregDateTimestamp = moment(this.data.pregnancyDate.date).unix();
        var reqBody = {
            gender: Number(this.data.genderIndex) + 1,
            year_of_birth: this.data.birthday,
            height: this.data.height,
            weight: this.data.currentWeight,
            weight_before_pregnancy: this.data.weightBeforePreg,
            activity_level: this.data.activityLevelIndex + 1,
            pregnancy_stage: this.data.pregnancyStatusIndex,
            expected_birth_date: pregDateTimestamp,
            nickname: this.userInfo.nickName,
            avatar_url: this.userInfo.avatarUrl,
            external_id: this.data.externalId,
        };
        console.log("Request body generated.");
        console.log(reqBody);
        return reqBody;
    };
    PortfolioPage.prototype.pregnancyStatusSelect = function (event) {
        this.setData({
            pregnancyStatusIndex: Number(event.detail.value)
        });
        this.updateProfile();
    };
    PortfolioPage.prototype.activityLvlSelect = function (event) {
        this.setData({
            activityLevelIndex: Number(event.detail.value)
        });
        this.updateProfile();
    };
    PortfolioPage.prototype.onPregnancyDateInput = function (event) {
        var newDate = moment(event.detail.value);
        var year = newDate.year();
        var month = newDate.month() + 1;
        var day = newDate.date();
        var today = moment();
        var pregDateLimit = moment().add(45, 'w');
        if (newDate.isBetween(today, pregDateLimit)) {
            console.log("Pregnancy date is valid");
            this.setData({
                pregnancyDate: {
                    date: event.detail.value,
                    year: year.toString(),
                    month: month.toString(),
                    day: day.toString()
                }
            });
            this.updateProfile();
        }
        else {
            this.setData({
                pregnancyDate: {
                    date: today.format("YYYY-MM-DD"),
                    year: today.format("YYYY"),
                    month: today.format("MM"),
                    day: today.format("DD")
                }
            });
            wx.showModal({
                title: "",
                content: "预产期只能输入今天到未来45周后的日期",
                showCancel: false
            });
        }
    };
    PortfolioPage.prototype.onFocusHeightInput = function (e) {
        this.setData({
            preHeight: this.data.height,
            height: ''
        });
    };
    PortfolioPage.prototype.onHeightInput = function (event) {
        var heightValue = Number(event.detail.value);
        if (heightValue > 230 || (heightValue < 40)) {
            this.setData({
                height: this.data.preHeight
            });
            if (heightValue != 0) {
                wx.showModal({
                    title: "",
                    content: "身高的范围在40cm和230cm之间",
                    showCancel: false
                });
            }
        }
        else {
            this.setData({
                height: heightValue
            });
            this.updateProfile();
        }
    };
    PortfolioPage.prototype.checkWeight = function (event) {
        var weightValue = Number(event.detail.value);
        if (weightValue < 30 || weightValue > 300) {
            this.setData({
                weight: 0
            });
            wx.showModal({
                title: "",
                content: "体重的范围在30kg和300kg之间",
                showCancel: false
            });
        }
        else {
            this.setData({
                weight: weightValue
            });
            this.updateProfile();
        }
    };
    PortfolioPage.prototype.onWeightBeforePregInput = function (event) {
        var weightValue = Number(event.detail.value);
        this.setData({
            weightBeforePreg: weightValue
        });
        this.updateProfile();
    };
    PortfolioPage.prototype.onFocusWeightInput = function (e) {
        this.setData({
            preCurrentWeight: this.data.currentWeight,
            currentWeight: ''
        });
    };
    PortfolioPage.prototype.onCurrentWeightInput = function (event) {
        var currentWeightValue = Number(event.detail.value);
        if (currentWeightValue < 3 || currentWeightValue > 150) {
            this.setData({
                currentWeight: this.data.preCurrentWeight
            });
            if (currentWeightValue != 0) {
                wx.showModal({
                    title: "",
                    content: "体重的范围在3kg和150kg之间",
                    showCancel: false
                });
            }
        }
        else {
            this.setData({
                currentWeight: currentWeightValue
            });
            this.updateProfile();
        }
    };
    PortfolioPage.prototype.birthdaySelect = function (event) {
        this.setData({
            birthday: Number(event.detail.value)
        });
        this.updateProfile();
    };
    PortfolioPage.prototype.genderSelect = function (event) {
        this.setData({
            genderIndex: Number(event.detail.value)
        });
        this.updateProfile();
    };
    PortfolioPage.prototype.tapOnMealHabit = function () {
        wx.navigateTo({
            url: '../foodPreference/index'
        });
        wx.reportAnalytics('tap_on_meal_habit', {});
    };
    PortfolioPage.prototype.tapOnMedicalRecord = function () {
        wx.navigateTo({
            url: '../medicalCase/index'
        });
        wx.reportAnalytics('tap_medical_record', {});
    };
    PortfolioPage.prototype.onIDInput = function (event) {
        var inputId = (event.detail.value).trim();
        this.setData({
            externalId: inputId
        });
        this.updateProfile();
    };
    PortfolioPage.prototype.updateProfile = function () {
        webAPI.UpdateUserProfile(this.generateProfileReqBody()).then(function (resp) {
        }).catch(function (err) { return wx.showModal({
            title: '更新个人资料失败',
            content: String(err),
            showCancel: false
        }); });
        wx.reportAnalytics('update_profile', {});
    };
    return PortfolioPage;
}());
Page(new PortfolioPage());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLGlEQUFrRDtBQUNsRCwrQkFBaUM7QUFFakMsSUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFVLENBQUE7QUFFNUIsaURBQW1EO0FBRW5EO0lBQUE7UUFFUyxhQUFRLEdBQUcsRUFBRSxDQUFBO1FBQ2IsU0FBSSxHQUFHO1lBQ1osUUFBUSxFQUFFLElBQUk7WUFDZCxhQUFhLEVBQUUsQ0FBQztZQUNoQixRQUFRLEVBQUUsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQztZQUN2SixXQUFXLEVBQUUsQ0FBQztZQUNkLFdBQVcsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7WUFDdkIsU0FBUyxFQUFFLEdBQUc7WUFDZCxNQUFNLEVBQUUsR0FBRztZQUNYLGdCQUFnQixFQUFDLEVBQUU7WUFDbkIsYUFBYSxFQUFFLEVBQUU7WUFDakIsZ0JBQWdCLEVBQUUsRUFBRTtZQUNwQixvQkFBb0IsRUFBRSxDQUFDO1lBQ3ZCLG9CQUFvQixFQUFFLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDO1lBQ2hELGtCQUFrQixFQUFFLENBQUM7WUFDckIsa0JBQWtCLEVBQUUsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsUUFBUSxDQUFDO1lBQ3ZFLGFBQWEsRUFBRTtnQkFDYixJQUFJLEVBQUUsTUFBTSxFQUFFLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQztnQkFDbkMsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7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Q0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElNeUFwcCB9IGZyb20gJy4uLy4uL2FwcCdcbmltcG9ydCB7IFVwZGF0ZVVzZXJQcm9maWxlUmVxIH0gZnJvbSBcIi4uLy4uL2FwaS9hcHAvQXBwU2VydmljZU9ianNcIlxuaW1wb3J0ICogYXMgZ2xvYmFsRW51bSBmcm9tICcuLi8uLi9hcGkvR2xvYmFsRW51bSdcbmltcG9ydCAqIGFzIG1vbWVudCBmcm9tICdtb21lbnQnO1xuXG5jb25zdCBhcHAgPSBnZXRBcHA8SU15QXBwPigpXG5cbmltcG9ydCAqIGFzIHdlYkFQSSBmcm9tICcuLi8uLi9hcGkvYXBwL0FwcFNlcnZpY2UnO1xuXG5jbGFzcyBQb3J0Zm9saW9QYWdlIHtcblxuICBwdWJsaWMgdXNlckluZm8gPSB7fVxuICBwdWJsaWMgZGF0YSA9IHtcbiAgICBiaXJ0aGRheTogMjAwMCxcbiAgICBhZ2VHcm91cEluZGV4OiAzLFxuICAgIGFnZUdyb3VwOiBbJzbkuKrmnIjku6XkuIsnLCAnNuS4quaciC0x5bKBJywgJzEtM+WygScsICczLTTlsoEnLCAnNC035bKBJywgJzctMTDlsoEnLCAnMTAtMTHlsoEnLCAnMTEtMTTlsoEnLCAnMTQtMTjlsoEnLCAnMTgtMzDlsoEnLCAnMzAtNTDlsoEnLCAnNTAtNjDlsoEnLCAnNjAtNjXlsoEnLCAnNjUtODDlsoEnLCAnODDlsoHku6XkuIonXSxcbiAgICBnZW5kZXJJbmRleDogMSxcbiAgICBnZW5kZXJBcnJheTogWyfnlLcnLCAn5aWzJ10sXG4gICAgcHJlSGVpZ2h0OiAxNzAsLy/kuLrkuobnlKjmiLfkv67mlLnouqvpq5jml7bvvIzouqvpq5jlgLzoh6rliqjnrYnkuo4w77yM5L+d55WZ55So5oi36L+b5YWl6aG16Z2i5pe25YCZ55qE6Lqr6auYXG4gICAgaGVpZ2h0OiAxNzAsXG4gICAgcHJlQ3VycmVudFdlaWdodDo1MCxcbiAgICBjdXJyZW50V2VpZ2h0OiA1MCxcbiAgICB3ZWlnaHRCZWZvcmVQcmVnOiA2MCxcbiAgICBwcmVnbmFuY3lTdGF0dXNJbmRleDogMSxcbiAgICBwcmVnbmFuY3lTdGF0dXNBcnJheTogWyfpg73kuI3mmK8nLCAn5aSH5a2VJywgJ+W3suWtlScsICflk7rkubPmnJ8nXSxcbiAgICBhY3Rpdml0eUxldmVsSW5kZXg6IDEsXG4gICAgYWN0aXZpdHlMZXZlbEFycmF5OiBbJ+WNp+W6iuS8keaBrycsICfovbvluqYs6Z2Z5Z2Q5bCR5YqoJywgJ+S4reW6pizluLjluLjnq5nnq4votbDliqgnLCAn6YeN5bqmLOi0n+mHjScsICfliafng4jvvIzotoXotJ/ph40nXSxcbiAgICBwcmVnbmFuY3lEYXRlOiB7XG4gICAgICBkYXRlOiBtb21lbnQoKS5mb3JtYXQoXCJZWVlZLU1NLUREXCIpLFxuICAgICAgeWVhcjogbW9tZW50KCkuZm9ybWF0KFwiWVlZWVwiKSxcbiAgICAgIG1vbnRoOiBtb21lbnQoKS5mb3JtYXQoXCJNTVwiKSxcbiAgICAgIGRheTogbW9tZW50KCkuZm9ybWF0KFwiRERcIilcbiAgICB9LFxuICB9XG5cbiAgcHVibGljIG9uVGFiSXRlbVRhcChpdGVtOiBhbnkpIHtcbiAgICAvL3d4IHJlcG9ydCBhbmFseXRpY3NcbiAgICB3eC5yZXBvcnRBbmFseXRpY3MoJ3N3aXRjaF90YWInLCB7XG4gICAgICB0YWJfaW5kZXg6IGl0ZW0uaW5kZXgsXG4gICAgICB0YWJfcGFnZXBhdGg6IGl0ZW0ucGFnZVBhdGgsXG4gICAgICB0YWJfdGV4dDogaXRlbS50ZXh0XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgb25QdWxsRG93blJlZnJlc2goKSB7XG4gICAgLy9nZXQgcmVwb3J0IHN0YXR1cyBhZ2FpblxuICAgIHRoaXMuZ2V0UHJvZmlsZURhdGEoKTtcbiAgfVxuXG4gIHB1YmxpYyBvbkxvYWQoKTogdm9pZCB7XG4gICAgLy9nZXQgcHJvZmlsZVxuICAgIHdlYkFQSS5TZXRBdXRoVG9rZW4od3guZ2V0U3RvcmFnZVN5bmMoZ2xvYmFsRW51bS5nbG9iYWxLZXlfdG9rZW4pKTtcbiAgICB0aGlzLmdldFByb2ZpbGVEYXRhKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0UHJvZmlsZURhdGEoKSB7XG4gICAgdmFyIHJlcSA9IHt9O1xuICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiBcIuWKoOi9veS4rS4uLlwiLCBtYXNrOiB0cnVlIH0pXG4gICAgd2ViQVBJLlJldHJpZXZlVXNlclByb2ZpbGUocmVxKS50aGVuKHJlc3AgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJSZXRyaWV2aW5nIHVzZXIgcHJvZmlsZS4uLlwiKTtcbiAgICAgIGNvbnNvbGUubG9nKHJlc3ApO1xuICAgICAgd3guaGlkZUxvYWRpbmcoe30pO1xuICAgICAgLy8tMSB2YWx1ZSBmaWx0ZXJpbmdcbiAgICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMocmVzcCk7IFxuICAgICAgbGV0IGVycm9yQ2hlY2tpbmcgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQga2V5ID0ga2V5c1tpXVxuICAgICAgICBpZiAocmVzcFtrZXldID09PSAtMSB8fCByZXNwW2tleV0gPT09ICcnKSB7XG4gICAgICAgICAgZXJyb3JDaGVja2luZ1tpXSA9IHRydWU7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlcnJvckNoZWNraW5nW2ldID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgKHRoYXQgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgICAgICBlcnJvckNoZWNraW5nOiBlcnJvckNoZWNraW5nXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coXCJnZXQgZGF0YVwiLCB0aGlzLmRhdGEpO1xuXG4gICAgICAvLyBwYXJzZSBwcmVnbmFuY3lEYXRlIHRpbWVzdGFtcFxuICAgICAgbGV0IHRlbXBEYXRlOiBtb21lbnQ7XG4gICAgICBpZiAocmVzcC5leHBlY3RlZF9iaXJ0aF9kYXRlID09IC0xKSB7XG4gICAgICAgIHRlbXBEYXRlID0gbW9tZW50KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0ZW1wRGF0ZSA9IG1vbWVudC51bml4KHJlc3AuZXhwZWN0ZWRfYmlydGhfZGF0ZSk7XG4gICAgICB9XG4gICAgICAvL3NldCBkYXRhIGludG8gcHJvZmlsZVxuICAgICAgKHRoYXQgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgICAgZ2VuZGVySW5kZXg6IE51bWJlcihyZXNwLmdlbmRlciktMSxcbiAgICAgICAgYmlydGhkYXk6IHJlc3AueWVhcl9vZl9iaXJ0aCA9PSAtMSA/IDE5ODAgOiByZXNwLnllYXJfb2ZfYmlydGgsXG4gICAgICAgIC8vIGludG9QYWdlSGVpZ2h0OiByZXNwLmhlaWdodCA9PSAtMSA/IDAgOiByZXNwLmhlaWdodCxcbiAgICAgICAgaGVpZ2h0OiByZXNwLmhlaWdodCA9PSAtMSA/IDAgOiByZXNwLmhlaWdodCxcbiAgICAgICAgY3VycmVudFdlaWdodDogcmVzcC53ZWlnaHQgPT0gLTEgPyAwIDogcmVzcC53ZWlnaHQsXG4gICAgICAgIHdlaWdodEJlZm9yZVByZWc6IHJlc3Aud2VpZ2h0X2JlZm9yZV9wcmVnbmFuY3kgPT0gLTEgPyAwIDogcmVzcC53ZWlnaHRfYmVmb3JlX3ByZWduYW5jeSxcbiAgICAgICAgcHJlZ25hbmN5U3RhdHVzSW5kZXg6IHJlc3AucHJlZ25hbmN5X3N0YWdlLCAvLyBsb2NhbCBpbmRleCBzdGFydHMgZnJvbSAwLCBub3QgMVxuICAgICAgICBhY3Rpdml0eUxldmVsSW5kZXg6IHJlc3AuYWN0aXZpdHlfbGV2ZWwgLSAxLCAvLyBsb2NhbCBpbmRleCBzdGFydHMgZnJvbSAwLCBub3QgMVxuICAgICAgICBleHRlcm5hbElkOiByZXNwLmV4dGVybmFsX2lkLFxuXG4gICAgICAgIHByZWduYW5jeURhdGU6IHtcbiAgICAgICAgICBkYXRlOiB0ZW1wRGF0ZS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgICB5ZWFyOiB0ZW1wRGF0ZS5mb3JtYXQoJ1lZWVknKSxcbiAgICAgICAgICBtb250aDogdGVtcERhdGUuZm9ybWF0KCdNTScpLFxuICAgICAgICAgIGRheTogdGVtcERhdGUuZm9ybWF0KCdERCcpXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIC8vZGlzbWlzcyB0aGUgcmVmcmVzaCBsb2FkaW5nIGJhclxuICAgICAgd3guc3RvcFB1bGxEb3duUmVmcmVzaCh7fSk7XG4gICAgfSkuY2F0Y2goZXJyID0+IHd4LmhpZGVMb2FkaW5nKHt9KSk7XG4gIH1cblxuICBwdWJsaWMgcHJvZmlsZUNoZWNraW5nKCkge1xuICAgIGxldCB2YWx1ZXMgPSBPYmplY3QudmFsdWVzKHRoaXMuZGF0YSk7XG4gICAgY29uc29sZS5sb2codmFsdWVzKTtcbiAgICBsZXQgZXJyb3JDaGVja2luZyA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgdmFsdWUgPSB2YWx1ZXNbaV07XG4gICAgICBpZiAodmFsdWUgPT09IC0xIHx8IHZhbHVlID09PSAnJykge1xuICAgICAgICBlcnJvckNoZWNraW5nW2ldID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVycm9yQ2hlY2tpbmdbaV0gPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7XG4gICAgICAgIGVycm9yQ2hlY2tpbmc6IGVycm9yQ2hlY2tpbmdcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBvblNob3coKSB7XG4gICB0aGlzLmF1dGhlbnRpY2F0aW9uUmVxdWVzdCgpO1xuICB9XG5cbiAgcHVibGljIGF1dGhlbnRpY2F0aW9uUmVxdWVzdCgpIHtcbiAgICAvL3VzZXJJbmZvIHJlcXVlc3RcbiAgICBpZiAoYXBwLmdsb2JhbERhdGEudXNlckluZm8pIHtcbiAgICAgIC8vICh0aGlzIGFzIGFueSkuc2V0RGF0YSEoe1xuICAgICAgLy8gICB1c2VySW5mbzogYXBwLmdsb2JhbERhdGEudXNlckluZm8sXG4gICAgICAvLyB9KVxuICAgICAgdGhpcy51c2VySW5mbyA9IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZygnc3RhcnQgZ2V0VXNlckluZm8nKTtcbiAgICAgIHd4LmdldFVzZXJJbmZvKHtcbiAgICAgICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgICAgICBhcHAuZ2xvYmFsRGF0YS51c2VySW5mbyA9IHJlcy51c2VySW5mbztcbiAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0IGdldFVzZXJJbmZvJyArIHJlcy51c2VySW5mbyk7XG4gICAgICAgICAgdGhpcy51c2VySW5mbyA9IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvO1xuICAgICAgICB9LFxuICAgICAgICBmYWlsOiBlcnIgPT4ge1xuICAgICAgICAgIC8v6Lez6L2s5Yiw6aqM6K+B6aG16Z2iXG4gICAgICAgICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICAgICAgICB1cmw6ICcuLi9pbnZpdGF0aW9uL2luZGV4J1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdlbmVyYXRlUHJvZmlsZVJlcUJvZHkoKTogVXBkYXRlVXNlclByb2ZpbGVSZXEge1xuICAgIC8vY2hlY2sgcHJvZmlsZSBzdGF0dXMgZWFjaCB0aW1lIHN1Ym1pdCBwcm9maWxlXG4gICAgbGV0IHByZWdEYXRlVGltZXN0YW1wOiBudW1iZXIgPSBtb21lbnQodGhpcy5kYXRhLnByZWduYW5jeURhdGUuZGF0ZSkudW5peCgpO1xuXG4gICAgdmFyIHJlcUJvZHkgPSB7XG4gICAgICBnZW5kZXI6IE51bWJlcih0aGlzLmRhdGEuZ2VuZGVySW5kZXgpKzEsIFxuICAgICAgeWVhcl9vZl9iaXJ0aDogdGhpcy5kYXRhLmJpcnRoZGF5LFxuICAgICAgaGVpZ2h0OiB0aGlzLmRhdGEuaGVpZ2h0LFxuICAgICAgd2VpZ2h0OiB0aGlzLmRhdGEuY3VycmVudFdlaWdodCxcbiAgICAgIHdlaWdodF9iZWZvcmVfcHJlZ25hbmN5OiB0aGlzLmRhdGEud2VpZ2h0QmVmb3JlUHJlZyxcblxuICAgICAgYWN0aXZpdHlfbGV2ZWw6IHRoaXMuZGF0YS5hY3Rpdml0eUxldmVsSW5kZXggKyAxLCAvLyBiYWNrZW5kIGluZGV4IHN0YXJ0cyBmcm9tIDEsIG5vdCAxMFxuICAgICAgcHJlZ25hbmN5X3N0YWdlOiB0aGlzLmRhdGEucHJlZ25hbmN5U3RhdHVzSW5kZXgsIC8vIGJhY2tlbmQgaW5kZXggc3RhcnRzIGZyb20gMSwgbm90IDEwXG5cbiAgICAgIGV4cGVjdGVkX2JpcnRoX2RhdGU6IHByZWdEYXRlVGltZXN0YW1wLFxuICAgICAgbmlja25hbWU6IHRoaXMudXNlckluZm8ubmlja05hbWUsXG4gICAgICBhdmF0YXJfdXJsOiB0aGlzLnVzZXJJbmZvLmF2YXRhclVybCxcbiAgICAgIGV4dGVybmFsX2lkOiB0aGlzLmRhdGEuZXh0ZXJuYWxJZCxcblxuICAgIH1cbiAgICBjb25zb2xlLmxvZyhcIlJlcXVlc3QgYm9keSBnZW5lcmF0ZWQuXCIpO1xuICAgIGNvbnNvbGUubG9nKHJlcUJvZHkpO1xuICAgIHJldHVybiByZXFCb2R5O1xuICB9XG5cbiAgcHVibGljIHByZWduYW5jeVN0YXR1c1NlbGVjdChldmVudDogYW55KTogdm9pZCB7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIHByZWduYW5jeVN0YXR1c0luZGV4OiBOdW1iZXIoZXZlbnQuZGV0YWlsLnZhbHVlKVxuICAgIH0pXG5cbiAgICB0aGlzLnVwZGF0ZVByb2ZpbGUoKTtcbiAgfVxuXG4gIHB1YmxpYyBhY3Rpdml0eUx2bFNlbGVjdChldmVudDogYW55KTogdm9pZCB7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIGFjdGl2aXR5TGV2ZWxJbmRleDogTnVtYmVyKGV2ZW50LmRldGFpbC52YWx1ZSlcbiAgICB9KVxuXG4gICAgdGhpcy51cGRhdGVQcm9maWxlKCk7XG4gIH1cblxuXG4gIHB1YmxpYyBvblByZWduYW5jeURhdGVJbnB1dChldmVudDogYW55KTogdm9pZCB7XG4gICAgbGV0IG5ld0RhdGUgPSBtb21lbnQoZXZlbnQuZGV0YWlsLnZhbHVlKTtcbiAgICBsZXQgeWVhciA9IG5ld0RhdGUueWVhcigpO1xuICAgIGxldCBtb250aCA9IG5ld0RhdGUubW9udGgoKSArIDE7XG4gICAgbGV0IGRheSA9IG5ld0RhdGUuZGF0ZSgpO1xuICAgIGxldCB0b2RheSA9IG1vbWVudCgpO1xuICAgIGxldCBwcmVnRGF0ZUxpbWl0ID0gbW9tZW50KCkuYWRkKDQ1LCAndycpO1xuXG4gICAgaWYgKG5ld0RhdGUuaXNCZXR3ZWVuKHRvZGF5LCBwcmVnRGF0ZUxpbWl0KSkge1xuICAgICAgY29uc29sZS5sb2coXCJQcmVnbmFuY3kgZGF0ZSBpcyB2YWxpZFwiKTtcbiAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7XG4gICAgICAgIHByZWduYW5jeURhdGU6IHtcbiAgICAgICAgICBkYXRlOiBldmVudC5kZXRhaWwudmFsdWUsXG4gICAgICAgICAgeWVhcjogeWVhci50b1N0cmluZygpLFxuICAgICAgICAgIG1vbnRoOiBtb250aC50b1N0cmluZygpLFxuICAgICAgICAgIGRheTogZGF5LnRvU3RyaW5nKClcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLnVwZGF0ZVByb2ZpbGUoKTtcblxuICAgIH0gZWxzZSB7XG4gICAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgICBwcmVnbmFuY3lEYXRlOiB7XG4gICAgICAgICAgZGF0ZTogdG9kYXkuZm9ybWF0KFwiWVlZWS1NTS1ERFwiKSxcbiAgICAgICAgICB5ZWFyOiB0b2RheS5mb3JtYXQoXCJZWVlZXCIpLFxuICAgICAgICAgIG1vbnRoOiB0b2RheS5mb3JtYXQoXCJNTVwiKSxcbiAgICAgICAgICBkYXk6IHRvZGF5LmZvcm1hdChcIkREXCIpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgdGl0bGU6IFwiXCIsXG4gICAgICAgIGNvbnRlbnQ6IFwi6aKE5Lqn5pyf5Y+q6IO96L6T5YWl5LuK5aSp5Yiw5pyq5p2lNDXlkajlkI7nmoTml6XmnJ9cIixcbiAgICAgICAgc2hvd0NhbmNlbDogZmFsc2VcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBwdWJsaWMgb25Gb2N1c0hlaWdodElucHV0KGUpe1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBwcmVIZWlnaHQ6dGhpcy5kYXRhLmhlaWdodCxcbiAgICAgIGhlaWdodDogJydcbiAgICB9KVxuICB9XG4gIHB1YmxpYyBvbkhlaWdodElucHV0KGV2ZW50OiBhbnkpIHtcbiAgICBsZXQgaGVpZ2h0VmFsdWUgPSBOdW1iZXIoZXZlbnQuZGV0YWlsLnZhbHVlKTtcbiAgICAvL2NoZWNrIHRoZSBwcmVnbmFuY3kgd2VlayBzdGF0dXNcbiAgICBpZiAoaGVpZ2h0VmFsdWUgPiAyMzAgfHwgKGhlaWdodFZhbHVlIDwgNDApIHtcbiAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7XG4gICAgICAgIGhlaWdodDogdGhpcy5kYXRhLnByZUhlaWdodFxuICAgICAgfSk7XG4gICAgICBpZiAoaGVpZ2h0VmFsdWUhPTApe1xuICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgIHRpdGxlOiBcIlwiLFxuICAgICAgICAgIGNvbnRlbnQ6IFwi6Lqr6auY55qE6IyD5Zu05ZyoNDBjbeWSjDIzMGNt5LmL6Ze0XCIsXG4gICAgICAgICAgc2hvd0NhbmNlbDogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7XG4gICAgICAgIGhlaWdodDogaGVpZ2h0VmFsdWVcbiAgICAgIH0sKVxuICAgICAgdGhpcy51cGRhdGVQcm9maWxlKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGNoZWNrV2VpZ2h0KGV2ZW50OiBhbnkpIHtcbiAgICBsZXQgd2VpZ2h0VmFsdWUgPSBOdW1iZXIoZXZlbnQuZGV0YWlsLnZhbHVlKTtcbiAgICBpZiAod2VpZ2h0VmFsdWUgPCAzMCB8fCB3ZWlnaHRWYWx1ZSA+IDMwMCkge1xuICAgICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgICAgd2VpZ2h0OiAwXG4gICAgICB9KVxuICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgdGl0bGU6IFwiXCIsXG4gICAgICAgIGNvbnRlbnQ6IFwi5L2T6YeN55qE6IyD5Zu05ZyoMzBrZ+WSjDMwMGtn5LmL6Ze0XCIsXG4gICAgICAgIHNob3dDYW5jZWw6IGZhbHNlXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgICAgd2VpZ2h0OiB3ZWlnaHRWYWx1ZVxuICAgICAgfSlcblxuICAgICAgdGhpcy51cGRhdGVQcm9maWxlKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG9uV2VpZ2h0QmVmb3JlUHJlZ0lucHV0KGV2ZW50OiBhbnkpOiB2b2lkIHtcbiAgICBsZXQgd2VpZ2h0VmFsdWUgPSBOdW1iZXIoZXZlbnQuZGV0YWlsLnZhbHVlKTtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgd2VpZ2h0QmVmb3JlUHJlZzogd2VpZ2h0VmFsdWVcbiAgICB9KVxuXG4gICAgdGhpcy51cGRhdGVQcm9maWxlKCk7XG4gIH1cblxuICBwdWJsaWMgb25Gb2N1c1dlaWdodElucHV0KGUpIHtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgcHJlQ3VycmVudFdlaWdodDogdGhpcy5kYXRhLmN1cnJlbnRXZWlnaHQsXG4gICAgICBjdXJyZW50V2VpZ2h0OiAnJ1xuICAgIH0pXG4gIH1cblxuICBwdWJsaWMgb25DdXJyZW50V2VpZ2h0SW5wdXQoZXZlbnQ6IGFueSkge1xuICAgIGxldCBjdXJyZW50V2VpZ2h0VmFsdWUgPSBOdW1iZXIoZXZlbnQuZGV0YWlsLnZhbHVlKTtcbiAgICBpZiAoY3VycmVudFdlaWdodFZhbHVlIDwgMyB8fCBjdXJyZW50V2VpZ2h0VmFsdWUgPiAxNTApIHtcbiAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7XG4gICAgICAgIGN1cnJlbnRXZWlnaHQ6IHRoaXMuZGF0YS5wcmVDdXJyZW50V2VpZ2h0XG4gICAgICB9KTtcbiAgICAgIGlmIChjdXJyZW50V2VpZ2h0VmFsdWUhPTApe1xuICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgIHRpdGxlOiBcIlwiLFxuICAgICAgICAgIGNvbnRlbnQ6IFwi5L2T6YeN55qE6IyD5Zu05ZyoM2tn5ZKMMTUwa2fkuYvpl7RcIixcbiAgICAgICAgICBzaG93Q2FuY2VsOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgICAgY3VycmVudFdlaWdodDogY3VycmVudFdlaWdodFZhbHVlXG4gICAgICB9KVxuXG4gICAgICB0aGlzLnVwZGF0ZVByb2ZpbGUoKTtcbiAgICB9XG4gIH1cblxuXG4gIHB1YmxpYyBiaXJ0aGRheVNlbGVjdChldmVudDogYW55KTogdm9pZCB7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIGJpcnRoZGF5OiBOdW1iZXIoZXZlbnQuZGV0YWlsLnZhbHVlKVxuICAgIH0pXG5cbiAgICB0aGlzLnVwZGF0ZVByb2ZpbGUoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZW5kZXJTZWxlY3QoZXZlbnQ6IGFueSk6IHZvaWQge1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7XG4gICAgICBnZW5kZXJJbmRleDogTnVtYmVyKGV2ZW50LmRldGFpbC52YWx1ZSlcbiAgICB9KVxuXG4gICAgdGhpcy51cGRhdGVQcm9maWxlKCk7XG4gIH1cblxuICBwdWJsaWMgdGFwT25NZWFsSGFiaXQoKTogdm9pZCB7XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6ICcuLi9mb29kUHJlZmVyZW5jZS9pbmRleCdcbiAgICB9KTtcbiAgICAvL3JlcG9ydCBhbmFseXRpY3NcbiAgICB3eC5yZXBvcnRBbmFseXRpY3MoJ3RhcF9vbl9tZWFsX2hhYml0Jywge30pO1xuICB9XG5cbiAgcHVibGljIHRhcE9uTWVkaWNhbFJlY29yZCgpOiB2b2lkIHtcbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogJy4uL21lZGljYWxDYXNlL2luZGV4J1xuICAgIH0pO1xuICAgIC8vcmVwb3J0IGFuYWx5dGljc1xuICAgIHd4LnJlcG9ydEFuYWx5dGljcygndGFwX21lZGljYWxfcmVjb3JkJywge30pO1xuICB9XG5cbiAgcHVibGljIG9uSURJbnB1dChldmVudDogYW55KTogdm9pZCB7XG4gICAgbGV0IGlucHV0SWQgPSAoZXZlbnQuZGV0YWlsLnZhbHVlKS50cmltKCk7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIGV4dGVybmFsSWQ6IGlucHV0SWRcbiAgICB9KTtcbiAgICB0aGlzLnVwZGF0ZVByb2ZpbGUoKTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVQcm9maWxlKCkge1xuICAgIHdlYkFQSS5VcGRhdGVVc2VyUHJvZmlsZSh0aGlzLmdlbmVyYXRlUHJvZmlsZVJlcUJvZHkoKSkudGhlbihyZXNwID0+IHtcblxuICAgIH0pLmNhdGNoKGVyciA9PiB3eC5zaG93TW9kYWwoe1xuICAgICAgdGl0bGU6ICfmm7TmlrDkuKrkurrotYTmlpnlpLHotKUnLFxuICAgICAgY29udGVudDogU3RyaW5nKGVyciksXG4gICAgICBzaG93Q2FuY2VsOiBmYWxzZVxuICAgIH0pKTtcbiAgICAvL3JlcG9ydCBhbmFseXRpY3NcbiAgICB3eC5yZXBvcnRBbmFseXRpY3MoJ3VwZGF0ZV9wcm9maWxlJywge30pO1xuICB9XG59XG5cblBhZ2UobmV3IFBvcnRmb2xpb1BhZ2UoKSk7XG4iXX0=