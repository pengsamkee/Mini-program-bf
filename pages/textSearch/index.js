"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
var webAPI = require("../../api/app/AppService");
var interface_1 = require("../../api/app/interface");
var globalEnum = require("../../api/GlobalEnum");
var textCache = require("./textCache/TextCache");
var textSearch = (function () {
    function textSearch() {
        this.filterType = 0;
        this.mealType = 0;
        this.naviType = 0;
        this.mealDate = 0;
        this.data = {
            keyword: "",
            inputShowed: false,
            resultList: [],
            resultError: [],
            recentList: [],
            commonFoodList: [],
            showChoosedLists: false,
            showChoosedConfirm: false,
            showPopup: false,
            showPicker: false,
            choosedLists: [],
            unitArr: ['克', '碗', '把', '捧', '盆', '瓢'],
            foodUnitAndUnitEnergy: [],
            foodNumValue: 100,
            chooseUinitIndex: 0,
            textSearchResultSelectIndex: null,
            recentResultSelectIndex: null,
            commonFoodIndex: null,
            totalEnergy: 0,
        };
    }
    textSearch.prototype.onLoad = function (options) {
        webAPI.SetAuthToken(wx.getStorageSync(globalEnum.globalKey_token));
        var title = options.title;
        this.filterType = parseInt(options.filterType);
        this.mealType = parseInt(options.mealType);
        this.naviType = parseInt(options.naviType);
        this.mealDate = parseInt(options.mealDate);
        wx.setNavigationBarTitle({
            title: "添加" + title
        });
        this.getCommonFoodList();
    };
    textSearch.prototype.onShow = function () {
        this.getRecentList();
    };
    textSearch.prototype.getCommonFoodList = function () {
        var _this = this;
        var that = this;
        interface_1.default.commonFoodList({}).then(function (res) {
            _this.setData({ commonFoodList: res });
        }).catch(function (err) {
            console.log(err);
        });
    };
    textSearch.prototype.getFoodUnitOption = function (item) {
        var that = this;
        interface_1.default.getFoodUnitOption({
            foodId: item.foodId,
            foodType: item.foodType
        }).then(function (res) {
            console.log('getFoodUnitOption', res);
            that.parseFoodUnitOptionResp(res);
        }).catch(function (err) {
            wx.showToast({
                title: '获取食物信息失败',
                icon: 'none'
            });
        });
    };
    textSearch.prototype.parseFoodUnitOptionResp = function (res) {
        var arr = res.unitOption.map(function (item) {
            return {
                name: item.unitName,
                unitEnergy: Math.round(item.energy),
                unit_id: item.unitId
            };
        });
        var nameArr = arr.map(function (item) { return item.name; });
        this.setData({
            foodNumValue: res.unitOption[0].unitWeight / 100,
            chooseUinitIndex: 0,
            unitArr: nameArr,
            foodUnitAndUnitEnergy: arr,
            showPopup: true
        });
    };
    textSearch.prototype.getRecentList = function () {
        var recentList = textCache.getAllValue();
        this.setData({
            recentList: recentList
        });
    };
    textSearch.prototype.showInput = function () {
        this.setData({
            inputShowed: true
        });
    };
    textSearch.prototype.clearInput = function () {
        this.setData({
            keyword: "",
            resultError: false,
            resultList: []
        });
    };
    textSearch.prototype.inputTyping = function (event) {
        this.setData({
            resultError: false,
            keyword: event.detail.value,
        });
    };
    textSearch.prototype.performSearch = function () {
        var keyword = this.data.keyword;
        var req = { query: keyword, filter_type: this.filterType, meal_type: this.mealType };
        var that = this;
        wx.showLoading({
            title: '加载中...'
        });
        webAPI.RetrieveTextSearch(req).then(function (resp) {
            wx.hideLoading();
            that.setResultList(resp);
        }).catch(function (err) { return console.log(err); });
    };
    textSearch.prototype.setResultList = function (resp) {
        var results = [];
        if (resp.result_list.length == 0) {
            this.setData({
                resultList: [],
                resultError: true
            });
        }
        else {
            for (var index in resp.result_list) {
                var item = resp.result_list[index];
                var result = {
                    foodId: item.food_id,
                    foodName: item.food_name,
                    foodType: item.food_type,
                    amount: item.amount,
                    unit: item.unit_name,
                    energy: Math.floor(item.energy / 100)
                };
                results.push(result);
            }
            this.setData({
                resultList: results,
                resultError: false
            });
        }
        console.log(this.data.resultList);
    };
    textSearch.prototype.onTextSearchResultSelect = function (event) {
        var _this = this;
        var index = event.currentTarget.dataset.textIndex;
        this.getFoodUnitOption(this.data.resultList[index]);
        this.setData({
            recentResultSelectIndex: null,
            commonFoodIndex: null,
            textSearchResultSelectIndex: index,
        }, function () {
            textCache.setValue(_this.data.resultList[index]);
            _this.getRecentList();
        });
    };
    textSearch.prototype.handleTapCommonFoodItem = function (event) {
        var index = event.currentTarget.dataset.textIndex;
        this.getFoodUnitOption(this.data.commonFoodList[index]);
        this.setData({
            textSearchResultSelectIndex: null,
            recentResultSelectIndex: null,
            commonFoodIndex: index,
        });
    };
    textSearch.prototype.onRecentResultSelect = function (event) {
        var index = event.currentTarget.dataset.textIndex;
        this.getFoodUnitOption(this.data.recentList[index]);
        this.setData({
            textSearchResultSelectIndex: null,
            commonFoodIndex: null,
            recentResultSelectIndex: index,
        });
    };
    textSearch.prototype.deleteTextSearchCache = function (event) {
        textCache.clearAll();
        this.getRecentList();
    };
    textSearch.prototype.onClose = function () {
        this.setData({ showPopup: false, showChoosedLists: false });
    };
    textSearch.prototype.toggleChoosedLists = function () {
        this.setData({ showChoosedLists: !this.data.showChoosedLists });
    };
    textSearch.prototype.handleAddFood = function () {
        var _this = this;
        var textSearchResultSelectIndex = this.data.textSearchResultSelectIndex;
        var recentResultSelectIndex = this.data.recentResultSelectIndex;
        var commonFoodIndex = this.data.commonFoodIndex;
        if (recentResultSelectIndex !== null) {
            var item = this.data.recentList[recentResultSelectIndex];
        }
        else if (textSearchResultSelectIndex !== null) {
            var item = this.data.resultList[textSearchResultSelectIndex];
        }
        else {
            var item = this.data.commonFoodList[commonFoodIndex];
        }
        item = __assign({}, item, { choosedUnit: this.data.unitArr[this.data.chooseUinitIndex], weightNumber: this.data.foodNumValue, unitEnergy: this.data.foodUnitAndUnitEnergy[this.data.chooseUinitIndex].unitEnergy, unit_id: this.data.foodUnitAndUnitEnergy[this.data.chooseUinitIndex].unit_id });
        this.data.choosedLists.push(item);
        this.setData({
            choosedLists: this.data.choosedLists,
            showPopup: false
        }, function () {
            _this.sumEnergy();
            if (recentResultSelectIndex !== null) {
                textCache.setValue(_this.data.recentList[recentResultSelectIndex]);
                _this.getRecentList();
            }
            console.log(_this.data.choosedLists);
        });
    };
    textSearch.prototype.sumEnergy = function () {
        var totalEnergy = this.data.choosedLists.reduce(function (pre, next) {
            return next.weightNumber * next.unitEnergy + pre;
        }, 0);
        this.setData({ totalEnergy: totalEnergy });
    };
    textSearch.prototype.handleFoodNumInput = function (e) {
        var foodNumValue = parseInt(e.detail.value);
        this.setData({ foodNumValue: foodNumValue });
    };
    textSearch.prototype.showPicker = function () {
        this.setData({ showPicker: true, showPopup: false });
    };
    textSearch.prototype.onConfirm = function () {
        this.setData({ showPicker: false, showPopup: true });
    };
    textSearch.prototype.onChange = function (e) {
        var chooseUinitIndex = e.detail.index;
        this.setData({ chooseUinitIndex: chooseUinitIndex });
    };
    textSearch.prototype.handleDeleteChoosedItem = function (e) {
        var _this = this;
        var index = e.currentTarget.dataset.index;
        this.data.choosedLists.splice(index, 1);
        this.setData({ choosedLists: this.data.choosedLists }, function () {
            _this.sumEnergy();
            if (_this.data.choosedLists.length === 0) {
                _this.setData({ showChoosedLists: false });
            }
        });
    };
    textSearch.prototype.handleConfirmBtn = function () {
        wx.showLoading({ title: "加载中...", mask: true });
        var foodInfoList = [];
        console.log(888, this.data.choosedLists);
        this.data.choosedLists.map(function (item) {
            var food = {
                foodId: item.foodId,
                foodType: item.foodType,
                inputType: 2,
                amount: parseInt(item.weightNumber),
                unitId: item.unit_id
            };
            foodInfoList.push(food);
        });
        var req = { mealType: this.mealType, mealDate: this.mealDate, foodInfoList: foodInfoList };
        console.log('请求参数req', req);
        this.createMealLog(req);
    };
    textSearch.prototype.createMealLog = function (req) {
        interface_1.default.createMealLog(req).then(function (res) {
            console.log(res);
        }).catch(function (err) {
            wx.showToast({ title: '提交食物记录失败', icon: 'none' });
        });
    };
    textSearch.prototype.CreateOrUpdateMealLog = function (req) {
        var _this = this;
        var imageUrl = "https://dietlens-1258665547.cos.ap-shanghai.myqcloud.com/mini-app-image/defaultImage/textsearch-default-image.png";
        webAPI.CreateOrUpdateMealLog(req).then(function (resp) {
            _this.ConfirmMealLog(resp.meal_id);
        }).catch(function (err) {
            wx.showToast({ title: '请求失败', icon: 'none' });
            wx.hideLoading({});
        });
    };
    textSearch.prototype.ConfirmMealLog = function (meal_id) {
        var _this = this;
        var req = { meal_id: meal_id };
        webAPI.ConfirmMealLog(req).then(function (resp) {
            wx.hideLoading({});
            wx.navigateTo({ url: "../../homeSub/pages/mealAnalysis/index?mealDate=" + _this.mealDate + "&mealType=" + _this.mealType });
        }).catch(function (err) {
            wx.showToast({ title: '提交食物记录失败', icon: 'none' });
        });
    };
    textSearch.prototype.goWeightReferencePage = function () {
        wx.navigateTo({ url: './../../homeSub/pages/weightReference/index' });
    };
    return textSearch;
}());
Page(new textSearch());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEsaURBQW1EO0FBQ25ELHFEQUE4QztBQUU5QyxpREFBa0Q7QUFDbEQsaURBQWtEO0FBZWxEO0lBQUE7UUFDUyxlQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ2YsYUFBUSxHQUFHLENBQUMsQ0FBQztRQUNiLGFBQVEsR0FBRyxDQUFDLENBQUM7UUFDYixhQUFRLEdBQUcsQ0FBQyxDQUFDO1FBRWIsU0FBSSxHQUFHO1lBQ1osT0FBTyxFQUFFLEVBQUU7WUFDWCxXQUFXLEVBQUUsS0FBSztZQUNsQixVQUFVLEVBQUUsRUFBRTtZQUNkLFdBQVcsRUFBRSxFQUFFO1lBQ2YsVUFBVSxFQUFFLEVBQUU7WUFDZCxjQUFjLEVBQUMsRUFBRTtZQUNqQixnQkFBZ0IsRUFBQyxLQUFLO1lBQ3RCLGtCQUFrQixFQUFDLEtBQUs7WUFDeEIsU0FBUyxFQUFFLEtBQUs7WUFDaEIsVUFBVSxFQUFDLEtBQUs7WUFDaEIsWUFBWSxFQUFDLEVBQUU7WUFDZixPQUFPLEVBQUMsQ0FBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsQ0FBQztZQUNqQyxxQkFBcUIsRUFBQyxFQUFFO1lBQ3hCLFlBQVksRUFBQyxHQUFHO1lBQ2hCLGdCQUFnQixFQUFDLENBQUM7WUFDbEIsMkJBQTJCLEVBQUMsSUFBSTtZQUNoQyx1QkFBdUIsRUFBQyxJQUFJO1lBQzVCLGVBQWUsRUFBQyxJQUFJO1lBQ3BCLFdBQVcsRUFBQyxDQUFDO1NBQ2QsQ0FBQTtJQXdWSCxDQUFDO0lBdFZRLDJCQUFNLEdBQWIsVUFBYyxPQUFZO1FBQ3hCLE1BQU0sQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztRQUNuRSxJQUFJLEtBQUssR0FBRyxPQUFPLENB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QUssQ0FBQyxVQUFBLEdBQUc7WUFDVixFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUMsS0FBSyxFQUFFLFVBQVUsRUFBQyxJQUFJLEVBQUUsTUFBTSxFQUFDLENBQUMsQ0FBQztRQUNqRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFJTSwwQ0FBcUIsR0FBNUI7UUFDRSxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUMsR0FBRyxFQUFDLDZDQUE2QyxFQUFDLENBQUMsQ0FBQTtJQUNwRSxDQUFDO0lBRUgsaUJBQUM7QUFBRCxDQUFDLEFBbFhELElBa1hDO0FBRUQsSUFBSSxDQUFDLElBQUksVUFBVSxFQUFFLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHdlYkFQSSBmcm9tICcuLi8uLi9hcGkvYXBwL0FwcFNlcnZpY2UnO1xuaW1wb3J0IHJlcXVlc3QgZnJvbSAnLi4vLi4vYXBpL2FwcC9pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUmV0cmlldmVUZXh0U2VhcmNoUmVxLCBSZXRyaWV2ZVRleHRTZWFyY2hSZXNwLCBDcmVhdGVPclVwZGF0ZU1lYWxMb2dSZXEsIEFkZFJlY2lwZUl0ZW1SZXEsIE1lYWxMb2dSZXNwIH0gZnJvbSBcIi9hcGkvYXBwL0FwcFNlcnZpY2VPYmpzXCJcbmltcG9ydCAqIGFzIGdsb2JhbEVudW0gZnJvbSAnLi4vLi4vYXBpL0dsb2JhbEVudW0nXG5pbXBvcnQgKiBhcyB0ZXh0Q2FjaGUgZnJvbSAnLi90ZXh0Q2FjaGUvVGV4dENhY2hlJ1xuaW1wb3J0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xuXG50eXBlIGRhdGEgPSB7XG4gIGtleXdvcmQ6IFN0cmluZztcbiAgcmVzdWx0TGlzdDogUmVzdWx0W107XG59XG5cbnR5cGUgUmVzdWx0ID0ge1xuICBmb29kSWQ6IG51bWJlcjtcbiAgZGlzcGxheU5hbWU6IFN0cmluZztcbiAgZm9vZFR5cGU6IG51bWJlcjtcbiAgZW5ncnk6IG51bWJlcjtcbn1cblxuY2xhc3MgdGV4dFNlYXJjaCB7XG4gIHB1YmxpYyBmaWx0ZXJUeXBlID0gMDsgLy8wLmFsbCAxLnJlY2lwZSAyLmluZ3JlaWRlbnRcbiAgcHVibGljIG1lYWxUeXBlID0gMDsgLy8xLmJyZWFrZmFzdCAyLmx1bmNoIDMuZGlubmVyIDQuc25hY2tcbiAgcHVibGljIG5hdmlUeXBlID0gMDsgLy8wLnRleHRzZWFyY2ggPT4gZGV0YWlsIDEudGV4dHNlYXJjaCA9PiB0YWcgMi50ZXh0c2VhcmNoPT4gaW5ncmVkaWVudFxuICBwdWJsaWMgbWVhbERhdGUgPSAwOyAvL3ByZXYgcGFnZSBtdXN0IHBhc3MgbWVhbERhdGUgdG8gdGV4dFNlYXJjaCBwYWdlXG5cbiAgcHVibGljIGRhdGEgPSB7XG4gICAga2V5d29yZDogXCJcIixcbiAgICBpbnB1dFNob3dlZDogZmFsc2UsXG4gICAgcmVzdWx0TGlzdDogW10sXG4gICAgcmVzdWx0RXJyb3I6IFtdLFxuICAgIHJlY2VudExpc3Q6IFtdLFxuICAgIGNvbW1vbkZvb2RMaXN0OltdLCAvLyDluLjop4Hpo5/nianliJfooahcbiAgICBzaG93Q2hvb3NlZExpc3RzOmZhbHNlLFxuICAgIHNob3dDaG9vc2VkQ29uZmlybTpmYWxzZSxcbiAgICBzaG93UG9wdXA6IGZhbHNlLFxuICAgIHNob3dQaWNrZXI6ZmFsc2UsXG4gICAgY2hvb3NlZExpc3RzOltdLCAgLy8g5bey57uP5re75Yqg55qE6aOf54mp5L+h5oGv5YiX6KGoXG4gICAgdW5pdEFycjpbJ+WFiycsJ+eilycsJ+aKiicsJ+aNpycsJ+ebhicsJ+eToiddLFxuICAgIGZvb2RVbml0QW5kVW5pdEVuZXJneTpbXSxcbiAgICBmb29kTnVtVmFsdWU6MTAwLFxuICAgIGNob29zZVVpbml0SW5kZXg6MCwgLy8g55So5oi36YCJ5oup5LqGcGlja2Vy5Lit55qEaW5kZXhcbiAgICB0ZXh0U2VhcmNoUmVzdWx0U2VsZWN0SW5kZXg6bnVsbCwgLy8g55So5oi354K55Ye75paH5a2X5pCc57Si5YiX6KGo5Lit55qE5ZOq5LiA6aG5XG4gICAgcmVjZW50UmVzdWx0U2VsZWN0SW5kZXg6bnVsbCwgLy8g55So5oi354K55Ye75LqG5Y6G5Y+y57yT5a2Y5pWw57uE5Lit55qEaW5kZXhcbiAgICBjb21tb25Gb29kSW5kZXg6bnVsbCwgLy8g5bi46KeB5YiX6KGo5Lit55qEaW5kZXhcbiAgICB0b3RhbEVuZXJneTowLFxuICB9XG5cbiAgcHVibGljIG9uTG9hZChvcHRpb25zOiBhbnkpIHtcbiAgICB3ZWJBUEkuU2V0QXV0aFRva2VuKHd4LmdldFN0b3JhZ2VTeW5jKGdsb2JhbEVudW0uZ2xvYmFsS2V5X3Rva2VuKSk7XG4gICAgbGV0IHRpdGxlID0gb3B0aW9ucy50aXRsZTtcbiAgICB0aGlzLmZpbHRlclR5cGUgPSBwYXJzZUludChvcHRpb25zLmZpbHRlclR5cGUpO1xuICAgIHRoaXMubWVhbFR5cGUgPSBwYXJzZUludChvcHRpb25zLm1lYWxUeXBlKTtcbiAgICB0aGlzLm5hdmlUeXBlID0gcGFyc2VJbnQob3B0aW9ucy5uYXZpVHlwZSk7XG4gICAgdGhpcy5tZWFsRGF0ZSA9IHBhcnNlSW50KG9wdGlvbnMubWVhbERhdGUpO1xuICAgIHd4LnNldE5hdmlnYXRpb25CYXJUaXRsZSh7XG4gICAgICB0aXRsZTogXCLmt7vliqBcIiArIHRpdGxlLy/pobXpnaLmoIfpopjkuLrot6/nlLHlj4LmlbBcbiAgICB9KTtcbiAgICB0aGlzLmdldENvbW1vbkZvb2RMaXN0KCk7XG4gIH1cblxuICBwdWJsaWMgb25TaG93KCkge1xuICAgIHRoaXMuZ2V0UmVjZW50TGlzdCgpO1xuICB9XG4gIC8qKlxuICAgKiDojrflj5bluLjop4HnmoTpo5/nianliJfooahcbiAgICovXG4gIHB1YmxpYyBnZXRDb21tb25Gb29kTGlzdCgpe1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzXG4gICAgcmVxdWVzdC5jb21tb25Gb29kTGlzdCh7XG4gICAgfSkudGhlbihyZXM9PntcbiAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7Y29tbW9uRm9vZExpc3Q6cmVzfSlcbiAgICB9KS5jYXRjaChlcnI9PntcbiAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlumjn+eJqeWNleS9jeS/oeaBr1xuICAgKi9cbiAgcHVibGljIGdldEZvb2RVbml0T3B0aW9uKGl0ZW0pe1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzXG4gICAgcmVxdWVzdC5nZXRGb29kVW5pdE9wdGlvbih7XG4gICAgICBmb29kSWQ6aXRlbS5mb29kSWQsXG4gICAgICBmb29kVHlwZTppdGVtLmZvb2RUeXBlXG4gICAgfSkudGhlbihyZXM9PntcbiAgICAgIGNvbnNvbGUubG9nKCdnZXRGb29kVW5pdE9wdGlvbicscmVzKVxuICAgICAgdGhhdC5wYXJzZUZvb2RVbml0T3B0aW9uUmVzcChyZXMpXG4gICAgfSkuY2F0Y2goZXJyPT57XG4gICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICB0aXRsZTon6I635Y+W6aOf54mp5L+h5oGv5aSx6LSlJyxcbiAgICAgICAgaWNvbjonbm9uZSdcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuICAvKipcbiAgICog6Kej5p6Q6I635Y+W5Yiw55qE6aOf54mp5Y2V5L2N5L+h5oGvXG4gICAqL1xuICBwdWJsaWMgcGFyc2VGb29kVW5pdE9wdGlvblJlc3AocmVzKXtcbiAgICBjb25zdCBhcnIgPSByZXMudW5pdE9wdGlvbi5tYXAoaXRlbT0+e1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZTppdGVtLnVuaXROYW1lLFxuICAgICAgICB1bml0RW5lcmd5IDogTWF0aC5yb3VuZChpdGVtLmVuZXJneSksXG4gICAgICAgIHVuaXRfaWQgOiBpdGVtLnVuaXRJZFxuICAgICAgfVxuICAgIH0pXG4gICAgY29uc3QgbmFtZUFyciA9IGFyci5tYXAoaXRlbT0+aXRlbS5uYW1lKTtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgZm9vZE51bVZhbHVlOnJlcy51bml0T3B0aW9uWzBdLnVuaXRXZWlnaHQvMTAwLFxuICAgICAgY2hvb3NlVWluaXRJbmRleDowLCAvLyDliJ3lp4vljJbmlbDph48xMDDlhYtcbiAgICAgIHVuaXRBcnI6bmFtZUFycixcbiAgICAgIGZvb2RVbml0QW5kVW5pdEVuZXJneTphcnIsXG4gICAgICBzaG93UG9wdXA6dHJ1ZVxuICAgIH0pXG4gIH1cblxuICBwdWJsaWMgZ2V0UmVjZW50TGlzdCgpe1xuICAgIGxldCByZWNlbnRMaXN0ID0gdGV4dENhY2hlLmdldEFsbFZhbHVlKCk7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIHJlY2VudExpc3Q6IHJlY2VudExpc3RcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzaG93SW5wdXQoKSB7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIGlucHV0U2hvd2VkOiB0cnVlXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgY2xlYXJJbnB1dCgpIHtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAga2V5d29yZDogXCJcIixcbiAgICAgIHJlc3VsdEVycm9yOiBmYWxzZSxcbiAgICAgIHJlc3VsdExpc3Q6W11cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBpbnB1dFR5cGluZyhldmVudDogYW55KSB7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIHJlc3VsdEVycm9yOiBmYWxzZSxcbiAgICAgIGtleXdvcmQ6IGV2ZW50LmRldGFpbC52YWx1ZSxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBwZXJmb3JtU2VhcmNoKCkge1xuICAgIGxldCBrZXl3b3JkID0gdGhpcy5kYXRhLmtleXdvcmQ7XG4gICAgbGV0IHJlcSA9IHsgcXVlcnk6IGtleXdvcmQsIGZpbHRlcl90eXBlOiB0aGlzLmZpbHRlclR5cGUsIG1lYWxfdHlwZTogdGhpcy5tZWFsVHlwZSB9O1xuICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICB3eC5zaG93TG9hZGluZyh7XG4gICAgICB0aXRsZTon5Yqg6L295LitLi4uJ1xuICAgIH0pXG4gICAgd2ViQVBJLlJldHJpZXZlVGV4dFNlYXJjaChyZXEpLnRoZW4ocmVzcCA9PiB7XG4gICAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgICB0aGF0LnNldFJlc3VsdExpc3QocmVzcCk7XG4gICAgfSkuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpO1xuICB9XG5cbiAgcHVibGljIHNldFJlc3VsdExpc3QocmVzcDogUmV0cmlldmVUZXh0U2VhcmNoUmVzcCkge1xuICAgIGxldCByZXN1bHRzID0gW107XG4gICAgaWYgKHJlc3AucmVzdWx0X2xpc3QubGVuZ3RoPT0wKSB7XG4gICAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgICByZXN1bHRMaXN0OiBbXSxcbiAgICAgICAgcmVzdWx0RXJyb3I6IHRydWVcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAobGV0IGluZGV4IGluIHJlc3AucmVzdWx0X2xpc3QpIHtcbiAgICAgICAgbGV0IGl0ZW0gPSByZXNwLnJlc3VsdF9saXN0W2luZGV4XTtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHtcbiAgICAgICAgICBmb29kSWQ6IGl0ZW0uZm9vZF9pZCxcbiAgICAgICAgICBmb29kTmFtZTogaXRlbS5mb29kX25hbWUsXG4gICAgICAgICAgZm9vZFR5cGU6IGl0ZW0uZm9vZF90eXBlLFxuICAgICAgICAgIGFtb3VudDogaXRlbS5hbW91bnQsXG4gICAgICAgICAgdW5pdDogaXRlbS51bml0X25hbWUsXG4gICAgICAgICAgZW5lcmd5OiBNYXRoLmZsb29yKGl0ZW0uZW5lcmd5IC8gMTAwKVxuICAgICAgICB9XG4gICAgICAgIHJlc3VsdHMucHVzaChyZXN1bHQpO1xuICAgICAgfVxuICAgICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgICAgcmVzdWx0TGlzdDogcmVzdWx0cyxcbiAgICAgICAgcmVzdWx0RXJyb3I6IGZhbHNlXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc29sZS5sb2codGhpcy5kYXRhLnJlc3VsdExpc3QpO1xuICB9XG5cbiBcbiAgcHVibGljIG9uVGV4dFNlYXJjaFJlc3VsdFNlbGVjdChldmVudDogYW55KSB7XG4gICAgbGV0IGluZGV4ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LnRleHRJbmRleDtcbiAgICB0aGlzLmdldEZvb2RVbml0T3B0aW9uKHRoaXMuZGF0YS5yZXN1bHRMaXN0W2luZGV4XSk7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIHJlY2VudFJlc3VsdFNlbGVjdEluZGV4Om51bGwsXG4gICAgICBjb21tb25Gb29kSW5kZXg6bnVsbCxcbiAgICAgIHRleHRTZWFyY2hSZXN1bHRTZWxlY3RJbmRleDppbmRleCxcbiAgICB9LCgpPT57XG4gICAgICB0ZXh0Q2FjaGUuc2V0VmFsdWUodGhpcy5kYXRhLnJlc3VsdExpc3RbaW5kZXhdKTtcbiAgICAgIHRoaXMuZ2V0UmVjZW50TGlzdCgpO1xuICAgIH0pXG4gIH1cbiAgcHVibGljIGhhbmRsZVRhcENvbW1vbkZvb2RJdGVtKGV2ZW50OiBhbnkpe1xuICAgIGxldCBpbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC50ZXh0SW5kZXg7XG4gICAgdGhpcy5nZXRGb29kVW5pdE9wdGlvbih0aGlzLmRhdGEuY29tbW9uRm9vZExpc3RbaW5kZXhdKTtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgdGV4dFNlYXJjaFJlc3VsdFNlbGVjdEluZGV4Om51bGwsXG4gICAgICByZWNlbnRSZXN1bHRTZWxlY3RJbmRleDpudWxsLFxuICAgICAgY29tbW9uRm9vZEluZGV4OmluZGV4LFxuICAgIH0pXG4gICAgLy8gdGV4dENhY2hlLnNldFZhbHVlKHRoaXMuZGF0YS5jb21tb25Gb29kTGlzdFtpbmRleF0pO1xuICAgIC8vIHRoaXMuZ2V0UmVjZW50TGlzdCgpXG4gIH1cblxuICBwdWJsaWMgb25SZWNlbnRSZXN1bHRTZWxlY3QoZXZlbnQ6IGFueSl7XG4gICAgbGV0IGluZGV4ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LnRleHRJbmRleDtcbiAgICB0aGlzLmdldEZvb2RVbml0T3B0aW9uKHRoaXMuZGF0YS5yZWNlbnRMaXN0W2luZGV4XSk7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIHRleHRTZWFyY2hSZXN1bHRTZWxlY3RJbmRleDpudWxsLFxuICAgICAgY29tbW9uRm9vZEluZGV4Om51bGwsXG4gICAgICByZWNlbnRSZXN1bHRTZWxlY3RJbmRleDppbmRleCxcbiAgICB9KVxuICB9XG5cbiAgcHVibGljIGRlbGV0ZVRleHRTZWFyY2hDYWNoZShldmVudDogYW55KXtcbiAgICB0ZXh0Q2FjaGUuY2xlYXJBbGwoKTtcbiAgICB0aGlzLmdldFJlY2VudExpc3QoKTtcbiAgfVxuICAvKipcbiAgICog5YWz6Zet5by556qXcG9wdXDmoYZcbiAgICovXG4gIHB1YmxpYyBvbkNsb3NlKCl7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHsgc2hvd1BvcHVwOiBmYWxzZSxzaG93Q2hvb3NlZExpc3RzOmZhbHNlfSk7XG4gIH1cbi8qKlxuICog5YiH5o2i5bey6YCJ6aOf54mp5YiX6KGo55qE5pi+56S65LiO6ZqQ6JePXG4gKi9cbiAgcHVibGljIHRvZ2dsZUNob29zZWRMaXN0cygpe1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7c2hvd0Nob29zZWRMaXN0czohdGhpcy5kYXRhLnNob3dDaG9vc2VkTGlzdHN9KVxuICB9XG4gIC8qKlxuICAgKiDngrnlh7vmt7vliqDmjInpkq7vvIzlsIbpo5/nianmt7vliqDoh7Plt7LpgIlcbiAgICovXG4gIHB1YmxpYyBoYW5kbGVBZGRGb29kKCl7XG4gICAgbGV0IHRleHRTZWFyY2hSZXN1bHRTZWxlY3RJbmRleCA9IHRoaXMuZGF0YS50ZXh0U2VhcmNoUmVzdWx0U2VsZWN0SW5kZXg7XG4gICAgbGV0IHJlY2VudFJlc3VsdFNlbGVjdEluZGV4ID0gdGhpcy5kYXRhLnJlY2VudFJlc3VsdFNlbGVjdEluZGV4O1xuICAgIGxldCBjb21tb25Gb29kSW5kZXggPSB0aGlzLmRhdGEuY29tbW9uRm9vZEluZGV4O1xuICAgIGlmKHJlY2VudFJlc3VsdFNlbGVjdEluZGV4ICE9PSBudWxsICl7XG4gICAgICBsZXQgaXRlbTphbnkgPSB0aGlzLmRhdGEucmVjZW50TGlzdFtyZWNlbnRSZXN1bHRTZWxlY3RJbmRleF07XG4gICAgfWVsc2UgaWYodGV4dFNlYXJjaFJlc3VsdFNlbGVjdEluZGV4ICE9PSBudWxsKXtcbiAgICAgIGxldCBpdGVtOmFueSA9IHRoaXMuZGF0YS5yZXN1bHRMaXN0W3RleHRTZWFyY2hSZXN1bHRTZWxlY3RJbmRleF07XG4gICAgfWVsc2V7XG4gICAgICBsZXQgaXRlbTphbnkgPSB0aGlzLmRhdGEuY29tbW9uRm9vZExpc3RbY29tbW9uRm9vZEluZGV4XTtcbiAgICB9XG4gICAgaXRlbSA9IHtcbiAgICAgIC4uLml0ZW0sXG4gICAgICBjaG9vc2VkVW5pdDp0aGlzLmRhdGEudW5pdEFyclt0aGlzLmRhdGEuY2hvb3NlVWluaXRJbmRleF0sXG4gICAgICB3ZWlnaHROdW1iZXI6dGhpcy5kYXRhLmZvb2ROdW1WYWx1ZSxcbiAgICAgIHVuaXRFbmVyZ3k6dGhpcy5kYXRhLmZvb2RVbml0QW5kVW5pdEVuZXJneVt0aGlzLmRhdGEuY2hvb3NlVWluaXRJbmRleF0udW5pdEVuZXJneSxcbiAgICAgIHVuaXRfaWQ6dGhpcy5kYXRhLmZvb2RVbml0QW5kVW5pdEVuZXJneVt0aGlzLmRhdGEuY2hvb3NlVWluaXRJbmRleF0udW5pdF9pZFxuICAgIH07XG4gICAgdGhpcy5kYXRhLmNob29zZWRMaXN0cy5wdXNoKGl0ZW0pO1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7IFxuICAgICAgY2hvb3NlZExpc3RzIDogdGhpcy5kYXRhLmNob29zZWRMaXN0cyxcbiAgICAgIHNob3dQb3B1cCA6IGZhbHNlXG4gICAgfSwoKT0+e1xuICAgICAgdGhpcy5zdW1FbmVyZ3koKTtcbiAgICAgIGlmKHJlY2VudFJlc3VsdFNlbGVjdEluZGV4ICE9PSBudWxsKXsgLy8g5Li65Y6G5Y+y5pCc57Si6YeN5paw5o6S5bqPXG4gICAgICAgIHRleHRDYWNoZS5zZXRWYWx1ZSh0aGlzLmRhdGEucmVjZW50TGlzdFtyZWNlbnRSZXN1bHRTZWxlY3RJbmRleF0pXG4gICAgICAgIHRoaXMuZ2V0UmVjZW50TGlzdCgpO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2codGhpcy5kYXRhLmNob29zZWRMaXN0cykgICBcbiAgICB9KVxuICB9XG4gIC8qKlxuICAgKiBAcGFyYW0g6K6h566X55So5oi36aOf54mp5LiA5YWx5pyJ5aSa5bCR54Ot6YePXG4gICAqL1xuICBwdWJsaWMgc3VtRW5lcmd5KCl7XG4gICAgY29uc3QgdG90YWxFbmVyZ3kgPSB0aGlzLmRhdGEuY2hvb3NlZExpc3RzLnJlZHVjZSgocHJlLG5leHQpPT57XG4gICAgICByZXR1cm4gbmV4dC53ZWlnaHROdW1iZXIqbmV4dC51bml0RW5lcmd5K3ByZVxuICAgIH0sMCk7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHt0b3RhbEVuZXJneTp0b3RhbEVuZXJneX0pXG4gIH1cblxuICAvKipcbiAgICog55So5oi36L6T5YWl6aOf54mp55qE5Lu95pWwXG4gICAqL1xuICBwdWJsaWMgaGFuZGxlRm9vZE51bUlucHV0KGU6YW55KXtcbiAgICBsZXQgZm9vZE51bVZhbHVlID0gcGFyc2VJbnQoZS5kZXRhaWwudmFsdWUpO1xuICAgIC8vIGZvb2ROdW1WYWx1ZSA9IGlzTmFOKGZvb2ROdW1WYWx1ZSkgPyAwIDogZm9vZE51bVZhbHVlO1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7Zm9vZE51bVZhbHVlOmZvb2ROdW1WYWx1ZX0pXG4gIH1cbiAgLyoqXG4gICAqIOWxleekunBpY2tlcu+8jOmAieaLqemjn+eJqeWNleS9jVxuICAgKi9cbiAgcHVibGljIHNob3dQaWNrZXIoKXtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe3Nob3dQaWNrZXI6dHJ1ZSxzaG93UG9wdXA6ZmFsc2V9KVxuICB9XG4gIHB1YmxpYyBvbkNvbmZpcm0oKXtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe3Nob3dQaWNrZXI6ZmFsc2Usc2hvd1BvcHVwOnRydWV9KVxuICB9XG4gIHB1YmxpYyBvbkNoYW5nZShlOmFueSl7XG4gICAgbGV0IGNob29zZVVpbml0SW5kZXg6bnVtYmVyID0gZS5kZXRhaWwuaW5kZXg7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtjaG9vc2VVaW5pdEluZGV4OmNob29zZVVpbml0SW5kZXh9KVxuICB9XG4gIC8qKlxuICAgKiDliKDpmaTpgInkuK3liJfooajkuK3nmoTmn5DkuIDpoblcbiAgICovXG4gIHB1YmxpYyBoYW5kbGVEZWxldGVDaG9vc2VkSXRlbShlOmFueSl7XG4gICAgbGV0IGluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXg7XG4gICAgdGhpcy5kYXRhLmNob29zZWRMaXN0cy5zcGxpY2UoaW5kZXgsMSk7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtjaG9vc2VkTGlzdHM6dGhpcy5kYXRhLmNob29zZWRMaXN0c30sKCk9PntcbiAgICAgIHRoaXMuc3VtRW5lcmd5KClcbiAgICAgIGlmKHRoaXMuZGF0YS5jaG9vc2VkTGlzdHMubGVuZ3RoPT09MCl7XG4gICAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7c2hvd0Nob29zZWRMaXN0czpmYWxzZX0pXG4gICAgICB9XG4gICAgfSlcbiAgfVxuICAvKipcbiAgICog5om56YeP5re75Yqg6aOf54mp5pW05ZCI5Y+C5pWwXG4gICAqL1xuICBwdWJsaWMgaGFuZGxlQ29uZmlybUJ0bigpe1xuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6IFwi5Yqg6L295LitLi4uXCIsIG1hc2s6IHRydWUgfSk7XG4gICAgbGV0IGZvb2RJbmZvTGlzdDphbnlbXSA9IFtdO1xuICAgIGNvbnNvbGUubG9nKDg4OCx0aGlzLmRhdGEuY2hvb3NlZExpc3RzKVxuICAgIHRoaXMuZGF0YS5jaG9vc2VkTGlzdHMubWFwKChpdGVtOmFueSkgPT4ge1xuICAgICAgLy/mloflrZfmkJzntKLvvIzkuI3lho3opoFyZWNvZ25pdGlvblJlc3VsdHPvvIzlm6DkuLrnrKzkuIDpobnlkozlpJbpnaLmlbDmja7kuIDmoLdcbiAgICAgIC8vIGxldCByZXN1bHRzID0gW3sgZm9vZElkOiBpdGVtLmZvb2RJZCwgZm9vZE5hbWU6IGl0ZW0uZm9vZE5hbWUsIGZvb2RUeXBlOiBpdGVtLmZvb2RUeXBlIH1dO1xuICAgICAgbGV0IGZvb2QgPSB7IFxuICAgICAgICBmb29kSWQ6IGl0ZW0uZm9vZElkLCBcbiAgICAgICAgZm9vZFR5cGU6IGl0ZW0uZm9vZFR5cGUsIFxuICAgICAgICAvLyByZWNvZ25pdGlvbl9yZXN1bHRzOiByZXN1bHRzLFxuICAgICAgICBpbnB1dFR5cGU6IDIsIFxuICAgICAgICBhbW91bnQ6cGFyc2VJbnQoaXRlbS53ZWlnaHROdW1iZXIpLFxuICAgICAgICB1bml0SWQ6IGl0ZW0udW5pdF9pZFxuICAgICAgfTtcbiAgICAgIGZvb2RJbmZvTGlzdC5wdXNoKGZvb2QpXG4gICAgfSlcbiAgICBsZXQgcmVxID0geyBtZWFsVHlwZTogdGhpcy5tZWFsVHlwZSwgbWVhbERhdGU6IHRoaXMubWVhbERhdGUsIGZvb2RJbmZvTGlzdH07XG4gICAgY29uc29sZS5sb2coJ+ivt+axguWPguaVsHJlcScscmVxKVxuICAgIHRoaXMuY3JlYXRlTWVhbExvZyhyZXEpO1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZU1lYWxMb2cocmVxKXtcbiAgICByZXF1ZXN0LmNyZWF0ZU1lYWxMb2cocmVxKS50aGVuKHJlcz0+e1xuICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgXG4gICAgfSkuY2F0Y2goZXJyPT57XG4gICAgICB3eC5zaG93VG9hc3Qoe3RpdGxlOiAn5o+Q5Lqk6aOf54mp6K6w5b2V5aSx6LSlJyxpY29uOiAnbm9uZSd9KTtcbiAgICB9KVxuICB9XG4gIFxuXG5cblxuXG5cblxuICAvKipcbiAgICog5qC85byP5YyW5pWw5o2u5ZCO77yM5Y+R5Ye66K+35rGC77yM6I635b6XbWVhbF9pZFxuICAgKi9cbiAgcHVibGljIENyZWF0ZU9yVXBkYXRlTWVhbExvZyhyZXE6YW55KXtcbiAgICBsZXQgaW1hZ2VVcmwgPSBcImh0dHBzOi8vZGlldGxlbnMtMTI1ODY2NTU0Ny5jb3MuYXAtc2hhbmdoYWkubXlxY2xvdWQuY29tL21pbmktYXBwLWltYWdlL2RlZmF1bHRJbWFnZS90ZXh0c2VhcmNoLWRlZmF1bHQtaW1hZ2UucG5nXCI7XG4gICAgd2ViQVBJLkNyZWF0ZU9yVXBkYXRlTWVhbExvZyhyZXEpLnRoZW4ocmVzcCA9PiB7XG4gICAgICAvLyBsZXQgcGFyYW06YW55ID0ge307XG4gICAgICAvLyBwYXJhbS5tZWFsSWQgPSByZXNwLm1lYWxfaWQ7XG4gICAgICAvLyBwYXJhbS5pbWFnZVVybCA9IGltYWdlVXJsO1xuICAgICAgLy8gcGFyYW0uc2hvd1NoYXJlQnRuID0gZmFsc2U7XG4gICAgICAvLyBsZXQgcGFyYW1Kc29uID0gSlNPTi5zdHJpbmdpZnkocGFyYW0pO1xuICAgICAgdGhpcy5Db25maXJtTWVhbExvZyhyZXNwLm1lYWxfaWQpXG4gICAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgIHd4LnNob3dUb2FzdCh7dGl0bGU6ICfor7fmsYLlpLHotKUnLGljb246ICdub25lJ30pO1xuICAgICAgd3guaGlkZUxvYWRpbmcoe30pO1xuICAgIH0pO1xuICB9XG4gIC8qKlxuICAgKiDlj5Hlh7ror7fmsYLvvIzliJvlu7rorrDlvZVcbiAgICovXG4gIHB1YmxpYyBDb25maXJtTWVhbExvZyhtZWFsX2lkOm51bWJlcil7XG4gICAgbGV0IHJlcSA9IHsgbWVhbF9pZDogbWVhbF9pZCB9O1xuICAgIHdlYkFQSS5Db25maXJtTWVhbExvZyhyZXEpLnRoZW4ocmVzcCA9PiB7XG4gICAgICB3eC5oaWRlTG9hZGluZyh7fSk7XG4gICAgICB3eC5uYXZpZ2F0ZVRvKHsgdXJsOiBgLi4vLi4vaG9tZVN1Yi9wYWdlcy9tZWFsQW5hbHlzaXMvaW5kZXg/bWVhbERhdGU9JHt0aGlzLm1lYWxEYXRlfSZtZWFsVHlwZT0ke3RoaXMubWVhbFR5cGV9YH0pXG4gICAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgIHd4LnNob3dUb2FzdCh7dGl0bGU6ICfmj5DkuqTpo5/nianorrDlvZXlpLHotKUnLGljb246ICdub25lJ30pO1xuICAgIH0pO1xuICB9XG4gIC8qKlxuICAgKiDljrvpo5/niankvLDnrpfph43ph4/nmoTpobXpnaJcbiAgICovXG4gIHB1YmxpYyBnb1dlaWdodFJlZmVyZW5jZVBhZ2UoKXtcbiAgICB3eC5uYXZpZ2F0ZVRvKHt1cmw6Jy4vLi4vLi4vaG9tZVN1Yi9wYWdlcy93ZWlnaHRSZWZlcmVuY2UvaW5kZXgnfSlcbiAgfVxuXG59XG5cblBhZ2UobmV3IHRleHRTZWFyY2goKSlcbiJdfQ==