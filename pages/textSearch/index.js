"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
var webAPI = require("../../api/app/AppService");
var interface_1 = require("../../api/app/interface");
var globalEnum = require("../../api/GlobalEnum");
var textCache = require("./textCache/TextCache");
var list_js_1 = require("./list.js");
var moment = require("moment");
var textSearch = (function () {
    function textSearch() {
        this.filterType = 0;
        this.mealType = 0;
        this.naviType = 0;
        this.mealDate = 0;
        this.data = {
            keyword: "",
            inputShowed: false,
            resultList: [],
            resultError: [],
            recentList: [],
            commonFoodList: [],
            showChoosedLists: false,
            showChoosedConfirm: false,
            showPopup: false,
            showPicker: false,
            choosedLists: [],
            unitArr: ['克', '碗', '把', '捧', '盆', '瓢'],
            foodUnitAndUnitEnergy: [],
            foodNumValue: 100,
            chooseUinitIndex: 0,
            textSearchResultSelectIndex: null,
            recentResultSelectIndex: null,
            commonFoodIndex: null,
            totalEnergy: 0,
        };
    }
    textSearch.prototype.onLoad = function (options) {
        webAPI.SetAuthToken(wx.getStorageSync(globalEnum.globalKey_token));
        var title = options.title;
        this.filterType = parseInt(options.filterType);
        this.mealType = parseInt(options.mealType);
        this.naviType = parseInt(options.naviType);
        this.mealDate = parseInt(options.mealDate);
        wx.setNavigationBarTitle({
            title: "添加" + title
        });
        this.getCommonFoodList();
    };
    textSearch.prototype.onShow = function () {
        this.getRecentList();
    };
    textSearch.prototype.getCommonFoodList = function () {
        var hour = parseInt(moment().format('HH'));
        if (hour >= 16) {
            this.setData({ commonFoodList: list_js_1.default.c });
            return;
        }
        else if (hour >= 10) {
            this.setData({ commonFoodList: list_js_1.default.b });
            return;
        }
        else {
            this.setData({ commonFoodList: list_js_1.default.a });
        }
    };
    textSearch.prototype.getFoodUnitOption = function (item) {
        var that = this;
        interface_1.default.getFoodUnitOption({
            foodId: item.foodId,
            foodType: item.foodType
        }).then(function (res) {
            console.log('getFoodUnitOption', res);
            that.parseFoodUnitOptionResp(res);
        }).catch(function (err) {
            wx.showToast({
                title: '获取食物信息失败',
                icon: 'none'
            });
        });
    };
    textSearch.prototype.parseFoodUnitOptionResp = function (res) {
        var arr = res.unitOption.map(function (item) {
            return {
                name: item.unitName,
                unitEnergy: Math.round(item.energy),
                unit_id: item.unitId
            };
        });
        var nameArr = arr.map(function (item) { return item.name; });
        this.setData({
            foodNumValue: res.unitOption[0].unitWeight / 100,
            chooseUinitIndex: 0,
            unitArr: nameArr,
            foodUnitAndUnitEnergy: arr,
            showPopup: true
        });
    };
    textSearch.prototype.getRecentList = function () {
        var recentList = textCache.getAllValue();
        this.setData({
            recentList: recentList
        });
    };
    textSearch.prototype.showInput = function () {
        this.setData({
            inputShowed: true
        });
    };
    textSearch.prototype.clearInput = function () {
        this.setData({
            keyword: "",
            resultError: false,
            resultList: []
        });
    };
    textSearch.prototype.inputTyping = function (event) {
        this.setData({
            resultError: false,
            keyword: event.detail.value,
        });
    };
    textSearch.prototype.performSearch = function () {
        var keyword = this.data.keyword;
        var req = { query: keyword, filter_type: this.filterType, meal_type: this.mealType };
        var that = this;
        wx.showLoading({
            title: '加载中...'
        });
        webAPI.RetrieveTextSearch(req).then(function (resp) {
            wx.hideLoading();
            that.setResultList(resp);
        }).catch(function (err) { return console.log(err); });
    };
    textSearch.prototype.setResultList = function (resp) {
        var results = [];
        if (resp.result_list.length == 0) {
            this.setData({
                resultList: [],
                resultError: true
            });
        }
        else {
            for (var index in resp.result_list) {
                var item = resp.result_list[index];
                var result = {
                    foodId: item.food_id,
                    foodName: item.food_name,
                    foodType: item.food_type,
                    amount: item.amount,
                    unit: item.unit_name,
                    energy: Math.floor(item.energy / 100)
                };
                results.push(result);
            }
            this.setData({
                resultList: results,
                resultError: false
            });
        }
        console.log(this.data.resultList);
    };
    textSearch.prototype.onTextSearchResultSelect = function (event) {
        var _this = this;
        var index = event.currentTarget.dataset.textIndex;
        this.getFoodUnitOption(this.data.resultList[index]);
        this.setData({
            recentResultSelectIndex: null,
            commonFoodIndex: null,
            textSearchResultSelectIndex: index,
        }, function () {
            textCache.setValue(_this.data.resultList[index]);
            _this.getRecentList();
        });
    };
    textSearch.prototype.handleTapCommonFoodItem = function (event) {
        var index = event.currentTarget.dataset.textIndex;
        this.getFoodUnitOption(this.data.commonFoodList[index]);
        this.setData({
            textSearchResultSelectIndex: null,
            recentResultSelectIndex: null,
            commonFoodIndex: index,
        });
    };
    textSearch.prototype.onRecentResultSelect = function (event) {
        var index = event.currentTarget.dataset.textIndex;
        this.getFoodUnitOption(this.data.recentList[index]);
        this.setData({
            textSearchResultSelectIndex: null,
            commonFoodIndex: null,
            recentResultSelectIndex: index,
        });
    };
    textSearch.prototype.deleteTextSearchCache = function (event) {
        textCache.clearAll();
        this.getRecentList();
    };
    textSearch.prototype.onClose = function () {
        this.setData({ showPopup: false, showChoosedLists: false });
    };
    textSearch.prototype.toggleChoosedLists = function () {
        this.setData({ showChoosedLists: !this.data.showChoosedLists });
    };
    textSearch.prototype.handleAddFood = function () {
        var _this = this;
        var textSearchResultSelectIndex = this.data.textSearchResultSelectIndex;
        var recentResultSelectIndex = this.data.recentResultSelectIndex;
        var commonFoodIndex = this.data.commonFoodIndex;
        if (recentResultSelectIndex !== null) {
            var item = this.data.recentList[recentResultSelectIndex];
        }
        else if (textSearchResultSelectIndex !== null) {
            var item = this.data.resultList[textSearchResultSelectIndex];
        }
        else {
            var item = this.data.commonFoodList[commonFoodIndex];
        }
        item = __assign({}, item, { choosedUnit: this.data.unitArr[this.data.chooseUinitIndex], weightNumber: this.data.foodNumValue, unitEnergy: this.data.foodUnitAndUnitEnergy[this.data.chooseUinitIndex].unitEnergy, unit_id: this.data.foodUnitAndUnitEnergy[this.data.chooseUinitIndex].unit_id });
        this.data.choosedLists.push(item);
        this.setData({
            choosedLists: this.data.choosedLists,
            showPopup: false
        }, function () {
            _this.sumEnergy();
            if (recentResultSelectIndex !== null) {
                textCache.setValue(_this.data.recentList[recentResultSelectIndex]);
                _this.getRecentList();
            }
            console.log(_this.data.choosedLists);
        });
    };
    textSearch.prototype.sumEnergy = function () {
        var totalEnergy = this.data.choosedLists.reduce(function (pre, next) {
            return next.weightNumber * next.unitEnergy + pre;
        }, 0);
        this.setData({ totalEnergy: totalEnergy });
    };
    textSearch.prototype.handleFoodNumInput = function (e) {
        var foodNumValue = parseInt(e.detail.value);
        this.setData({ foodNumValue: foodNumValue });
    };
    textSearch.prototype.showPicker = function () {
        this.setData({ showPicker: true, showPopup: false });
    };
    textSearch.prototype.onConfirm = function () {
        this.setData({ showPicker: false, showPopup: true });
    };
    textSearch.prototype.onChange = function (e) {
        var chooseUinitIndex = e.detail.index;
        this.setData({ chooseUinitIndex: chooseUinitIndex });
    };
    textSearch.prototype.handleDeleteChoosedItem = function (e) {
        var _this = this;
        var index = e.currentTarget.dataset.index;
        this.data.choosedLists.splice(index, 1);
        this.setData({ choosedLists: this.data.choosedLists }, function () {
            _this.sumEnergy();
            if (_this.data.choosedLists.length === 0) {
                _this.setData({ showChoosedLists: false });
            }
        });
    };
    textSearch.prototype.handleConfirmBtn = function () {
        wx.showLoading({ title: "加载中...", mask: true });
        var foodList = [];
        this.data.choosedLists.map(function (item) {
            var results = [{ food_id: item.foodId, food_name: item.foodName, food_type: item.foodType }];
            var food = {
                food_id: item.foodId,
                food_type: item.foodType,
                recognition_results: results,
                input_type: 2,
                amount: parseInt(item.weightNumber) * 100,
                unit_id: item.unit_id
            };
            foodList.push(food);
        });
        var req = { meal_id: -1, meal_type: this.mealType, meal_date: this.mealDate, food_list: foodList };
        console.log('请求参数req', req);
        this.CreateOrUpdateMealLog(req);
    };
    textSearch.prototype.CreateOrUpdateMealLog = function (req) {
        var _this = this;
        var imageUrl = "https://dietlens-1258665547.cos.ap-shanghai.myqcloud.com/mini-app-image/defaultImage/textsearch-default-image.png";
        webAPI.CreateOrUpdateMealLog(req).then(function (resp) {
            _this.ConfirmMealLog(resp.meal_id);
        }).catch(function (err) {
            wx.showToast({ title: '请求失败', icon: 'none' });
            wx.hideLoading({});
        });
    };
    textSearch.prototype.ConfirmMealLog = function (meal_id) {
        var _this = this;
        var req = { meal_id: meal_id };
        webAPI.ConfirmMealLog(req).then(function (resp) {
            wx.hideLoading({});
            wx.navigateTo({ url: "../../homeSub/pages/mealAnalysis/index?mealDate=" + _this.mealDate + "&mealType=" + _this.mealType });
        }).catch(function (err) {
            wx.showToast({ title: '提交食物记录失败', icon: 'none' });
        });
    };
    return textSearch;
}());
Page(new textSearch());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEsaURBQW1EO0FBQ25ELHFEQUE4QztBQUU5QyxpREFBa0Q7QUFDbEQsaURBQWtEO0FBQ2xELHFDQUFzQztBQUN0QywrQkFBa0M7QUFjbEM7SUFBQTtRQUNTLGVBQVUsR0FBRyxDQUFDLENBQUM7UUFDZixhQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ2IsYUFBUSxHQUFHLENBQUMsQ0FBQztRQUNiLGFBQVEsR0FBRyxDQUFDLENBQUM7UUFFYixTQUFJLEdBQUc7WUFDWixPQUFPLEVBQUUsRUFBRTtZQUNYLFdBQVcsRUFBRSxLQUFLO1lBQ2xCLFVBQVUsRUFBRSxFQUFFO1lBQ2QsV0FBVyxFQUFFLEVBQUU7WUFDZixVQUFVLEVBQUUsRUFBRTtZQUNkLGNBQWMsRUFBQyxFQUFFO1lBQ2pCLGdCQUFnQixFQUFDLEtBQUs7WUFDdEIsa0JBQWtCLEVBQUMsS0FBSztZQUN4QixTQUFTLEVBQUUsS0FBSztZQUNoQixVQUFVLEVBQUMsS0FBSztZQUNoQixZQUFZLEVBQUMsRUFBRTtZQUNmLE9BQU8sRUFBQyxDQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxDQUFDO1lBQ2pDLHFCQUFxQixFQUFDLEVBQUU7WUFDeEIsWUFBWSxFQUFDLEdBQUc7WUFDaEIsZ0JBQWdCLEVBQUMsQ0FBQztZQUNsQiwyQkFBMkIsRUFBQyxJQUFJO1lBQ2hDLHVCQUF1QixFQUFDLElBQUk7WUFDNUIsZUFBZSxFQUFDLElBQUk7WUFDcEIsV0FBVyxFQUFDLENBQUM7U0FDZCxDQUFBO0lBMFVILENBQUM7SUF4VVEsMkJBQU0sR0FBYixVQUFjLE9BQVk7UUFDeEIsTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO1FB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QUMsVUFBQSxHQUFHO1lBQ1YsRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFDLEtBQUssRUFBRSxVQUFVLEVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUgsaUJBQUM7QUFBRCxDQUFDLEFBcFdELElBb1dDO0FBRUQsSUFBSSxDQUFDLElBQUksVUFBVSxFQUFFLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHdlYkFQSSBmcm9tICcuLi8uLi9hcGkvYXBwL0FwcFNlcnZpY2UnO1xuaW1wb3J0IHJlcXVlc3QgZnJvbSAnLi4vLi4vYXBpL2FwcC9pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUmV0cmlldmVUZXh0U2VhcmNoUmVxLCBSZXRyaWV2ZVRleHRTZWFyY2hSZXNwLCBDcmVhdGVPclVwZGF0ZU1lYWxMb2dSZXEsIEFkZFJlY2lwZUl0ZW1SZXEsIE1lYWxMb2dSZXNwIH0gZnJvbSBcIi9hcGkvYXBwL0FwcFNlcnZpY2VPYmpzXCJcbmltcG9ydCAqIGFzIGdsb2JhbEVudW0gZnJvbSAnLi4vLi4vYXBpL0dsb2JhbEVudW0nXG5pbXBvcnQgKiBhcyB0ZXh0Q2FjaGUgZnJvbSAnLi90ZXh0Q2FjaGUvVGV4dENhY2hlJ1xuaW1wb3J0IGNvbW1vbkZvb2RMaXN0IGZyb20gJy4vbGlzdC5qcydcbmltcG9ydCBtb21lbnQgPSByZXF1aXJlKCdtb21lbnQnKTtcblxudHlwZSBkYXRhID0ge1xuICBrZXl3b3JkOiBTdHJpbmc7XG4gIHJlc3VsdExpc3Q6IFJlc3VsdFtdO1xufVxuXG50eXBlIFJlc3VsdCA9IHtcbiAgZm9vZElkOiBudW1iZXI7XG4gIGRpc3BsYXlOYW1lOiBTdHJpbmc7XG4gIGZvb2RUeXBlOiBudW1iZXI7XG4gIGVuZ3J5OiBudW1iZXI7XG59XG5cbmNsYXNzIHRleHRTZWFyY2gge1xuICBwdWJsaWMgZmlsdGVyVHlwZSA9IDA7IC8vMC5hbGwgMS5yZWNpcGUgMi5pbmdyZWlkZW50XG4gIHB1YmxpYyBtZWFsVHlwZSA9IDA7IC8vMS5icmVha2Zhc3QgMi5sdW5jaCAzLmRpbm5lciA0LnNuYWNrXG4gIHB1YmxpYyBuYXZpVHlwZSA9IDA7IC8vMC50ZXh0c2VhcmNoID0+IGRldGFpbCAxLnRleHRzZWFyY2ggPT4gdGFnIDIudGV4dHNlYXJjaD0+IGluZ3JlZGllbnRcbiAgcHVibGljIG1lYWxEYXRlID0gMDsgLy9wcmV2IHBhZ2UgbXVzdCBwYXNzIG1lYWxEYXRlIHRvIHRleHRTZWFyY2ggcGFnZVxuXG4gIHB1YmxpYyBkYXRhID0ge1xuICAgIGtleXdvcmQ6IFwiXCIsXG4gICAgaW5wdXRTaG93ZWQ6IGZhbHNlLFxuICAgIHJlc3VsdExpc3Q6IFtdLFxuICAgIHJlc3VsdEVycm9yOiBbXSxcbiAgICByZWNlbnRMaXN0OiBbXSxcbiAgICBjb21tb25Gb29kTGlzdDpbXSwgLy8g5bi46KeB6aOf54mp5YiX6KGoXG4gICAgc2hvd0Nob29zZWRMaXN0czpmYWxzZSxcbiAgICBzaG93Q2hvb3NlZENvbmZpcm06ZmFsc2UsXG4gICAgc2hvd1BvcHVwOiBmYWxzZSxcbiAgICBzaG93UGlja2VyOmZhbHNlLFxuICAgIGNob29zZWRMaXN0czpbXSwgIC8vIOW3sue7j+a3u+WKoOeahOmjn+eJqeS/oeaBr+WIl+ihqFxuICAgIHVuaXRBcnI6WyflhYsnLCfnopcnLCfmioonLCfmjacnLCfnm4YnLCfnk6InXSxcbiAgICBmb29kVW5pdEFuZFVuaXRFbmVyZ3k6W10sXG4gICAgZm9vZE51bVZhbHVlOjEwMCxcbiAgICBjaG9vc2VVaW5pdEluZGV4OjAsIC8vIOeUqOaIt+mAieaLqeS6hnBpY2tlcuS4reeahGluZGV4XG4gICAgdGV4dFNlYXJjaFJlc3VsdFNlbGVjdEluZGV4Om51bGwsIC8vIOeUqOaIt+eCueWHu+aWh+Wtl+aQnOe0ouWIl+ihqOS4reeahOWTquS4gOmhuVxuICAgIHJlY2VudFJlc3VsdFNlbGVjdEluZGV4Om51bGwsIC8vIOeUqOaIt+eCueWHu+S6huWOhuWPsue8k+WtmOaVsOe7hOS4reeahGluZGV4XG4gICAgY29tbW9uRm9vZEluZGV4Om51bGwsIC8vIOW4uOingeWIl+ihqOS4reeahGluZGV4XG4gICAgdG90YWxFbmVyZ3k6MCxcbiAgfVxuXG4gIHB1YmxpYyBvbkxvYWQob3B0aW9uczogYW55KSB7XG4gICAgd2ViQVBJLlNldEF1dGhUb2tlbih3eC5nZXRTdG9yYWdlU3luYyhnbG9iYWxFbnVtLmdsb2JhbEtleV90b2tlbikpO1xuICAgIGxldCB0aXRsZSA9IG9wdGlvbnMudGl0bGU7XG4gICAgdGhpcy5maWx0ZXJUeXBlID0gcGFyc2VJbnQob3B0aW9ucy5maWx0ZXJUeXBlKTtcbiAgICB0aGlzLm1lYWxUeXBlID0gcGFyc2VJbnQob3B0aW9ucy5tZWFsVHlwZSk7XG4gICAgdGhpcy5uYXZpVHlwZSA9IHBhcnNlSW50KG9wdGlvbnMubmF2aVR5cGUpO1xuICAgIHRoaXMubWVhbERhdGUgPSBwYXJzZUludChvcHRpb25zLm1lYWxEYXRlKTtcbiAgICB3eC5zZXROYXZpZ2F0aW9uQmFyVGl0bGUoe1xuICAgICAgdGl0bGU6IFwi5re75YqgXCIgKyB0aXRsZS8v6aG16Z2i5qCH6aKY5Li66Lev55Sx5Y+C5pWwXG4gICAgfSk7XG4gICAgdGhpcy5nZXRDb21tb25Gb29kTGlzdCgpO1xuICB9XG5cbiAgcHVibGljIG9uU2hvdygpIHtcbiAgICB0aGlzLmdldFJlY2VudExpc3QoKTtcbiAgfVxuICAvKipcbiAgICog6I635Y+W5bi46KeB55qE6aOf54mp5YiX6KGoXG4gICAqL1xuICBwdWJsaWMgZ2V0Q29tbW9uRm9vZExpc3QoKXtcbiAgICAvLyBjb25zdCB0aGF0ID0gdGhpc1xuICAgIC8vIHJlcXVlc3QuY29tbW9uRm9vZExpc3Qoe1xuICAgIC8vIH0pLnRoZW4ocmVzPT57XG4gICAgLy8gICB0aGF0LnNldERhdGEoe2NvbW1vbkZvb2RMaXN0OnJlc30pXG4gICAgLy8gfSkuY2F0Y2goZXJyPT57XG4gICAgLy8gICBjb25zb2xlLmxvZyhlcnIpXG4gICAgLy8gfSlcbiAgICBsZXQgaG91ciA9IHBhcnNlSW50KG1vbWVudCgpLmZvcm1hdCgnSEgnKSk7XG4gICAgaWYoaG91cj49MTYpe1xuICAgICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtjb21tb25Gb29kTGlzdDpjb21tb25Gb29kTGlzdC5jfSlcbiAgICAgIHJldHVyblxuICAgIH1lbHNlIGlmKGhvdXI+PTEwKXtcbiAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7Y29tbW9uRm9vZExpc3Q6Y29tbW9uRm9vZExpc3QuYn0pXG4gICAgICByZXR1cm5cbiAgICB9ZWxzZXtcbiAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7Y29tbW9uRm9vZExpc3Q6Y29tbW9uRm9vZExpc3QuYX0pXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPlumjn+eJqeWNleS9jeS/oeaBr1xuICAgKi9cbiAgcHVibGljIGdldEZvb2RVbml0T3B0aW9uKGl0ZW0pe1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzXG4gICAgcmVxdWVzdC5nZXRGb29kVW5pdE9wdGlvbih7XG4gICAgICBmb29kSWQ6aXRlbS5mb29kSWQsXG4gICAgICBmb29kVHlwZTppdGVtLmZvb2RUeXBlXG4gICAgfSkudGhlbihyZXM9PntcbiAgICAgIGNvbnNvbGUubG9nKCdnZXRGb29kVW5pdE9wdGlvbicscmVzKVxuICAgICAgdGhhdC5wYXJzZUZvb2RVbml0T3B0aW9uUmVzcChyZXMpXG4gICAgfSkuY2F0Y2goZXJyPT57XG4gICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICB0aXRsZTon6I635Y+W6aOf54mp5L+h5oGv5aSx6LSlJyxcbiAgICAgICAgaWNvbjonbm9uZSdcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuICAvKipcbiAgICog6Kej5p6Q6I635Y+W5Yiw55qE6aOf54mp5Y2V5L2N5L+h5oGvXG4gICAqL1xuICBwdWJsaWMgcGFyc2VGb29kVW5pdE9wdGlvblJlc3AocmVzKXtcbiAgICBjb25zdCBhcnIgPSByZXMudW5pdE9wdGlvbi5tYXAoaXRlbT0+e1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZTppdGVtLnVuaXROYW1lLFxuICAgICAgICB1bml0RW5lcmd5IDogTWF0aC5yb3VuZChpdGVtLmVuZXJneSksXG4gICAgICAgIHVuaXRfaWQgOiBpdGVtLnVuaXRJZFxuICAgICAgfVxuICAgIH0pXG4gICAgY29uc3QgbmFtZUFyciA9IGFyci5tYXAoaXRlbT0+aXRlbS5uYW1lKTtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgZm9vZE51bVZhbHVlOnJlcy51bml0T3B0aW9uWzBdLnVuaXRXZWlnaHQvMTAwLFxuICAgICAgY2hvb3NlVWluaXRJbmRleDowLCAvLyDliJ3lp4vljJbmlbDph48xMDDlhYtcbiAgICAgIHVuaXRBcnI6bmFtZUFycixcbiAgICAgIGZvb2RVbml0QW5kVW5pdEVuZXJneTphcnIsXG4gICAgICBzaG93UG9wdXA6dHJ1ZVxuICAgIH0pXG4gIH1cblxuICBwdWJsaWMgZ2V0UmVjZW50TGlzdCgpe1xuICAgIGxldCByZWNlbnRMaXN0ID0gdGV4dENhY2hlLmdldEFsbFZhbHVlKCk7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIHJlY2VudExpc3Q6IHJlY2VudExpc3RcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzaG93SW5wdXQoKSB7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIGlucHV0U2hvd2VkOiB0cnVlXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgY2xlYXJJbnB1dCgpIHtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAga2V5d29yZDogXCJcIixcbiAgICAgIHJlc3VsdEVycm9yOiBmYWxzZSxcbiAgICAgIHJlc3VsdExpc3Q6W11cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBpbnB1dFR5cGluZyhldmVudDogYW55KSB7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIHJlc3VsdEVycm9yOiBmYWxzZSxcbiAgICAgIGtleXdvcmQ6IGV2ZW50LmRldGFpbC52YWx1ZSxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBwZXJmb3JtU2VhcmNoKCkge1xuICAgIGxldCBrZXl3b3JkID0gdGhpcy5kYXRhLmtleXdvcmQ7XG4gICAgbGV0IHJlcSA9IHsgcXVlcnk6IGtleXdvcmQsIGZpbHRlcl90eXBlOiB0aGlzLmZpbHRlclR5cGUsIG1lYWxfdHlwZTogdGhpcy5tZWFsVHlwZSB9O1xuICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICB3eC5zaG93TG9hZGluZyh7XG4gICAgICB0aXRsZTon5Yqg6L295LitLi4uJ1xuICAgIH0pXG4gICAgd2ViQVBJLlJldHJpZXZlVGV4dFNlYXJjaChyZXEpLnRoZW4ocmVzcCA9PiB7XG4gICAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgICB0aGF0LnNldFJlc3VsdExpc3QocmVzcCk7XG4gICAgfSkuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpO1xuICB9XG5cbiAgcHVibGljIHNldFJlc3VsdExpc3QocmVzcDogUmV0cmlldmVUZXh0U2VhcmNoUmVzcCkge1xuICAgIGxldCByZXN1bHRzID0gW107XG4gICAgaWYgKHJlc3AucmVzdWx0X2xpc3QubGVuZ3RoPT0wKSB7XG4gICAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgICByZXN1bHRMaXN0OiBbXSxcbiAgICAgICAgcmVzdWx0RXJyb3I6IHRydWVcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAobGV0IGluZGV4IGluIHJlc3AucmVzdWx0X2xpc3QpIHtcbiAgICAgICAgbGV0IGl0ZW0gPSByZXNwLnJlc3VsdF9saXN0W2luZGV4XTtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHtcbiAgICAgICAgICBmb29kSWQ6IGl0ZW0uZm9vZF9pZCxcbiAgICAgICAgICBmb29kTmFtZTogaXRlbS5mb29kX25hbWUsXG4gICAgICAgICAgZm9vZFR5cGU6IGl0ZW0uZm9vZF90eXBlLFxuICAgICAgICAgIGFtb3VudDogaXRlbS5hbW91bnQsXG4gICAgICAgICAgdW5pdDogaXRlbS51bml0X25hbWUsXG4gICAgICAgICAgZW5lcmd5OiBNYXRoLmZsb29yKGl0ZW0uZW5lcmd5IC8gMTAwKVxuICAgICAgICB9XG4gICAgICAgIHJlc3VsdHMucHVzaChyZXN1bHQpO1xuICAgICAgfVxuICAgICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgICAgcmVzdWx0TGlzdDogcmVzdWx0cyxcbiAgICAgICAgcmVzdWx0RXJyb3I6IGZhbHNlXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc29sZS5sb2codGhpcy5kYXRhLnJlc3VsdExpc3QpO1xuICB9XG5cbiBcbiAgcHVibGljIG9uVGV4dFNlYXJjaFJlc3VsdFNlbGVjdChldmVudDogYW55KSB7XG4gICAgbGV0IGluZGV4ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LnRleHRJbmRleDtcbiAgICB0aGlzLmdldEZvb2RVbml0T3B0aW9uKHRoaXMuZGF0YS5yZXN1bHRMaXN0W2luZGV4XSk7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIHJlY2VudFJlc3VsdFNlbGVjdEluZGV4Om51bGwsXG4gICAgICBjb21tb25Gb29kSW5kZXg6bnVsbCxcbiAgICAgIHRleHRTZWFyY2hSZXN1bHRTZWxlY3RJbmRleDppbmRleCxcbiAgICB9LCgpPT57XG4gICAgICB0ZXh0Q2FjaGUuc2V0VmFsdWUodGhpcy5kYXRhLnJlc3VsdExpc3RbaW5kZXhdKTtcbiAgICAgIHRoaXMuZ2V0UmVjZW50TGlzdCgpO1xuICAgIH0pXG4gIH1cbiAgcHVibGljIGhhbmRsZVRhcENvbW1vbkZvb2RJdGVtKGV2ZW50OiBhbnkpe1xuICAgIGxldCBpbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC50ZXh0SW5kZXg7XG4gICAgdGhpcy5nZXRGb29kVW5pdE9wdGlvbih0aGlzLmRhdGEuY29tbW9uRm9vZExpc3RbaW5kZXhdKTtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgdGV4dFNlYXJjaFJlc3VsdFNlbGVjdEluZGV4Om51bGwsXG4gICAgICByZWNlbnRSZXN1bHRTZWxlY3RJbmRleDpudWxsLFxuICAgICAgY29tbW9uRm9vZEluZGV4OmluZGV4LFxuICAgIH0pXG4gICAgLy8gdGV4dENhY2hlLnNldFZhbHVlKHRoaXMuZGF0YS5jb21tb25Gb29kTGlzdFtpbmRleF0pO1xuICAgIC8vIHRoaXMuZ2V0UmVjZW50TGlzdCgpXG4gIH1cblxuICBwdWJsaWMgb25SZWNlbnRSZXN1bHRTZWxlY3QoZXZlbnQ6IGFueSl7XG4gICAgbGV0IGluZGV4ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LnRleHRJbmRleDtcbiAgICB0aGlzLmdldEZvb2RVbml0T3B0aW9uKHRoaXMuZGF0YS5yZWNlbnRMaXN0W2luZGV4XSk7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtcbiAgICAgIHRleHRTZWFyY2hSZXN1bHRTZWxlY3RJbmRleDpudWxsLFxuICAgICAgY29tbW9uRm9vZEluZGV4Om51bGwsXG4gICAgICByZWNlbnRSZXN1bHRTZWxlY3RJbmRleDppbmRleCxcbiAgICB9KVxuICB9XG5cbiAgcHVibGljIGRlbGV0ZVRleHRTZWFyY2hDYWNoZShldmVudDogYW55KXtcbiAgICB0ZXh0Q2FjaGUuY2xlYXJBbGwoKTtcbiAgICB0aGlzLmdldFJlY2VudExpc3QoKTtcbiAgfVxuICAvKipcbiAgICog5YWz6Zet5by556qXcG9wdXDmoYZcbiAgICovXG4gIHB1YmxpYyBvbkNsb3NlKCl7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHsgc2hvd1BvcHVwOiBmYWxzZSxzaG93Q2hvb3NlZExpc3RzOmZhbHNlfSk7XG4gIH1cbi8qKlxuICog5YiH5o2i5bey6YCJ6aOf54mp5YiX6KGo55qE5pi+56S65LiO6ZqQ6JePXG4gKi9cbiAgcHVibGljIHRvZ2dsZUNob29zZWRMaXN0cygpe1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7c2hvd0Nob29zZWRMaXN0czohdGhpcy5kYXRhLnNob3dDaG9vc2VkTGlzdHN9KVxuICB9XG4gIC8qKlxuICAgKiDngrnlh7vmt7vliqDmjInpkq7vvIzlsIbpo5/nianmt7vliqDoh7Plt7LpgIlcbiAgICovXG4gIHB1YmxpYyBoYW5kbGVBZGRGb29kKCl7XG4gICAgbGV0IHRleHRTZWFyY2hSZXN1bHRTZWxlY3RJbmRleCA9IHRoaXMuZGF0YS50ZXh0U2VhcmNoUmVzdWx0U2VsZWN0SW5kZXg7XG4gICAgbGV0IHJlY2VudFJlc3VsdFNlbGVjdEluZGV4ID0gdGhpcy5kYXRhLnJlY2VudFJlc3VsdFNlbGVjdEluZGV4O1xuICAgIGxldCBjb21tb25Gb29kSW5kZXggPSB0aGlzLmRhdGEuY29tbW9uRm9vZEluZGV4O1xuICAgIGlmKHJlY2VudFJlc3VsdFNlbGVjdEluZGV4ICE9PSBudWxsICl7XG4gICAgICBsZXQgaXRlbTphbnkgPSB0aGlzLmRhdGEucmVjZW50TGlzdFtyZWNlbnRSZXN1bHRTZWxlY3RJbmRleF07XG4gICAgfWVsc2UgaWYodGV4dFNlYXJjaFJlc3VsdFNlbGVjdEluZGV4ICE9PSBudWxsKXtcbiAgICAgIGxldCBpdGVtOmFueSA9IHRoaXMuZGF0YS5yZXN1bHRMaXN0W3RleHRTZWFyY2hSZXN1bHRTZWxlY3RJbmRleF07XG4gICAgfWVsc2V7XG4gICAgICBsZXQgaXRlbTphbnkgPSB0aGlzLmRhdGEuY29tbW9uRm9vZExpc3RbY29tbW9uRm9vZEluZGV4XTtcbiAgICB9XG4gICAgaXRlbSA9IHtcbiAgICAgIC4uLml0ZW0sXG4gICAgICBjaG9vc2VkVW5pdDp0aGlzLmRhdGEudW5pdEFyclt0aGlzLmRhdGEuY2hvb3NlVWluaXRJbmRleF0sXG4gICAgICB3ZWlnaHROdW1iZXI6dGhpcy5kYXRhLmZvb2ROdW1WYWx1ZSxcbiAgICAgIHVuaXRFbmVyZ3k6dGhpcy5kYXRhLmZvb2RVbml0QW5kVW5pdEVuZXJneVt0aGlzLmRhdGEuY2hvb3NlVWluaXRJbmRleF0udW5pdEVuZXJneSxcbiAgICAgIHVuaXRfaWQ6dGhpcy5kYXRhLmZvb2RVbml0QW5kVW5pdEVuZXJneVt0aGlzLmRhdGEuY2hvb3NlVWluaXRJbmRleF0udW5pdF9pZFxuICAgIH07XG4gICAgdGhpcy5kYXRhLmNob29zZWRMaXN0cy5wdXNoKGl0ZW0pO1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7IFxuICAgICAgY2hvb3NlZExpc3RzIDogdGhpcy5kYXRhLmNob29zZWRMaXN0cyxcbiAgICAgIHNob3dQb3B1cCA6IGZhbHNlXG4gICAgfSwoKT0+e1xuICAgICAgdGhpcy5zdW1FbmVyZ3koKTtcbiAgICAgIGlmKHJlY2VudFJlc3VsdFNlbGVjdEluZGV4ICE9PSBudWxsKXsgLy8g5Li65Y6G5Y+y5pCc57Si6YeN5paw5o6S5bqPXG4gICAgICAgIHRleHRDYWNoZS5zZXRWYWx1ZSh0aGlzLmRhdGEucmVjZW50TGlzdFtyZWNlbnRSZXN1bHRTZWxlY3RJbmRleF0pXG4gICAgICAgIHRoaXMuZ2V0UmVjZW50TGlzdCgpO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2codGhpcy5kYXRhLmNob29zZWRMaXN0cykgICBcbiAgICB9KVxuICB9XG4gIC8qKlxuICAgKiBAcGFyYW0g6K6h566X55So5oi36aOf54mp5LiA5YWx5pyJ5aSa5bCR54Ot6YePXG4gICAqL1xuICBwdWJsaWMgc3VtRW5lcmd5KCl7XG4gICAgY29uc3QgdG90YWxFbmVyZ3kgPSB0aGlzLmRhdGEuY2hvb3NlZExpc3RzLnJlZHVjZSgocHJlLG5leHQpPT57XG4gICAgICByZXR1cm4gbmV4dC53ZWlnaHROdW1iZXIqbmV4dC51bml0RW5lcmd5K3ByZVxuICAgIH0sMCk7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHt0b3RhbEVuZXJneTp0b3RhbEVuZXJneX0pXG4gIH1cblxuICAvKipcbiAgICog55So5oi36L6T5YWl6aOf54mp55qE5Lu95pWwXG4gICAqL1xuICBwdWJsaWMgaGFuZGxlRm9vZE51bUlucHV0KGU6YW55KXtcbiAgICBsZXQgZm9vZE51bVZhbHVlID0gcGFyc2VJbnQoZS5kZXRhaWwudmFsdWUpO1xuICAgIC8vIGZvb2ROdW1WYWx1ZSA9IGlzTmFOKGZvb2ROdW1WYWx1ZSkgPyAwIDogZm9vZE51bVZhbHVlO1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7Zm9vZE51bVZhbHVlOmZvb2ROdW1WYWx1ZX0pXG4gIH1cbiAgLyoqXG4gICAqIOWxleekunBpY2tlcu+8jOmAieaLqemjn+eJqeWNleS9jVxuICAgKi9cbiAgcHVibGljIHNob3dQaWNrZXIoKXtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe3Nob3dQaWNrZXI6dHJ1ZSxzaG93UG9wdXA6ZmFsc2V9KVxuICB9XG4gIHB1YmxpYyBvbkNvbmZpcm0oKXtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe3Nob3dQaWNrZXI6ZmFsc2Usc2hvd1BvcHVwOnRydWV9KVxuICB9XG4gIHB1YmxpYyBvbkNoYW5nZShlOmFueSl7XG4gICAgbGV0IGNob29zZVVpbml0SW5kZXg6bnVtYmVyID0gZS5kZXRhaWwuaW5kZXg7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtjaG9vc2VVaW5pdEluZGV4OmNob29zZVVpbml0SW5kZXh9KVxuICB9XG4gIC8qKlxuICAgKiDliKDpmaTpgInkuK3liJfooajkuK3nmoTmn5DkuIDpoblcbiAgICovXG4gIHB1YmxpYyBoYW5kbGVEZWxldGVDaG9vc2VkSXRlbShlOmFueSl7XG4gICAgbGV0IGluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXg7XG4gICAgdGhpcy5kYXRhLmNob29zZWRMaXN0cy5zcGxpY2UoaW5kZXgsMSk7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtjaG9vc2VkTGlzdHM6dGhpcy5kYXRhLmNob29zZWRMaXN0c30sKCk9PntcbiAgICAgIHRoaXMuc3VtRW5lcmd5KClcbiAgICAgIGlmKHRoaXMuZGF0YS5jaG9vc2VkTGlzdHMubGVuZ3RoPT09MCl7XG4gICAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7c2hvd0Nob29zZWRMaXN0czpmYWxzZX0pXG4gICAgICB9XG4gICAgfSlcbiAgfVxuICAvKipcbiAgICog5om56YeP5re75Yqg6aOf54mp5pW05ZCI5Y+C5pWwXG4gICAqL1xuICBwdWJsaWMgaGFuZGxlQ29uZmlybUJ0bigpe1xuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6IFwi5Yqg6L295LitLi4uXCIsIG1hc2s6IHRydWUgfSk7XG4gICAgbGV0IGZvb2RMaXN0OmFueVtdID0gW107XG4gICAgdGhpcy5kYXRhLmNob29zZWRMaXN0cy5tYXAoKGl0ZW06YW55KSA9PiB7XG4gICAgICBsZXQgcmVzdWx0cyA9IFt7IGZvb2RfaWQ6IGl0ZW0uZm9vZElkLCBmb29kX25hbWU6IGl0ZW0uZm9vZE5hbWUsIGZvb2RfdHlwZTogaXRlbS5mb29kVHlwZSB9XTtcbiAgICAgIGxldCBmb29kID0geyBcbiAgICAgICAgZm9vZF9pZDogaXRlbS5mb29kSWQsIFxuICAgICAgICBmb29kX3R5cGU6IGl0ZW0uZm9vZFR5cGUsIFxuICAgICAgICByZWNvZ25pdGlvbl9yZXN1bHRzOiByZXN1bHRzLFxuICAgICAgICBpbnB1dF90eXBlOiAyLCBcbiAgICAgICAgYW1vdW50OnBhcnNlSW50KGl0ZW0ud2VpZ2h0TnVtYmVyKSoxMDAsXG4gICAgICAgIHVuaXRfaWQ6IGl0ZW0udW5pdF9pZFxuICAgICAgfTtcbiAgICAgIGZvb2RMaXN0LnB1c2goZm9vZClcbiAgICB9KVxuICAgIGxldCByZXEgPSB7IG1lYWxfaWQ6IC0xLCBtZWFsX3R5cGU6IHRoaXMubWVhbFR5cGUsIG1lYWxfZGF0ZTogdGhpcy5tZWFsRGF0ZSwgZm9vZF9saXN0OiBmb29kTGlzdCB9O1xuICAgIGNvbnNvbGUubG9nKCfor7fmsYLlj4LmlbByZXEnLHJlcSlcbiAgICB0aGlzLkNyZWF0ZU9yVXBkYXRlTWVhbExvZyhyZXEpO1xuICB9XG4gIC8qKlxuICAgKiDmoLzlvI/ljJbmlbDmja7lkI7vvIzlj5Hlh7ror7fmsYLvvIzojrflvpdtZWFsX2lkXG4gICAqL1xuICBwdWJsaWMgQ3JlYXRlT3JVcGRhdGVNZWFsTG9nKHJlcTphbnkpe1xuICAgIGxldCBpbWFnZVVybCA9IFwiaHR0cHM6Ly9kaWV0bGVucy0xMjU4NjY1NTQ3LmNvcy5hcC1zaGFuZ2hhaS5teXFjbG91ZC5jb20vbWluaS1hcHAtaW1hZ2UvZGVmYXVsdEltYWdlL3RleHRzZWFyY2gtZGVmYXVsdC1pbWFnZS5wbmdcIjtcbiAgICB3ZWJBUEkuQ3JlYXRlT3JVcGRhdGVNZWFsTG9nKHJlcSkudGhlbihyZXNwID0+IHtcbiAgICAgIC8vIGxldCBwYXJhbTphbnkgPSB7fTtcbiAgICAgIC8vIHBhcmFtLm1lYWxJZCA9IHJlc3AubWVhbF9pZDtcbiAgICAgIC8vIHBhcmFtLmltYWdlVXJsID0gaW1hZ2VVcmw7XG4gICAgICAvLyBwYXJhbS5zaG93U2hhcmVCdG4gPSBmYWxzZTtcbiAgICAgIC8vIGxldCBwYXJhbUpzb24gPSBKU09OLnN0cmluZ2lmeShwYXJhbSk7XG4gICAgICB0aGlzLkNvbmZpcm1NZWFsTG9nKHJlc3AubWVhbF9pZClcbiAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgd3guc2hvd1RvYXN0KHt0aXRsZTogJ+ivt+axguWksei0pScsaWNvbjogJ25vbmUnfSk7XG4gICAgICB3eC5oaWRlTG9hZGluZyh7fSk7XG4gICAgfSk7XG4gIH1cbiAgLyoqXG4gICAqIOWPkeWHuuivt+axgu+8jOWIm+W7uuiusOW9lVxuICAgKi9cbiAgcHVibGljIENvbmZpcm1NZWFsTG9nKG1lYWxfaWQ6bnVtYmVyKXtcbiAgICBsZXQgcmVxID0geyBtZWFsX2lkOiBtZWFsX2lkIH07XG4gICAgd2ViQVBJLkNvbmZpcm1NZWFsTG9nKHJlcSkudGhlbihyZXNwID0+IHtcbiAgICAgIHd4LmhpZGVMb2FkaW5nKHt9KTtcbiAgICAgIHd4Lm5hdmlnYXRlVG8oeyB1cmw6IGAuLi8uLi9ob21lU3ViL3BhZ2VzL21lYWxBbmFseXNpcy9pbmRleD9tZWFsRGF0ZT0ke3RoaXMubWVhbERhdGV9Jm1lYWxUeXBlPSR7dGhpcy5tZWFsVHlwZX1gfSlcbiAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgd3guc2hvd1RvYXN0KHt0aXRsZTogJ+aPkOS6pOmjn+eJqeiusOW9leWksei0pScsaWNvbjogJ25vbmUnfSk7XG4gICAgfSk7XG4gIH1cblxufVxuXG5QYWdlKG5ldyB0ZXh0U2VhcmNoKCkpXG4iXX0=