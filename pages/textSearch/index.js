"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
var webAPI = require("../../api/app/AppService");
var globalEnum = require("../../api/GlobalEnum");
var textCache = require("./textCache/TextCache");
var textSearch = (function () {
    function textSearch() {
        this.filterType = 0;
        this.mealType = 0;
        this.naviType = 0;
        this.mealDate = 0;
        this.data = {
            keyword: "",
            inputShowed: false,
            resultList: [],
            resultError: [],
            recentList: [],
            showChoosedLists: false,
            showChoosedConfirm: false,
            showPopup: false,
            showPicker: false,
            choosedLists: [],
            unitArr: ['克', '碗', '把', '捧', '盆', '瓢'],
            foodUnitAndUnitEnergy: [],
            chooseUinitIndex: 0,
            foodNumValue: 100,
            foodNumValueMaxlength: 3,
            recentResultSelectIndex: 0,
            totalEnergy: 0,
        };
    }
    textSearch.prototype.onLoad = function (options) {
        webAPI.SetAuthToken(wx.getStorageSync(globalEnum.globalKey_token));
        var title = options.title;
        this.filterType = parseInt(options.filterType);
        this.mealType = parseInt(options.mealType);
        this.naviType = parseInt(options.naviType);
        this.mealDate = parseInt(options.mealDate);
        wx.setNavigationBarTitle({
            title: "添加" + title
        });
    };
    textSearch.prototype.onShow = function () {
        if (this.data.resultList.length === 0) {
            this.getRecentList();
        }
    };
    textSearch.prototype.getRecentList = function () {
        var recentList = textCache.getAllValue();
        console.log(recentList);
        this.setData({
            recentList: recentList
        });
    };
    textSearch.prototype.showInput = function () {
        this.setData({
            inputShowed: true
        });
    };
    textSearch.prototype.clearInput = function () {
        this.setData({
            keyword: "",
            resultError: false
        });
    };
    textSearch.prototype.inputTyping = function (event) {
        this.setData({
            resultError: false,
            keyword: event.detail.value,
        });
    };
    textSearch.prototype.performSearch = function () {
        var keyword = this.data.keyword;
        var req = { query: keyword, filter_type: this.filterType, meal_type: this.mealType };
        var that = this;
        wx.showLoading({
            title: '加载中...'
        });
        webAPI.RetrieveTextSearch(req).then(function (resp) {
            wx.hideLoading();
            that.setResultList(resp);
        }).catch(function (err) { return console.log(err); });
    };
    textSearch.prototype.setResultList = function (resp) {
        var results = [];
        if (resp.result_list.length == 0) {
            this.setData({
                resultList: [],
                resultError: true
            });
        }
        else {
            for (var index in resp.result_list) {
                var item = resp.result_list[index];
                var result = {
                    foodId: item.food_id,
                    foodName: item.food_name,
                    foodType: item.food_type,
                    amount: item.amount,
                    unit: item.unit_name,
                    energy: Math.floor(item.energy / 100)
                };
                results.push(result);
            }
            this.setData({
                resultList: results,
                resultError: false
            });
        }
        console.log(this.data.resultList);
    };
    textSearch.prototype.onTextSearchResultSelect = function (event) {
        var index = event.currentTarget.dataset.textIndex;
        var foodId = this.data.resultList[index].foodId;
        var foodName = this.data.resultList[index].foodName;
        var foodType = this.data.resultList[index].foodType;
        var imageUrl = "https://dietlens-1258665547.cos.ap-shanghai.myqcloud.com/mini-app-image/defaultImage/textsearch-default-image.png";
        if (this.naviType === 0) {
            wx.showLoading({ title: "加载中...", mask: true });
            var results = [{ food_id: foodId, food_name: foodName, food_type: foodType }];
            var food = { food_id: foodId, input_type: 2, food_type: foodType, recognition_results: results };
            var foodList = [food];
            var req = { meal_id: -1, meal_type: this.mealType, meal_date: this.mealDate, food_list: foodList };
            webAPI.CreateOrUpdateMealLog(req).then(function (resp) {
                wx.hideLoading({});
                var param = {};
                param.mealId = resp.meal_id;
                param.imageUrl = imageUrl;
                param.showShareBtn = false;
                var paramJson = JSON.stringify(param);
                wx.navigateTo({
                    url: "/pages/foodDetail/index?paramJson=" + paramJson
                });
            }).catch(function (err) {
                console.log(err);
                wx.hideLoading({});
            });
        }
        else {
            var pages = getCurrentPages();
            var prevPage = pages[pages.length - 2];
            prevPage.textSearchFood = { food_id: foodId, food_name: foodName, food_type: foodType };
            wx.navigateBack({
                delta: 1
            });
        }
        textCache.setValue(this.data.resultList[index]);
    };
    textSearch.prototype.onRecentResultSelect = function (event) {
        var index = event.currentTarget.dataset.textIndex;
        var unit_option = [
            { "unit_name": "克", "weight": 800, "unit_id": 70 },
            { "unit_name": "鸡蛋大小", "weight": 36000, "unit_id": 74 },
            { "unit_name": "碗", "weight": 21000, "unit_id": 74 }
        ];
        var arr = unit_option.map(function (item) {
            return ({
                'name': item.unit_name,
                'unitEnergy': item.weight / 100,
                'unit_id': item.unit_id
            });
        });
        var nameArr = arr.map(function (item) { return item.name; });
        this.setData({
            foodNumValue: 100,
            chooseUinitIndex: 0,
            recentResultSelectIndex: index,
            unitArr: nameArr,
            foodUnitAndUnitEnergy: arr,
            showPopup: true
        });
        return false;
        if (this.naviType === 0) {
            wx.showLoading({ title: "加载中...", mask: true });
            var results = [{ food_id: foodId, food_name: foodName, food_type: foodType }];
            var food = { food_id: foodId, input_type: 2, food_type: foodType, recognition_results: results };
            var foodList = [food];
            var req = { meal_id: -1, meal_type: this.mealType, meal_date: this.mealDate, food_list: foodList };
            webAPI.CreateOrUpdateMealLog(req).then(function (resp) {
                wx.hideLoading({});
                var param = {};
                param.mealId = resp.meal_id;
                param.imageUrl = imageUrl;
                param.showShareBtn = false;
                var paramJson = JSON.stringify(param);
                wx.navigateTo({
                    url: "/pages/foodDetail/index?paramJson=" + paramJson
                });
            }).catch(function (err) {
                console.log(err);
                wx.hideLoading({});
            });
        }
        else {
            var pages = getCurrentPages();
            var prevPage = pages[pages.length - 2];
            prevPage.textSearchFood = { food_id: foodId, food_name: foodName, food_type: foodType };
            wx.navigateBack({
                delta: 1
            });
        }
        textCache.setValue(this.data.recentList[index]);
    };
    textSearch.prototype.deleteTextSearchCache = function (event) {
        textCache.clearAll();
        this.getRecentList();
    };
    textSearch.prototype.onClose = function () {
        this.setData({ showPopup: false, showChoosedLists: false });
    };
    textSearch.prototype.toggleChoosedLists = function () {
        this.setData({ showChoosedLists: !this.data.showChoosedLists });
    };
    textSearch.prototype.handleAddFood = function () {
        var _this = this;
        var item = this.data.recentList[this.data.recentResultSelectIndex];
        item = __assign({}, item, { choosedUnit: this.data.unitArr[this.data.chooseUinitIndex], weightNumber: this.data.foodNumValue, unitEnergy: this.data.foodUnitAndUnitEnergy[this.data.chooseUinitIndex].unitEnergy, unit_id: this.data.foodUnitAndUnitEnergy[this.data.chooseUinitIndex].unit_id });
        this.data.choosedLists.push(item);
        this.setData({
            choosedLists: this.data.choosedLists,
            showPopup: false
        }, function () {
            _this.sumEnergy();
            console.log(_this.data.choosedLists);
        });
    };
    textSearch.prototype.sumEnergy = function () {
        var totalEnergy = this.data.choosedLists.reduce(function (pre, next) {
            return next.weightNumber * next.unitEnergy + pre;
        }, 0);
        this.setData({ totalEnergy: totalEnergy });
    };
    textSearch.prototype.handleFoodNumInput = function (e) {
        this.setData({ foodNumValue: parseInt(e.detail.value) });
    };
    textSearch.prototype.showPicker = function () {
        this.setData({ showPicker: true, showPopup: false });
    };
    textSearch.prototype.onConfirm = function () {
        this.setData({ showPicker: false, showPopup: true });
    };
    textSearch.prototype.onChange = function (e) {
        var chooseUinitIndex = e.detail.index;
        if (this.data.unitArr[chooseUinitIndex] === '克') {
            this.setData({ foodNumValueMaxlength: 3 });
        }
        this.setData({ chooseUinitIndex: chooseUinitIndex });
    };
    textSearch.prototype.handleDeleteChoosedItem = function (e) {
        var _this = this;
        var index = e.currentTarget.dataset.index;
        this.data.choosedLists.splice(index, 1);
        this.setData({ choosedLists: this.data.choosedLists }, function () {
            _this.sumEnergy();
            if (_this.data.choosedLists.length === 0) {
                _this.setData({ showChoosedLists: false });
            }
        });
    };
    textSearch.prototype.handleConfirmBtn = function () {
        wx.showLoading({ title: "加载中...", mask: true });
        var foodList = [];
        this.data.choosedLists.map(function (item) {
            var results = [{ food_id: item.foodId, food_name: item.foodName, food_type: item.foodType }];
            var food = {
                food_id: item.foodId,
                food_type: item.foodType,
                recognition_results: results,
                input_type: 2,
                amount: parseInt(item.weightNumber) * 100,
                unit_id: item.unit_id
            };
            foodList.push(food);
        });
        var req = { meal_id: -1, meal_type: this.mealType, meal_date: this.mealDate, food_list: foodList };
        console.log('请求参数req', req);
        this.CreateOrUpdateMealLog(req);
    };
    textSearch.prototype.CreateOrUpdateMealLog = function (req) {
        var _this = this;
        var imageUrl = "https://dietlens-1258665547.cos.ap-shanghai.myqcloud.com/mini-app-image/defaultImage/textsearch-default-image.png";
        webAPI.CreateOrUpdateMealLog(req).then(function (resp) {
            _this.ConfirmMealLog(resp.meal_id);
        }).catch(function (err) {
            wx.showToast({ title: '请求失败', icon: 'none' });
            wx.hideLoading({});
        });
    };
    textSearch.prototype.ConfirmMealLog = function (meal_id) {
        var req = { meal_id: meal_id };
        webAPI.ConfirmMealLog(req).then(function (resp) {
            wx.hideLoading({});
            wx.navigateTo({ url: "/pages/foodShare/index?mealId=" + meal_id });
        }).catch(function (err) {
            wx.showToast({ title: '提交食物记录失败', icon: 'none' });
        });
    };
    return textSearch;
}());
Page(new textSearch());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEsaURBQW1EO0FBRW5ELGlEQUFrRDtBQUNsRCxpREFBa0Q7QUFjbEQ7SUFBQTtRQUNTLGVBQVUsR0FBRyxDQUFDLENBQUM7UUFDZixhQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ2IsYUFBUSxHQUFHLENBQUMsQ0FBQztRQUNiLGFBQVEsR0FBRyxDQUFDLENBQUM7UUFFYixTQUFJLEdBQUc7WUFDWixPQUFPLEVBQUUsRUFBRTtZQUNYLFdBQVcsRUFBRSxLQUFLO1lBQ2xCLFVBQVUsRUFBRSxFQUFFO1lBQ2QsV0FBVyxFQUFFLEVBQUU7WUFDZixVQUFVLEVBQUUsRUFBRTtZQUNkLGdCQUFnQixFQUFDLEtBQUs7WUFDdEIsa0JBQWtCLEVBQUMsS0FBSztZQUN4QixTQUFTLEVBQUUsS0FBSztZQUNoQixVQUFVLEVBQUMsS0FBSztZQUNoQixZQUFZLEVBQUMsRUFBRTtZQUNmLE9BQU8sRUFBQyxDQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxDQUFDO1lBQ2pDLHFCQUFxQixFQUFDLEVBQUU7WUFDeEIsZ0JBQWdCLEVBQUMsQ0FBQztZQUNsQixZQUFZLEVBQUMsR0FBRztZQUNoQixxQkFBcUIsRUFBQyxDQUFDO1lBQ3ZCLHVCQUF1QixFQUFDLENBQUM7WUFDekIsV0FBVyxFQUFDLENBQUM7U0FDZCxDQUFBO0lBaVZILENBQUM7SUEvVVEsMkJBQU0sR0FBYixVQUFjLE9BQVk7UUFDeEIsTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO1FBQ25FLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7UUFDMUIsSUFBSSxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUMsT0FBTyxD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TyxFQUFFLE9BQU8sRUFBRSxDQUFDO1FBQy9CLE1BQU0sQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUEsSUFBSTtZQUNsQyxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ25CLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxHQUFHLEVBQUUsZ0NBQWdDLEdBQUcsT0FBTyxFQUFFLENBQUMsQ0FBQTtRQUNwRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQSxHQUFHO1lBQ1YsRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFDLEtBQUssRUFBRSxVQUFVLEVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUgsaUJBQUM7QUFBRCxDQUFDLEFBeldELElBeVdDO0FBRUQsSUFBSSxDQUFDLElBQUksVUFBVSxFQUFFLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHdlYkFQSSBmcm9tICcuLi8uLi9hcGkvYXBwL0FwcFNlcnZpY2UnO1xuaW1wb3J0IHsgUmV0cmlldmVUZXh0U2VhcmNoUmVxLCBSZXRyaWV2ZVRleHRTZWFyY2hSZXNwLCBDcmVhdGVPclVwZGF0ZU1lYWxMb2dSZXEsIEFkZFJlY2lwZUl0ZW1SZXEsIE1lYWxMb2dSZXNwIH0gZnJvbSBcIi9hcGkvYXBwL0FwcFNlcnZpY2VPYmpzXCJcbmltcG9ydCAqIGFzIGdsb2JhbEVudW0gZnJvbSAnLi4vLi4vYXBpL0dsb2JhbEVudW0nXG5pbXBvcnQgKiBhcyB0ZXh0Q2FjaGUgZnJvbSAnLi90ZXh0Q2FjaGUvVGV4dENhY2hlJ1xuXG50eXBlIGRhdGEgPSB7XG4gIGtleXdvcmQ6IFN0cmluZztcbiAgcmVzdWx0TGlzdDogUmVzdWx0W107XG59XG5cbnR5cGUgUmVzdWx0ID0ge1xuICBmb29kSWQ6IG51bWJlcjtcbiAgZGlzcGxheU5hbWU6IFN0cmluZztcbiAgZm9vZFR5cGU6IG51bWJlcjtcbiAgZW5ncnk6IG51bWJlcjtcbn1cblxuY2xhc3MgdGV4dFNlYXJjaCB7XG4gIHB1YmxpYyBmaWx0ZXJUeXBlID0gMDsgLy8wLmFsbCAxLnJlY2lwZSAyLmluZ3JlaWRlbnRcbiAgcHVibGljIG1lYWxUeXBlID0gMDsgLy8xLmJyZWFrZmFzdCAyLmx1bmNoIDMuZGlubmVyIDQuc25hY2tcbiAgcHVibGljIG5hdmlUeXBlID0gMDsgLy8wLnRleHRzZWFyY2ggPT4gZGV0YWlsIDEudGV4dHNlYXJjaCA9PiB0YWcgMi50ZXh0c2VhcmNoPT4gaW5ncmVkaWVudFxuICBwdWJsaWMgbWVhbERhdGUgPSAwOyAvL3ByZXYgcGFnZSBtdXN0IHBhc3MgbWVhbERhdGUgdG8gdGV4dFNlYXJjaCBwYWdlXG5cbiAgcHVibGljIGRhdGEgPSB7XG4gICAga2V5d29yZDogXCJcIixcbiAgICBpbnB1dFNob3dlZDogZmFsc2UsXG4gICAgcmVzdWx0TGlzdDogW10sXG4gICAgcmVzdWx0RXJyb3I6IFtdLFxuICAgIHJlY2VudExpc3Q6IFtdLFxuICAgIHNob3dDaG9vc2VkTGlzdHM6ZmFsc2UsXG4gICAgc2hvd0Nob29zZWRDb25maXJtOmZhbHNlLFxuICAgIHNob3dQb3B1cDogZmFsc2UsXG4gICAgc2hvd1BpY2tlcjpmYWxzZSxcbiAgICBjaG9vc2VkTGlzdHM6W10sICAvLyDlt7Lnu4/mt7vliqDnmoTpo5/niankv6Hmga/liJfooahcbiAgICB1bml0QXJyOlsn5YWLJywn56KXJywn5oqKJywn5o2nJywn55uGJywn55OiJ10sXG4gICAgZm9vZFVuaXRBbmRVbml0RW5lcmd5OltdLFxuICAgIGNob29zZVVpbml0SW5kZXg6MCwgLy8g55So5oi36YCJ5oup5LqGcGlja2Vy5Lit55qEaW5kZXhcbiAgICBmb29kTnVtVmFsdWU6MTAwLFxuICAgIGZvb2ROdW1WYWx1ZU1heGxlbmd0aDozLFxuICAgIHJlY2VudFJlc3VsdFNlbGVjdEluZGV4OjAsIC8vIOeUqOaIt+eCueWHu+S6huWOhuWPsue8k+WtmOS4reeahGluZGV4XG4gICAgdG90YWxFbmVyZ3k6MCxcbiAgfVxuXG4gIHB1YmxpYyBvbkxvYWQob3B0aW9uczogYW55KSB7XG4gICAgd2ViQVBJLlNldEF1dGhUb2tlbih3eC5nZXRTdG9yYWdlU3luYyhnbG9iYWxFbnVtLmdsb2JhbEtleV90b2tlbikpO1xuICAgIGxldCB0aXRsZSA9IG9wdGlvbnMudGl0bGU7XG4gICAgdGhpcy5maWx0ZXJUeXBlID0gcGFyc2VJbnQob3B0aW9ucy5maWx0ZXJUeXBlKTtcbiAgICB0aGlzLm1lYWxUeXBlID0gcGFyc2VJbnQob3B0aW9ucy5tZWFsVHlwZSk7XG4gICAgdGhpcy5uYXZpVHlwZSA9IHBhcnNlSW50KG9wdGlvbnMubmF2aVR5cGUpO1xuICAgIHRoaXMubWVhbERhdGUgPSBwYXJzZUludChvcHRpb25zLm1lYWxEYXRlKTtcbiAgICB3eC5zZXROYXZpZ2F0aW9uQmFyVGl0bGUoe1xuICAgICAgdGl0bGU6IFwi5re75YqgXCIgKyB0aXRsZS8v6aG16Z2i5qCH6aKY5Li66Lev55Sx5Y+C5pWwXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgb25TaG93KCkge1xuICAgIGlmICh0aGlzLmRhdGEucmVzdWx0TGlzdC5sZW5ndGggPT09IDApe1xuICAgICAgIHRoaXMuZ2V0UmVjZW50TGlzdCgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRSZWNlbnRMaXN0KCl7XG4gICAgbGV0IHJlY2VudExpc3QgPSB0ZXh0Q2FjaGUuZ2V0QWxsVmFsdWUoKTtcbiAgICBjb25zb2xlLmxvZyhyZWNlbnRMaXN0KTtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgcmVjZW50TGlzdDogcmVjZW50TGlzdFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHNob3dJbnB1dCgpIHtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgaW5wdXRTaG93ZWQ6IHRydWVcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBjbGVhcklucHV0KCkge1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7XG4gICAgICBrZXl3b3JkOiBcIlwiLFxuICAgICAgcmVzdWx0RXJyb3I6IGZhbHNlXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgaW5wdXRUeXBpbmcoZXZlbnQ6IGFueSkge1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7XG4gICAgICByZXN1bHRFcnJvcjogZmFsc2UsXG4gICAgICBrZXl3b3JkOiBldmVudC5kZXRhaWwudmFsdWUsXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgcGVyZm9ybVNlYXJjaCgpIHtcbiAgICBsZXQga2V5d29yZCA9IHRoaXMuZGF0YS5rZXl3b3JkO1xuICAgIGxldCByZXEgPSB7IHF1ZXJ5OiBrZXl3b3JkLCBmaWx0ZXJfdHlwZTogdGhpcy5maWx0ZXJUeXBlLCBtZWFsX3R5cGU6IHRoaXMubWVhbFR5cGUgfTtcbiAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgd3guc2hvd0xvYWRpbmcoe1xuICAgICAgdGl0bGU6J+WKoOi9veS4rS4uLidcbiAgICB9KVxuICAgIHdlYkFQSS5SZXRyaWV2ZVRleHRTZWFyY2gocmVxKS50aGVuKHJlc3AgPT4ge1xuICAgICAgd3guaGlkZUxvYWRpbmcoKVxuICAgICAgdGhhdC5zZXRSZXN1bHRMaXN0KHJlc3ApO1xuICAgIH0pLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRSZXN1bHRMaXN0KHJlc3A6IFJldHJpZXZlVGV4dFNlYXJjaFJlc3ApIHtcbiAgICBsZXQgcmVzdWx0cyA9IFtdO1xuXG4gICAgaWYgKHJlc3AucmVzdWx0X2xpc3QubGVuZ3RoPT0wKSB7XG4gICAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgICByZXN1bHRMaXN0OiBbXSxcbiAgICAgICAgcmVzdWx0RXJyb3I6IHRydWVcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcblxuICAgICAgZm9yIChsZXQgaW5kZXggaW4gcmVzcC5yZXN1bHRfbGlzdCkge1xuICAgICAgICBsZXQgaXRlbSA9IHJlc3AucmVzdWx0X2xpc3RbaW5kZXhdO1xuICAgICAgICBsZXQgcmVzdWx0ID0ge1xuICAgICAgICAgIGZvb2RJZDogaXRlbS5mb29kX2lkLFxuICAgICAgICAgIGZvb2ROYW1lOiBpdGVtLmZvb2RfbmFtZSxcbiAgICAgICAgICBmb29kVHlwZTogaXRlbS5mb29kX3R5cGUsXG4gICAgICAgICAgYW1vdW50OiBpdGVtLmFtb3VudCxcbiAgICAgICAgICB1bml0OiBpdGVtLnVuaXRfbmFtZSxcbiAgICAgICAgICBlbmVyZ3k6IE1hdGguZmxvb3IoaXRlbS5lbmVyZ3kgLyAxMDApXG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdCk7XG4gICAgICB9XG4gICAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgICByZXN1bHRMaXN0OiByZXN1bHRzLFxuICAgICAgICByZXN1bHRFcnJvcjogZmFsc2VcbiAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgY29uc29sZS5sb2codGhpcy5kYXRhLnJlc3VsdExpc3QpO1xuICB9XG5cbiAgLyoqXG4gICAqIHRocmVlIGNhc2VcbiAgICogMS5mb29kRGlhcnkgLT4gdGV4dHNlYXJjaCAtPiBmb29kRGV0YWlsUGFnZShyZXR1cm4gaW5ncmVkaWVudC9yZWNlaXBlKVxuICAgKiAyLmltYWdlVGFnIC0+IHRleHRzZWFyY2ggLT4gaW1hZ2VUYWcocmV0dXJuIGluZ3JlZGllbnQvcmVjZWlwZSlcbiAgICogMy5mb29kRGV0YWlsIC0+IHRleHRzZWFyY2ggLT4gZm9vZERldGFpbChyZXR1cm4gaW5ncmVkaWVudClcbiAgICogY29tbW9uIHNvbHV0aW9uOiBzZXQgcHJldlBhZ2UuZGF0YS50ZXh0U2VhcmNoSXRlbVxuICAgKi9cbiAgcHVibGljIG9uVGV4dFNlYXJjaFJlc3VsdFNlbGVjdChldmVudDogYW55KSB7XG4gICAgbGV0IGluZGV4ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LnRleHRJbmRleDtcbiAgICBsZXQgZm9vZElkID0gdGhpcy5kYXRhLnJlc3VsdExpc3RbaW5kZXhdLmZvb2RJZDtcbiAgICBsZXQgZm9vZE5hbWUgPSB0aGlzLmRhdGEucmVzdWx0TGlzdFtpbmRleF0uZm9vZE5hbWU7XG4gICAgbGV0IGZvb2RUeXBlID0gdGhpcy5kYXRhLnJlc3VsdExpc3RbaW5kZXhdLmZvb2RUeXBlO1xuICAgIGxldCBpbWFnZVVybCA9IFwiaHR0cHM6Ly9kaWV0bGVucy0xMjU4NjY1NTQ3LmNvcy5hcC1zaGFuZ2hhaS5teXFjbG91ZC5jb20vbWluaS1hcHAtaW1hZ2UvZGVmYXVsdEltYWdlL3RleHRzZWFyY2gtZGVmYXVsdC1pbWFnZS5wbmdcIjtcbiAgICBpZiAodGhpcy5uYXZpVHlwZSA9PT0gMCkge1xuICAgICAgLy9jcmVhdGUgbWVhbCBoZXJlXG4gICAgICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiBcIuWKoOi9veS4rS4uLlwiLCBtYXNrOiB0cnVlIH0pO1xuICAgICAgbGV0IHJlc3VsdHMgPSBbeyBmb29kX2lkOiBmb29kSWQsIGZvb2RfbmFtZTogZm9vZE5hbWUsIGZvb2RfdHlwZTogZm9vZFR5cGUgfV07XG4gICAgICBsZXQgZm9vZCA9IHsgZm9vZF9pZDogZm9vZElkLCBpbnB1dF90eXBlOiAyLCBmb29kX3R5cGU6IGZvb2RUeXBlLCByZWNvZ25pdGlvbl9yZXN1bHRzOiByZXN1bHRzIH07XG4gICAgICBsZXQgZm9vZExpc3QgPSBbZm9vZF07XG4gICAgICBsZXQgcmVxID0geyBtZWFsX2lkOiAtMSwgbWVhbF90eXBlOiB0aGlzLm1lYWxUeXBlLCBtZWFsX2RhdGU6IHRoaXMubWVhbERhdGUsIGZvb2RfbGlzdDogZm9vZExpc3QgfTtcbiAgICAgIHdlYkFQSS5DcmVhdGVPclVwZGF0ZU1lYWxMb2cocmVxKS50aGVuKHJlc3AgPT4ge1xuICAgICAgICB3eC5oaWRlTG9hZGluZyh7fSk7XG4gICAgICAgIGxldCBwYXJhbSA9IHt9O1xuICAgICAgICBwYXJhbS5tZWFsSWQgPSByZXNwLm1lYWxfaWQ7XG4gICAgICAgIHBhcmFtLmltYWdlVXJsID0gaW1hZ2VVcmw7XG4gICAgICAgIHBhcmFtLnNob3dTaGFyZUJ0biA9IGZhbHNlO1xuICAgICAgICBsZXQgcGFyYW1Kc29uID0gSlNPTi5zdHJpbmdpZnkocGFyYW0pO1xuICAgICAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgICAgICB1cmw6IFwiL3BhZ2VzL2Zvb2REZXRhaWwvaW5kZXg/cGFyYW1Kc29uPVwiICsgcGFyYW1Kc29uXG4gICAgICAgIH0pO1xuICAgICAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgd3guaGlkZUxvYWRpbmcoe30pO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHBhZ2VzID0gZ2V0Q3VycmVudFBhZ2VzKCk7XG4gICAgICBsZXQgcHJldlBhZ2UgPSBwYWdlc1twYWdlcy5sZW5ndGggLSAyXTtcbiAgICAgIC8vc2V0IHRleHQgc2VhcmNoIHJlc3VsdCB0byBwcmV2IHBhZ2VzXG4gICAgICBwcmV2UGFnZS50ZXh0U2VhcmNoRm9vZCA9IHsgZm9vZF9pZDogZm9vZElkLCBmb29kX25hbWU6IGZvb2ROYW1lLCBmb29kX3R5cGU6IGZvb2RUeXBlIH1cbiAgICAgIHd4Lm5hdmlnYXRlQmFjayh7XG4gICAgICAgIGRlbHRhOiAxXG4gICAgICB9KVxuICAgIH1cbiAgICAvL3JlY2VudCBMUlVcbiAgICB0ZXh0Q2FjaGUuc2V0VmFsdWUodGhpcy5kYXRhLnJlc3VsdExpc3RbaW5kZXhdKTtcbiAgfVxuXG4gIHB1YmxpYyBvblJlY2VudFJlc3VsdFNlbGVjdChldmVudDogYW55KXtcbiAgICBsZXQgaW5kZXggPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQudGV4dEluZGV4O1xuICAgIC8vIGxldCBmb29kSWQgPSB0aGlzLmRhdGEucmVjZW50TGlzdFtpbmRleF0uZm9vZElkO1xuICAgIC8vIGxldCBmb29kTmFtZSA9IHRoaXMuZGF0YS5yZWNlbnRMaXN0W2luZGV4XS5mb29kTmFtZTtcbiAgICAvLyBsZXQgZm9vZFR5cGUgPSB0aGlzLmRhdGEucmVjZW50TGlzdFtpbmRleF0uZm9vZFR5cGU7XG4gICAgLy8gbGV0IGltYWdlVXJsID0gXCJodHRwczovL2RpZXRsZW5zLTEyNTg2NjU1NDcuY29zLmFwLXNoYW5naGFpLm15cWNsb3VkLmNvbS9taW5pLWFwcC1pbWFnZS9kZWZhdWx0SW1hZ2UvdGV4dHNlYXJjaC1kZWZhdWx0LWltYWdlLnBuZ1wiO1xuICAgIGNvbnN0IHVuaXRfb3B0aW9uPVtcbiAgICAgIHtcInVuaXRfbmFtZVwiOlwi5YWLXCIsXCJ3ZWlnaHRcIjo4MDAsXCJ1bml0X2lkXCI6NzB9LFxuICAgICAge1widW5pdF9uYW1lXCI6XCLpuKHom4vlpKflsI9cIixcIndlaWdodFwiOjM2MDAwLFwidW5pdF9pZFwiOjc0fSxcbiAgICAgIHtcInVuaXRfbmFtZVwiOlwi56KXXCIsXCJ3ZWlnaHRcIjoyMTAwMCxcInVuaXRfaWRcIjo3NH1cbiAgICBdO1xuICAgIGNvbnN0IGFyciA9IHVuaXRfb3B0aW9uLm1hcChpdGVtPT57XG4gICAgICByZXR1cm4gKHsgXG4gICAgICAgICduYW1lJyA6IGl0ZW0udW5pdF9uYW1lLFxuICAgICAgICAndW5pdEVuZXJneScgOiBpdGVtLndlaWdodC8xMDAsXG4gICAgICAgICd1bml0X2lkJyA6IGl0ZW0udW5pdF9pZFxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgY29uc3QgbmFtZUFyciA9IGFyci5tYXAoaXRlbT0+aXRlbS5uYW1lKTtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe1xuICAgICAgZm9vZE51bVZhbHVlOjEwMCwgLy8g5Yid5aeL5YyW5pWw6YePMTAw5YWLXG4gICAgICBjaG9vc2VVaW5pdEluZGV4OjAsIC8vIOWIneWni+WMluaVsOmHjzEwMOWFi1xuICAgICAgcmVjZW50UmVzdWx0U2VsZWN0SW5kZXg6aW5kZXgsXG4gICAgICB1bml0QXJyOm5hbWVBcnIsXG4gICAgICBmb29kVW5pdEFuZFVuaXRFbmVyZ3k6YXJyLFxuICAgICAgc2hvd1BvcHVwOnRydWVcbiAgICB9KVxuICAgIHJldHVybiBmYWxzZVxuICAgIGlmICh0aGlzLm5hdmlUeXBlID09PSAwKSB7XG4gICAgICAvL2NyZWF0ZSBtZWFsIGhlcmVcbiAgICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6IFwi5Yqg6L295LitLi4uXCIsIG1hc2s6IHRydWUgfSk7XG4gICAgICBsZXQgcmVzdWx0cyA9IFt7IGZvb2RfaWQ6IGZvb2RJZCwgZm9vZF9uYW1lOiBmb29kTmFtZSwgZm9vZF90eXBlOiBmb29kVHlwZSB9XTtcbiAgICAgIGxldCBmb29kID0geyBmb29kX2lkOiBmb29kSWQsIGlucHV0X3R5cGU6IDIsIGZvb2RfdHlwZTogZm9vZFR5cGUsIHJlY29nbml0aW9uX3Jlc3VsdHM6IHJlc3VsdHMgfTtcbiAgICAgIGxldCBmb29kTGlzdCA9IFtmb29kXTtcbiAgICAgIGxldCByZXEgPSB7IG1lYWxfaWQ6IC0xLCBtZWFsX3R5cGU6IHRoaXMubWVhbFR5cGUsIG1lYWxfZGF0ZTogdGhpcy5tZWFsRGF0ZSwgZm9vZF9saXN0OiBmb29kTGlzdCB9O1xuICAgICAgd2ViQVBJLkNyZWF0ZU9yVXBkYXRlTWVhbExvZyhyZXEpLnRoZW4ocmVzcCA9PiB7XG4gICAgICAgIHd4LmhpZGVMb2FkaW5nKHt9KTtcbiAgICAgICAgbGV0IHBhcmFtID0ge307XG4gICAgICAgIHBhcmFtLm1lYWxJZCA9IHJlc3AubWVhbF9pZDtcbiAgICAgICAgcGFyYW0uaW1hZ2VVcmwgPSBpbWFnZVVybDtcbiAgICAgICAgcGFyYW0uc2hvd1NoYXJlQnRuID0gZmFsc2U7XG4gICAgICAgIGxldCBwYXJhbUpzb24gPSBKU09OLnN0cmluZ2lmeShwYXJhbSk7XG4gICAgICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgICAgIHVybDogXCIvcGFnZXMvZm9vZERldGFpbC9pbmRleD9wYXJhbUpzb249XCIgKyBwYXJhbUpzb25cbiAgICAgICAgfSk7XG4gICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICB3eC5oaWRlTG9hZGluZyh7fSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHBhZ2VzID0gZ2V0Q3VycmVudFBhZ2VzKCk7XG4gICAgICBsZXQgcHJldlBhZ2UgPSBwYWdlc1twYWdlcy5sZW5ndGggLSAyXTtcbiAgICAgIC8vc2V0IHRleHQgc2VhcmNoIHJlc3VsdCB0byBwcmV2IHBhZ2VzXG4gICAgICBwcmV2UGFnZS50ZXh0U2VhcmNoRm9vZCA9IHsgZm9vZF9pZDogZm9vZElkLCBmb29kX25hbWU6IGZvb2ROYW1lLCBmb29kX3R5cGU6IGZvb2RUeXBlIH1cbiAgICAgIHd4Lm5hdmlnYXRlQmFjayh7XG4gICAgICAgIGRlbHRhOiAxXG4gICAgICB9KVxuICAgIH1cbiAgICAvL3JlY2VudCBMUlVcbiAgICB0ZXh0Q2FjaGUuc2V0VmFsdWUodGhpcy5kYXRhLnJlY2VudExpc3RbaW5kZXhdKTtcbiAgfVxuXG4gIHB1YmxpYyBkZWxldGVUZXh0U2VhcmNoQ2FjaGUoZXZlbnQ6IGFueSl7XG4gICAgdGV4dENhY2hlLmNsZWFyQWxsKCk7XG4gICAgdGhpcy5nZXRSZWNlbnRMaXN0KCk7XG4gIH1cbiAgLyoqXG4gICAqIOWFs+mXreW8ueeql3BvcHVw5qGGXG4gICAqL1xuICBwdWJsaWMgb25DbG9zZSgpe1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7IHNob3dQb3B1cDogZmFsc2Usc2hvd0Nob29zZWRMaXN0czpmYWxzZX0pO1xuICB9XG4vKipcbiAqIOWIh+aNouW3sumAiemjn+eJqeWIl+ihqOeahOaYvuekuuS4jumakOiXj1xuICovXG4gIHB1YmxpYyB0b2dnbGVDaG9vc2VkTGlzdHMoKXtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe3Nob3dDaG9vc2VkTGlzdHM6IXRoaXMuZGF0YS5zaG93Q2hvb3NlZExpc3RzfSlcbiAgfVxuICAvKipcbiAgICog54K55Ye75re75Yqg5oyJ6ZKu77yM5bCG6aOf54mp5re75Yqg6Iez5bey6YCJXG4gICAqL1xuICBwdWJsaWMgaGFuZGxlQWRkRm9vZCgpe1xuICAgIGxldCBpdGVtOmFueSA9IHRoaXMuZGF0YS5yZWNlbnRMaXN0W3RoaXMuZGF0YS5yZWNlbnRSZXN1bHRTZWxlY3RJbmRleF07XG4gICAgaXRlbSA9IHtcbiAgICAgIC4uLml0ZW0sXG4gICAgICBjaG9vc2VkVW5pdDp0aGlzLmRhdGEudW5pdEFyclt0aGlzLmRhdGEuY2hvb3NlVWluaXRJbmRleF0sXG4gICAgICB3ZWlnaHROdW1iZXI6dGhpcy5kYXRhLmZvb2ROdW1WYWx1ZSxcbiAgICAgIHVuaXRFbmVyZ3k6dGhpcy5kYXRhLmZvb2RVbml0QW5kVW5pdEVuZXJneVt0aGlzLmRhdGEuY2hvb3NlVWluaXRJbmRleF0udW5pdEVuZXJneSxcbiAgICAgIHVuaXRfaWQ6dGhpcy5kYXRhLmZvb2RVbml0QW5kVW5pdEVuZXJneVt0aGlzLmRhdGEuY2hvb3NlVWluaXRJbmRleF0udW5pdF9pZFxuICAgIH07XG4gICAgdGhpcy5kYXRhLmNob29zZWRMaXN0cy5wdXNoKGl0ZW0pO1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7IFxuICAgICAgY2hvb3NlZExpc3RzIDogdGhpcy5kYXRhLmNob29zZWRMaXN0cyxcbiAgICAgIHNob3dQb3B1cCA6IGZhbHNlXG4gICAgfSwoKT0+e1xuICAgICAgdGhpcy5zdW1FbmVyZ3koKTtcbiAgICAgIGNvbnNvbGUubG9nKHRoaXMuZGF0YS5jaG9vc2VkTGlzdHMpXG4gICAgfSlcbiAgfVxuICAvKipcbiAgICogQHBhcmFtIOiuoeeul+eUqOaIt+mjn+eJqeS4gOWFseacieWkmuWwkeeDremHj1xuICAgKi9cbiAgcHVibGljIHN1bUVuZXJneSgpe1xuICAgIGNvbnN0IHRvdGFsRW5lcmd5ID0gdGhpcy5kYXRhLmNob29zZWRMaXN0cy5yZWR1Y2UoKHByZSxuZXh0KT0+e1xuICAgICAgcmV0dXJuIG5leHQud2VpZ2h0TnVtYmVyKm5leHQudW5pdEVuZXJneStwcmVcbiAgICB9LDApO1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7dG90YWxFbmVyZ3k6dG90YWxFbmVyZ3l9KVxuICB9XG5cbiAgLyoqXG4gICAqIOeUqOaIt+i+k+WFpemjn+eJqeeahOS7veaVsFxuICAgKi9cbiAgcHVibGljIGhhbmRsZUZvb2ROdW1JbnB1dChlOmFueSl7XG4gICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtmb29kTnVtVmFsdWU6cGFyc2VJbnQoZS5kZXRhaWwudmFsdWUpfSlcbiAgfVxuICAvKipcbiAgICog5bGV56S6cGlja2Vy77yM6YCJ5oup6aOf54mp5Y2V5L2NXG4gICAqL1xuICBwdWJsaWMgc2hvd1BpY2tlcigpe1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7c2hvd1BpY2tlcjp0cnVlLHNob3dQb3B1cDpmYWxzZX0pXG4gIH1cbiAgcHVibGljIG9uQ29uZmlybSgpe1xuICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7c2hvd1BpY2tlcjpmYWxzZSxzaG93UG9wdXA6dHJ1ZX0pXG4gIH1cbiAgcHVibGljIG9uQ2hhbmdlKGU6YW55KXtcbiAgICBsZXQgY2hvb3NlVWluaXRJbmRleDpudW1iZXIgPSBlLmRldGFpbC5pbmRleDtcbiAgICBpZih0aGlzLmRhdGEudW5pdEFycltjaG9vc2VVaW5pdEluZGV4XT09PSflhYsnKXtcbiAgICAgICh0aGlzIGFzIGFueSkuc2V0RGF0YSh7Zm9vZE51bVZhbHVlTWF4bGVuZ3RoOjN9KVxuICAgIH1cbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe2Nob29zZVVpbml0SW5kZXg6Y2hvb3NlVWluaXRJbmRleH0pXG4gIH1cbiAgLyoqXG4gICAqIOWIoOmZpOmAieS4reWIl+ihqOS4reeahOafkOS4gOmhuVxuICAgKi9cbiAgcHVibGljIGhhbmRsZURlbGV0ZUNob29zZWRJdGVtKGU6YW55KXtcbiAgICBsZXQgaW5kZXggPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleDtcbiAgICB0aGlzLmRhdGEuY2hvb3NlZExpc3RzLnNwbGljZShpbmRleCwxKTtcbiAgICAodGhpcyBhcyBhbnkpLnNldERhdGEoe2Nob29zZWRMaXN0czp0aGlzLmRhdGEuY2hvb3NlZExpc3RzfSwoKT0+e1xuICAgICAgdGhpcy5zdW1FbmVyZ3koKVxuICAgICAgaWYodGhpcy5kYXRhLmNob29zZWRMaXN0cy5sZW5ndGg9PT0wKXtcbiAgICAgICAgKHRoaXMgYXMgYW55KS5zZXREYXRhKHtzaG93Q2hvb3NlZExpc3RzOmZhbHNlfSlcbiAgICAgIH1cbiAgICB9KVxuICB9XG4gIC8qKlxuICAgKiDmibnph4/mt7vliqDpo5/nianmlbTlkIjlj4LmlbBcbiAgICovXG4gIHB1YmxpYyBoYW5kbGVDb25maXJtQnRuKCl7XG4gICAgd3guc2hvd0xvYWRpbmcoeyB0aXRsZTogXCLliqDovb3kuK0uLi5cIiwgbWFzazogdHJ1ZSB9KTtcbiAgICBsZXQgZm9vZExpc3Q6YW55W10gPSBbXTtcbiAgICB0aGlzLmRhdGEuY2hvb3NlZExpc3RzLm1hcCgoaXRlbTphbnkpID0+IHtcbiAgICAgIGxldCByZXN1bHRzID0gW3sgZm9vZF9pZDogaXRlbS5mb29kSWQsIGZvb2RfbmFtZTogaXRlbS5mb29kTmFtZSwgZm9vZF90eXBlOiBpdGVtLmZvb2RUeXBlIH1dO1xuICAgICAgbGV0IGZvb2QgPSB7IFxuICAgICAgICBmb29kX2lkOiBpdGVtLmZvb2RJZCwgXG4gICAgICAgIGZvb2RfdHlwZTogaXRlbS5mb29kVHlwZSwgXG4gICAgICAgIHJlY29nbml0aW9uX3Jlc3VsdHM6IHJlc3VsdHMsXG4gICAgICAgIGlucHV0X3R5cGU6IDIsIFxuICAgICAgICBhbW91bnQ6cGFyc2VJbnQoaXRlbS53ZWlnaHROdW1iZXIpKjEwMCxcbiAgICAgICAgdW5pdF9pZDogaXRlbS51bml0X2lkXG4gICAgICB9O1xuICAgICAgZm9vZExpc3QucHVzaChmb29kKVxuICAgIH0pXG4gICAgbGV0IHJlcSA9IHsgbWVhbF9pZDogLTEsIG1lYWxfdHlwZTogdGhpcy5tZWFsVHlwZSwgbWVhbF9kYXRlOiB0aGlzLm1lYWxEYXRlLCBmb29kX2xpc3Q6IGZvb2RMaXN0IH07XG4gICAgY29uc29sZS5sb2coJ+ivt+axguWPguaVsHJlcScscmVxKVxuICAgIHRoaXMuQ3JlYXRlT3JVcGRhdGVNZWFsTG9nKHJlcSk7XG4gIH1cbiAgLyoqXG4gICAqIOagvOW8j+WMluaVsOaNruWQju+8jOWPkeWHuuivt+axgu+8jOiOt+W+l21lYWxfaWRcbiAgICovXG4gIHB1YmxpYyBDcmVhdGVPclVwZGF0ZU1lYWxMb2cocmVxOmFueSl7XG4gICAgbGV0IGltYWdlVXJsID0gXCJodHRwczovL2RpZXRsZW5zLTEyNTg2NjU1NDcuY29zLmFwLXNoYW5naGFpLm15cWNsb3VkLmNvbS9taW5pLWFwcC1pbWFnZS9kZWZhdWx0SW1hZ2UvdGV4dHNlYXJjaC1kZWZhdWx0LWltYWdlLnBuZ1wiO1xuICAgIHdlYkFQSS5DcmVhdGVPclVwZGF0ZU1lYWxMb2cocmVxKS50aGVuKHJlc3AgPT4ge1xuICAgICAgLy8gbGV0IHBhcmFtOmFueSA9IHt9O1xuICAgICAgLy8gcGFyYW0ubWVhbElkID0gcmVzcC5tZWFsX2lkO1xuICAgICAgLy8gcGFyYW0uaW1hZ2VVcmwgPSBpbWFnZVVybDtcbiAgICAgIC8vIHBhcmFtLnNob3dTaGFyZUJ0biA9IGZhbHNlO1xuICAgICAgLy8gbGV0IHBhcmFtSnNvbiA9IEpTT04uc3RyaW5naWZ5KHBhcmFtKTtcbiAgICAgIHRoaXMuQ29uZmlybU1lYWxMb2cocmVzcC5tZWFsX2lkKVxuICAgIH0pLmNhdGNoKGVyciA9PiB7XG4gICAgICB3eC5zaG93VG9hc3Qoe3RpdGxlOiAn6K+35rGC5aSx6LSlJyxpY29uOiAnbm9uZSd9KTtcbiAgICAgIHd4LmhpZGVMb2FkaW5nKHt9KTtcbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICog5Y+R5Ye66K+35rGC77yM5Yib5bu66K6w5b2VXG4gICAqL1xuICBwdWJsaWMgQ29uZmlybU1lYWxMb2cobWVhbF9pZDpudW1iZXIpe1xuICAgIGxldCByZXEgPSB7IG1lYWxfaWQ6IG1lYWxfaWQgfTtcbiAgICB3ZWJBUEkuQ29uZmlybU1lYWxMb2cocmVxKS50aGVuKHJlc3AgPT4ge1xuICAgICAgd3guaGlkZUxvYWRpbmcoe30pO1xuICAgICAgd3gubmF2aWdhdGVUbyh7IHVybDogXCIvcGFnZXMvZm9vZFNoYXJlL2luZGV4P21lYWxJZD1cIiArIG1lYWxfaWQgfSlcbiAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgd3guc2hvd1RvYXN0KHt0aXRsZTogJ+aPkOS6pOmjn+eJqeiusOW9leWksei0pScsaWNvbjogJ25vbmUnfSk7XG4gICAgfSk7XG4gIH1cblxufVxuXG5QYWdlKG5ldyB0ZXh0U2VhcmNoKCkpXG4iXX0=